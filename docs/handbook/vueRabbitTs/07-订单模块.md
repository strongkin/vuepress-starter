# å¡«å†™è®¢å•æ¨¡å—



## å¡«å†™è®¢å•å®ç°

> `æœ¬èŠ‚ç›®æ ‡:`  å®ç°å¡«å†™è®¢å•è·³è½¬

### å¡«å†™è®¢å•é¡µç»„ä»¶å’Œè·¯ç”±

1ï¼‰å‡†å¤‡å¡«å†™è®¢å•é¡µé¢

æ–°å»ºé¡µé¢ç»„ä»¶ï¼š`src/views/Checkout/index.vue`

```html
<script setup lang="ts">
//
</script>

<template>
  <div>å¡«å†™è®¢å•é¡µé¢</div>
</template>

```

2ï¼‰äºŒçº§è·¯ç”±ï¼š`router/index.ts`

```js
  {
    path: '/',
    component: Layout,
    children: [
      ...
      {
        path: "/member/checkout",
        component: () => import("@/views/Checkout/index.vue"),
      },
    ]
  },
```

### è´­ç‰©è½¦é¡µç»“ç®—æŒ‰é’®

**æ€è·¯åˆ†æ**

è´­ç‰©è½¦é¡µï¼Œå¡«å†™è®¢å•ç¯èŠ‚çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯åšå„ç§åˆ¤æ–­ï¼Œå…¶ä¸­åŒ…æ‹¬

1. åˆ¤æ–­æ˜¯å¦é€‰ä¸­å•†å“ï¼Œæ²¡é€‰ä¸­å•†å“æé†’ã€‚

2. åˆ¤æ–­æ˜¯å¦ç™»å½•ï¼Œæœªç™»å½•æé†’ã€‚

   æ»¡è¶³ä»¥ä¸Šæ¡ä»¶è·³è½¬å»å¡«å†™è®¢å•é¡µé¢ã€‚

**è½åœ°ä»£ç **

`src\views\Cart\index.vue`

```jsx
// ç‚¹å‡»å¡«å†™è®¢å•æŒ‰é’®
const router = useRouter();
const goToCheckout = () => {
  // 1. åˆ¤æ–­é€‰ä¸­æ•°é‡ä¸èƒ½ä¸ºé›¶
  if (!selectedListCount.value) {
    return message({ type: "warn", text: "è¯·é€‰æ‹©å•†å“ä¸‹å•" });
  }
  // 2. åˆ¤æ–­æ˜¯å¦ç™»å½•
  if (!member.isLogin) {
    return message({ type: "warn", text: "è¯·å…ˆç™»å½•~" });
  }
  // è·³è½¬åˆ°å¡«å†™è®¢å•
  router.push("/member/checkout");
};


<XtxButton type="primary" @click="goToCheckout()">å¡«å†™è®¢å•</XtxButton>
```

## è·å–é¢„ä»˜è®¢å•æ•°æ®

> `æœ¬èŠ‚ç›®æ ‡:` è·å–é¢„ä»˜è®¢å•æ•°æ®å¹¶å®šä¹‰TSç±»å‹å£°æ˜æ–‡ä»¶ã€‚

### æ¥å£ï¼šç”Ÿæˆè®¢å•(å³å¡«å†™è®¢å•æˆ–ç»“ç®—é¡µ)

**åŸºæœ¬ä¿¡æ¯**

**Pathï¼š** /member/order/pre

**Methodï¼š** GET

**è¯·æ±‚å‚æ•°**

æ— 

### è·å–è®¢å•æ•°æ®

**å®ç°æ­¥éª¤**

1. å‡†å¤‡è®¢å•çš„ Store
2. å®šä¹‰è·å–ç»“ç®—ä¿¡æ¯ API æ¥å£
3. é¡µé¢ç»„ä»¶è·å–æ•°æ®ï¼Œæ¸²æŸ“é¡µé¢å†…å®¹

**ä»£ç è½åœ°** 

æ–°å»º Storeï¼š `src/store/modules/order.ts`  

```ts
import { defineStore } from 'pinia';

// å®šä¹‰ Store æ—¶å»ºè®®éµå¾ªå‘½åè§„èŒƒ useXxxStore
const useOrderStore = defineStore('order', {
  // state ç›¸å½“äº data
  state: () => ({}),
  // getters ç›¸å½“äº computed
  getters: {},
  // actions ç›¸å½“äº methods
  actions: {},
});

export default useOrderStore;
```

åˆå¹¶ Storeï¼Œ`src/store/index.ts`

```diff
import useOrderStore from './modules/order';

const useStore = defineStore('main', {
  state: () => ({
     // ...ä»£ç çœç•¥
    order: useOrderStore(),
  }),
});
```

å‡†å¤‡ actions 

```ts
 actions: {
    async getCheckoutInfo() {
      const res = await http('GET', '/member/order/pre');
      console.log('GET', '/member/order/pre', res);
    },
  },
```

ç»„ä»¶ä¸­è°ƒç”¨

```html
<script setup lang="ts">
const { order } = useStore();
order.getCheckoutInfo();
</script>
```

### å®šä¹‰ TS ç±»å‹æ–‡ä»¶

æ–°å»ºç±»å‹æ–‡ä»¶ `src\types\modules\order.d.ts`

```ts
export interface UserAddresse {
  id: string;
  receiver: string;
  contact: string;
  provinceCode: string;
  cityCode: string;
  countyCode: string;
  address: string;
  isDefault: number;
  fullLocation: string;
  postalCode: string;
  addressTags: string;
}

export interface Good {
  id: string;
  name: string;
  picture: string;
  count: number;
  skuId: string;
  attrsText: string;
  price: string;
  payPrice: string;
  totalPrice: string;
  totalPayPrice: string;
}

export interface Summary {
  goodsCount: number;
  totalPrice: number;
  totalPayPrice: number;
  postFee: number;
  discountPrice: number;
}

// ç”Ÿæˆè®¢å•
export interface CheckoutInfo {
  userAddresses: UserAddresse[];
  goods: Good[];
  summary: Summary;
}
```

åˆå¹¶å¯¼å‡º `src\types\index.d.ts`

```tsx
// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰è‡ªå®šä¹‰çš„ç±»å‹æ–‡ä»¶
...
export * from "./api/order";
```

## å¡«å†™è®¢å•æ•°æ®æ¸²æŸ“

> æœ¬èŠ‚ç›®æ ‡ï¼šå®Œæˆç»“ç®—é¡µé™æ€ç»“æ„å’Œæ•°æ®æ¸²æŸ“

### é™æ€ç»“æ„

1ï¼‰å‡†å¤‡ç»“æ„ `src/views/Checkout/index.vue` 

```html

<template>
  <div class="xtx-pay-checkout-page">
    <div class="container">
      <XtxBread>
        <XtxBreadItem to="/">é¦–é¡µ</XtxBreadItem>
        <XtxBreadItem to="/cart">è´­ç‰©è½¦</XtxBreadItem>
        <XtxBreadItem>å¡«å†™è®¢å•</XtxBreadItem>
      </XtxBread>
      <div class="wrapper">
        <!-- æ”¶è´§åœ°å€ -->
        <h3 class="box-title">æ”¶è´§åœ°å€</h3>
        <div class="box-body">
          <div class="address">
            <div class="text">
              <ul>
                <li><span>æ”¶&ensp;è´§&ensp;äººï¼š</span>æœ±è¶…</li>
                <li><span>è”ç³»æ–¹å¼ï¼š</span>132****2222</li>
                <li>
                  <span>æ”¶è´§åœ°å€ï¼š</span>æµ·å—çœä¸‰äºšå¸‚è§£æ”¾è·¯108å·ç‰©è´¨å¤§å¦1003å®¤
                </li>
              </ul>
              <!-- <div class="none">æ‚¨éœ€è¦å…ˆæ·»åŠ æ”¶è´§åœ°å€æ‰å¯æäº¤è®¢å•ã€‚</div> -->
            </div>
            <div class="action">
              <XtxButton class="btn">åˆ‡æ¢åœ°å€</XtxButton>
              <XtxButton class="btn">æ·»åŠ åœ°å€</XtxButton>
            </div>
          </div>
        </div>
        <!-- å•†å“ä¿¡æ¯ -->
        <h3 class="box-title">å•†å“ä¿¡æ¯</h3>
        <div class="box-body">
          <table class="goods">
            <thead>
              <tr>
                <th width="520">å•†å“ä¿¡æ¯</th>
                <th width="170">å•ä»·</th>
                <th width="170">æ•°é‡</th>
                <th width="170">å°è®¡</th>
                <th width="170">å®ä»˜</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="item in 4" :key="item">
                <td>
                  <a href="javascript:;" class="info">
                    <img
                      src="https://yanxuan-item.nosdn.127.net/cd9b2550cde8bdf98c9d083d807474ce.png"
                      alt=""
                    />
                    <div class="right">
                      <p>è½»å·§å¤šç”¨é”…é›ªå¹³é”… éº¦é¥­çŸ³ä¸ç²˜å°å¥¶é”…ç…®é”…</p>
                      <p>é¢œè‰²ï¼šç™½è‰² å°ºå¯¸ï¼š10cm äº§åœ°ï¼šæ—¥æœ¬</p>
                    </div>
                  </a>
                </td>
                <td>&yen;100.00</td>
                <td>2</td>
                <td>&yen;200.00</td>
                <td>&yen;200.00</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- é…é€æ—¶é—´ -->
        <h3 class="box-title">é…é€æ—¶é—´</h3>
        <div class="box-body">
          <a class="my-btn active" href="javascript:;"
            >ä¸é™é€è´§æ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨æ—¥</a
          >
          <a class="my-btn" href="javascript:;">å·¥ä½œæ—¥é€è´§ï¼šå‘¨ä¸€è‡³å‘¨äº”</a>
          <a class="my-btn" href="javascript:;">åŒä¼‘æ—¥ã€å‡æ—¥é€è´§ï¼šå‘¨å…­è‡³å‘¨æ—¥</a>
        </div>
        <!-- æ”¯ä»˜æ–¹å¼ -->
        <h3 class="box-title">æ”¯ä»˜æ–¹å¼</h3>
        <div class="box-body">
          <a class="my-btn active" href="javascript:;">åœ¨çº¿æ”¯ä»˜</a>
          <a class="my-btn" href="javascript:;">è´§åˆ°ä»˜æ¬¾</a>
          <span style="color: #999">è´§åˆ°ä»˜æ¬¾éœ€ä»˜5å…ƒæ‰‹ç»­è´¹</span>
        </div>
        <!-- é‡‘é¢æ˜ç»† -->
        <h3 class="box-title">é‡‘é¢æ˜ç»†</h3>
        <div class="box-body">
          <div class="total">
            <dl>
              <dt>å•†å“ä»¶æ•°ï¼š</dt>
              <dd>5ä»¶</dd>
            </dl>
            <dl>
              <dt>å•†å“æ€»ä»·ï¼š</dt>
              <dd>Â¥5697.00</dd>
            </dl>
            <dl>
              <dt>è¿<i></i>è´¹ï¼š</dt>
              <dd>Â¥0.00</dd>
            </dl>
            <dl>
              <dt>åº”ä»˜æ€»é¢ï¼š</dt>
              <dd class="price">Â¥5697.00</dd>
            </dl>
          </div>
        </div>
        <!-- æäº¤è®¢å• -->
        <div class="submit">
          <XtxButton type="primary">æäº¤è®¢å•</XtxButton>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.wrapper {
  background: #fff;
  padding: 0 20px;
  .box-title {
    font-size: 16px;
    font-weight: normal;
    padding-left: 10px;
    line-height: 70px;
    border-bottom: 1px solid #f5f5f5;
  }
  .box-body {
    padding: 20px 0;
  }
}
.address {
  border: 1px solid #f5f5f5;
  display: flex;
  align-items: center;
  .text {
    flex: 1;
    min-height: 90px;
    display: flex;
    align-items: center;
    .none {
      line-height: 90px;
      color: #999;
      text-align: center;
      width: 100%;
    }
    > ul {
      flex: 1;
      padding: 20px;
      li {
        line-height: 30px;
        span {
          color: #999;
          margin-right: 5px;
          > i {
            width: 0.5em;
            display: inline-block;
          }
        }
      }
    }
    > a {
      color: @xtxColor;
      width: 160px;
      text-align: center;
      height: 90px;
      line-height: 90px;
      border-right: 1px solid #f5f5f5;
    }
  }
  .action {
    width: 420px;
    text-align: center;
    .btn {
      width: 140px;
      height: 46px;
      line-height: 44px;
      font-size: 14px;
      &:first-child {
        margin-right: 10px;
      }
    }
  }
}
.goods {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  .info {
    display: flex;
    text-align: left;
    img {
      width: 70px;
      height: 70px;
      margin-right: 20px;
    }
    .right {
      line-height: 24px;
      p {
        &:last-child {
          color: #999;
        }
      }
    }
  }
  tr {
    th {
      background: #f5f5f5;
      font-weight: normal;
    }
    td,
    th {
      text-align: center;
      padding: 20px;
      border-bottom: 1px solid #f5f5f5;
      &:first-child {
        border-left: 1px solid #f5f5f5;
      }
      &:last-child {
        border-right: 1px solid #f5f5f5;
      }
    }
  }
}
.my-btn {
  width: 228px;
  height: 50px;
  border: 1px solid #e4e4e4;
  text-align: center;
  line-height: 48px;
  margin-right: 25px;
  color: #666666;
  display: inline-block;
  &.active,
  &:hover {
    border-color: @xtxColor;
  }
}
.total {
  dl {
    display: flex;
    justify-content: flex-end;
    line-height: 50px;
    dt {
      i {
        display: inline-block;
        width: 2em;
      }
    }
    dd {
      width: 240px;
      text-align: right;
      padding-right: 70px;
      &.price {
        font-size: 20px;
        color: @priceColor;
      }
    }
  }
}
.submit {
  text-align: right;
  padding: 60px;
  border-top: 1px solid #f5f5f5;
}
// å¯¹è¯æ¡†åœ°å€åˆ—è¡¨
.xtx-dialog {
  .addressWrapper {
    max-height: 500px;
    overflow-y: auto;
  }
  .text {
    flex: 1;
    min-height: 90px;
    display: flex;
    align-items: center;
    &.item {
      border: 1px solid #f5f5f5;
      margin-bottom: 10px;
      cursor: pointer;
      &.active,
      &:hover {
        border-color: @xtxColor;
        background: lighten(@xtxColor, 50%);
      }
      > ul {
        padding: 10px;
        font-size: 14px;
        line-height: 30px;
      }
    }
  }
}
</style>

```

### æ¸²æŸ“åŸºæœ¬ä¿¡æ¯

**æ¸²æŸ“å•†å“åˆ—è¡¨**

```html
<!--å•†å“ä¿¡æ¯ -->
<tbody>
  <tr v-for="item in checkoutInfo.goods" :key="item.skuId">
    <td>
      <RouterLink :to="`/goods/${item.id}`" class="info">
        <img :src="item.picture" alt="" />
        <div class="right">
          <p>{{ item.name }}</p>
          <p>{{ item.attrsText }}</p>
        </div>
      </RouterLink>
    </td>
    <td>&yen;{{ item.payPrice }}</td>
    <td>{{ item.count }}</td>
    <td>&yen;{{ item.totalPrice }}</td>
    <td>&yen;{{ item.totalPayPrice }}</td>
  </tr>
</tbody>
```

**é‡‘é¢æ˜ç»†**

```vue
<!-- é‡‘é¢æ˜ç»† -->
<h3 class="box-title">é‡‘é¢æ˜ç»†</h3>
<div class="box-body">
  <div class="total">
    <dl>
      <dt>å•†å“ä»¶æ•°ï¼š</dt>
      <dd>{{ checkoutInfo.summary.goodsCount }}ä»¶</dd>
    </dl>
    <dl>
      <dt>å•†å“æ€»ä»·ï¼š</dt>
      <dd>Â¥{{ checkoutInfo?.summary.totalPrice }}</dd>
    </dl>
    <dl>
      <dt>è¿<i></i>è´¹ï¼š</dt>
      <dd>Â¥{{ checkoutInfo?.summary.postFee }}</dd>
    </dl>
    <dl>
      <dt>åº”ä»˜æ€»é¢ï¼š</dt>
      <dd class="price">Â¥{{ checkoutInfo?.summary.totalPayPrice }}</dd>
    </dl>
  </div>
</div>
```

### åŠ è½½ä¼˜åŒ–ä½“éªŒ

> **æœ¬èŠ‚ç›®æ ‡ï¼š**åŠ è½½è®¢å•ä¿¡æ¯ç”¨æ—¶è¾ƒé•¿ï¼Œæ·»åŠ  loading æ•ˆæœï¼ˆéª¨æ¶å±åŒç†ï¼‰ã€‚

ä¿®æ”¹ä»£ç ï¼š

```diff
<template>
  ...
-    <div class="wrapper">
+    <div v-if="checkoutInfo" class="wrapper">
      ...
    </div>
+    <div v-else class="wrapper loading"></div>
  ...
</template>

<style scoped lang="less">
+// loading æ•ˆæœæ·»åŠ æƒé‡ï¼Œ.wrapper.loading è¡¨ç¤ºåŒæ—¶å­˜åœ¨ä¸¤ä¸ªç±»å
+.wrapper.loading {
+  min-height: 500px;
+  background: #fff url("@/assets/images/loading.gif") no-repeat center;
+}
</style>
```

ğŸ”” æ¸©é¦¨æç¤ºï¼šæ·»åŠ äº† `v-if="checkoutInfo"` åï¼Œç»“æ„å†…éƒ¨è®¿é—® `checkoutInfo` æ•°æ®çš„æ—¶å€™ï¼Œä¸éœ€è¦å¤§é‡ä¹¦å†™ `?.` å¯é€‰é“¾æ“ä½œç¬¦ã€‚



### æ¸²æŸ“æ”¶è´§åœ°å€

**æµ‹è¯•è´¦å· sujiehao/zhousg  å¯†ç ï¼š123456  æµ‹è¯•è´¦å·ä¸‹æœ‰å¤šä¸ªæ”¶è´§åœ°å€**

> æ”¶è´§åœ°å€å­—æ®µæ¯”è¾ƒç‰¹æ®Šä¸€äº›ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½æœ‰å¤šä¸ªåœ°å€ï¼Œä¹Ÿæœ‰å¯èƒ½éšæ—¶åˆ‡æ¢æ”¶è·åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬å•ç‹¬è®¾ç½®ä¸€ä¸ªå“åº”å¼æ•°æ®ç”¨æ¥æ¸²æŸ“æ”¶è·åœ°å€

```vue
<script setup lang="ts">
import { http } from "@/utils/request";
import { onMounted, ref } from "vue";
import type { CheckoutInfo, UserAddresse } from "@/types";

// è®¢å•ä¿¡æ¯
const checkoutInfo = ref<CheckoutInfo>();
// æ”¶è´§åœ°å€
const currAddress = ref<UserAddresse>();
onMounted(async () => {
  const res = await http<CheckoutInfo>("GET", "/member/order/pre");
  console.log("GET", "/member/order/pre", res.data.result);
  // è®¢å•ä¿¡æ¯
  checkoutInfo.value = res.data.result;
  // æ”¶è´§åœ°å€
  currAddress.value = res.data.result.userAddresses[0] || {};
});
</script>



<template>
  ...
        <!-- æ”¶è´§åœ°å€ -->
        <h3 class="box-title">æ”¶è´§åœ°å€</h3>
        <div class="box-body">
          <div class="address">
            <div class="text">
              <ul v-if="currAddress?.receiver">
                <li>
                  <span>æ”¶&ensp;è´§&ensp;äººï¼š</span>{{ currAddress.receiver }}
                </li>
                <li><span>è”ç³»æ–¹å¼ï¼š</span>{{ currAddress.contact }}</li>
                <li>
                  <span>æ”¶è´§åœ°å€ï¼š</span>
                  {{ currAddress.fullLocation + currAddress.address }}
                </li>
              </ul>
              <div class="none" v-else>æ‚¨éœ€è¦å…ˆæ·»åŠ æ”¶è´§åœ°å€æ‰å¯æäº¤è®¢å•ã€‚</div>
            </div>
            <div class="action">
              <XtxButton class="btn">åˆ‡æ¢åœ°å€</XtxButton>
              <XtxButton class="btn">æ·»åŠ åœ°å€</XtxButton>
            </div>
          </div>
        </div>
  ...
</template>
```

### éšè—æ‰‹æœºå·éƒ¨åˆ†ä¿¡æ¯

> æœ¬èŠ‚ç›®æ ‡ï¼š`Vue3` æ²¡æœ‰è¿‡æ»¤å™¨ï¼Œæ¨¡æ¿ä¸­è¦å¯¹æ•°æ®è¿›è¡Œå¤„ç†ç›´æ¥è°ƒç”¨å‡½æ•°å³å¯ã€‚

`src\utils\index.ts`

```ts
/**
 * JSDocæ³¨é‡Š éšè—ç”¨æˆ·æ‰‹æœºå·ç 
 * @param mobile æ‰‹æœºå·ç 
 * @returns å¤„ç†åçš„æ‰‹æœºå·ç 
 */
export const hiddenMobileNumber = (mobile: string) => {
  // æ™®é€šå†™æ³•
  // return mobile.slice(0, 3) + '****' + mobile.slice(-4);
  // æ­£åˆ™æ›¿æ¢ï¼Œç¼–ç»„() ä¸ $n
  return mobile.replace(/(\d{3})(\d{4})(\d{4})/, '$1****$3');
};
```

```diff
<li>
    <span>è”ç³»æ–¹å¼ï¼š</span>
-    {{ currAddress.contact }}
+    {{ hiddenMobileNumber(currAddress.contact) }}
</li>
```

## å¯¹è¯æ¡†ç»„ä»¶åŸºæœ¬ä½¿ç”¨

![image-20220225121348926](./media/image-20220225121348926.png)

### åŸºæœ¬ä½¿ç”¨

```vue
const visible = ref(true);


  <XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" :visible="visible" @close="visible = false">
    <template #default>
      <h1>å¯¹è¯æ¡†å†…å®¹</h1>
    </template>
    <template #footer>
      <XtxButton type="gray" style="margin-right: 20px">å–æ¶ˆ</XtxButton>
      <XtxButton type="primary">ç¡®è®¤</XtxButton>
    </template>
  </XtxDialog>


<XtxButton @click="visible = true" class="btn">
    åˆ‡æ¢åœ°å€
</XtxButton>
```

### å±‚çº§é—®é¢˜ğŸš¨

**position: fixed**   å›ºå®šå®šä½ï¼ŒæŒ‡å®šå…ƒç´ ç›¸å¯¹äºå±å¹•è§†å£ï¼ˆ`viewport`ï¼‰çš„ä½ç½®æ¥æŒ‡å®šå…ƒç´ ä½ç½®ã€‚

æ‹“å±•é˜…è¯»ï¼š[https://developer.mozilla.org/zh-CN/docs/Web/CSS/position](https://developer.mozilla.org/zh-CN/docs/Web/CSS/position)

ğŸ›è¸©å‘ï¼šå½“å…ƒç´ ç¥–å…ˆçš„ `transform`, `perspective` æˆ– `filter` å±æ€§é `none` æ—¶ï¼Œå®¹å™¨ç”±è§†å£æ”¹ä¸ºè¯¥ç¥–å…ˆã€‚

**é—®é¢˜ä»£ç æ¼”ç¤º**

```diff
+  <!-- å½“å…ƒç´ ç¥–å…ˆå‡ºç° `transform`ï¼Œå¯¹è¯æ¡†å›ºå®šå®šä½å‡ºé—®é¢˜ -->
+  <div style="transform: translate(0)">
    <XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" :visible="true">
      <template #default>
        <h1>å¯¹è¯æ¡†å†…å®¹</h1>
      </template>
      <template #footer>
        <XtxButton type="gray" style="margin-right: 20px">å–æ¶ˆ</XtxButton>
        <XtxButton type="primary">ç¡®è®¤</XtxButton>
      </template>
    </XtxDialog>
+  </div>
```

![image-20220225122447034](./media/image-20220225122447034.png)

> ğŸ“Œ ç»“è®ºï¼š`transform` å±æ€§ä¼šå¯¹`fixed`å±æ€§é€ æˆå½±å“ã€‚



##  `Vue3` æ–°å¢ï¼š`Teleport` ä¼ é€é—¨ç»„ä»¶

> æœ¬èŠ‚ç›®æ ‡ï¼š`Teleport` æ˜¯ `Vue3` æ‰æ–°å¢çš„å†…ç½®ç»„ä»¶ã€‚

æ‹“å±•é˜…è¯»ï¼š[å®˜æ–¹æ–‡æ¡£](https://staging-cn.vuejs.org/guide/built-ins/teleport.html#teleport)

`Vue3` å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°åŒæ ·çš„å®šä½é—®é¢˜ï¼š

å½“åœ¨åˆå§‹ HTML ç»“æ„ä¸­ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ—¶ï¼Œä¼šæœ‰ä¸€äº›æ½œåœ¨çš„é—®é¢˜ï¼š

- `position: fixed` èƒ½å¤Ÿç›¸å¯¹äºè§†å£æ”¾ç½®çš„æ¡ä»¶æ˜¯ï¼šæ²¡æœ‰ä»»ä½•ç¥–å…ˆå…ƒç´ è®¾ç½®äº† `transform`ã€`perspective` æˆ–è€… `filter` æ ·å¼å±æ€§ã€‚è€Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç”¨ `transform` ä¸ºç¥–å…ˆèŠ‚ç‚¹è®¾ç½®åŠ¨ç”»ï¼Œåˆ™ä¼šç ´åæ¨¡æ€æ¡†çš„å¸ƒå±€ç»“æ„ï¼
- æ¨¡æ€æ¡†çš„ `z-index` è¢«åŒ…å«å®ƒçš„å…ƒç´ æ‰€åˆ¶çº¦ã€‚

### åŸºæœ¬ç”¨æ³•

- ä¼ é€é—¨ `to` å±æ€§å¯ä»¥æŒ‡å®šä¼ é€åˆ°æŸä¸ªèŠ‚ç‚¹ã€‚

```jsx
  <!-- ğŸ”” Teleport çš„å†…å®¹ä¼šä¼ é€åˆ° body æ ‡ç­¾ä¸­ -->
  <Teleport to="body">
    <XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" :visible="true">
      <template #default>
        <h1>å¯¹è¯æ¡†å†…å®¹</h1>
      </template>
      <template #footer>
        <XtxButton type="gray" style="margin-right: 20px">å–æ¶ˆ</XtxButton>
        <XtxButton type="primary">ç¡®è®¤</XtxButton>
      </template>
    </XtxDialog>
  </Teleport>
```

### ä¼ é€åˆ°æŒ‡å®šç»“æ„

- `index.html` ä¸­å‡†å¤‡ä¸€ä¸ªç»“æ„ã€‚

```jsx
<div id="app"></div>

<div id="model"></div>
```

- å¦‚æœè¦ä¼ é€åˆ°æŒ‡å®šç»“æ„ï¼Œç»“æ„éœ€è¦æå‰å‡†å¤‡ï¼Œå¦åˆ™æŠ¥é”™ã€‚ğŸš¨

```vue
  <!-- ğŸ””ä¼ é€åˆ°æŒ‡å®šç»“æ„ #model ä¸­ -->
  <Teleport to="#model">
    <XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" :visible="visible" @close="visible = false">
      <template #default>
        <h1>å¯¹è¯æ¡†å†…å®¹</h1>
      </template>
      <template #footer>
        <XtxButton type="gray" style="margin-right: 20px">å–æ¶ˆ</XtxButton>
        <XtxButton type="primary">ç¡®è®¤</XtxButton>
      </template>
    </XtxDialog>
  </Teleport>
```



## æ”¶è´§åœ°å€å¤„ç† - è¯¾åç»ƒä¹ 

### åˆ‡æ¢æ”¶è´§åœ°å€ - è¯¾åç»ƒä¹ 

`ä»»åŠ¡ç›®æ ‡:`  èƒ½å¤Ÿåˆ‡æ¢å½“å‰æ˜¾ç¤ºçš„åœ°å€

> æµ‹è¯•è´¦å· zhousg/sujiehao    123456  è´¦å·ä¸‹æœ‰å¤šä¸ªæ”¶è´§åœ°å€

![](./media/03-1628459174479.png)

**å®ç°æ­¥éª¤**

1. å¯¹è¯æ¡†ä¸­æ¸²æŸ“ä¸€ä¸ªåœ°å€åˆ—è¡¨
2. å®ç°å¯ä»¥é€‰ä¸­çš„æ•ˆæœï¼Œç‚¹å‡»ç¡®è®¤åå˜æ›´æ˜¾ç¤ºåœ°å€

**ä»£ç è½åœ°**

1ï¼‰æ¸²æŸ“åœ°å€åˆ—è¡¨

```vue
<script setup lang="ts">
import { http } from "@/utils/request";
import { onMounted, ref } from "vue";
import type { CheckoutInfo, UserAddresse } from "@/types";

// è®¢å•ä¿¡æ¯
const checkoutInfo = ref<CheckoutInfo>();
// æ”¶è´§åœ°å€
const currAddress = ref<UserAddresse>();
onMounted(async () => {
  const res = await http<CheckoutInfo>("GET", "/member/order/pre");
  console.log("GET", "/member/order/pre", res.data.result);
  // è®¢å•ä¿¡æ¯
  checkoutInfo.value = res.data.result;
  // æ”¶è´§åœ°å€
  currAddress.value = res.data.result.userAddresses[0] || {};
  // æ”¶è´§åœ°å€åˆ—è¡¨
  addressList.value = checkoutInfo.value.userAddresses;
});

const visible = ref(false);
</script>

<template>
  <div class="xtx-pay-checkout-page">
      ...
              <XtxButton class="btn" @click="visible = true">
                åˆ‡æ¢åœ°å€
              </XtxButton>
      ...            
  </div>
  <!-- ä¼ é€åˆ° body æ ‡ç­¾ä¸­ -->
  <Teleport to="body">
    <XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" :visible="visible" @close="visible = false">
      <template #default>
        <div class="addressWrapper">
          <div class="text item" v-for="item in checkoutInfo?.userAddresses" :key="item.id">
            <ul>
              <li><span>æ”¶&emsp;è´§&emsp;äººï¼š</span>{{ item.receiver }}</li>
              <li><span>è”ç³»æ–¹å¼ï¼š</span>{{ item.contact }}</li>
              <li>
                <span>æ”¶è´§åœ°å€ï¼š</span>{{ item.fullLocation + item.address }}
              </li>
            </ul>
          </div>
        </div>
      </template>
      <template #footer>
        <XtxButton
          type="gray"
          style="margin-right: 20px"
          @click="visible = false"
        >
          å–æ¶ˆ
        </XtxButton>
        <XtxButton type="primary" @click="visible = false">ç¡®è®¤</XtxButton>
      </template>
    </XtxDialog>
  </Teleport>
</template>
```

2ï¼‰æ˜¾ç¤ºdialogæ—¶ï¼Œé»˜è®¤é€‰ä¸­

```jsx
<XtxButton class="btn" @click="changeAddress">åˆ‡æ¢åœ°å€</XtxButton>

// æ”¶è´§åœ°å€
const currAddress = ref<UserAddresse>();
// ä¸´æ—¶æ”¶è´§åœ°å€
const tempAddress = ref<UserAddresse>();

// æ‰“å¼€åˆ‡æ¢æ”¶è´§åœ°å€çš„å¯¹è¯æ¡†
const changeAddress = () => {
  tempAddress.value = currAddress.value;
  visible.value = true;
}
```

3ï¼‰å®ç°é€‰ä¸­äº¤äº’æ•ˆæœ

```jsx
// é€šè¿‡idåˆ¤æ–­activeç±»åæ˜¯å¦å­˜åœ¨
<div class="text item"
    v-for="item in checkoutInfo?.userAddresses"
    :key="item.id"
    @click="tempAddress = item"
    :class="{active:tempAddress?.id === item.id}"
    >
</div>
```

3ï¼‰ç¡®å®šæŒ‰é’®ä¹‹åä¿®æ”¹åœ°å€

```vue
<script setup lang="ts">
// ...

// æ‰“å¼€åˆ‡æ¢æ”¶è´§åœ°å€çš„å¯¹è¯æ¡†
const changeAddress = () => {
  // é«˜äº®ä¸´æ—¶åœ°å€
  tempAddress.value = currAddress.value;
  // æ˜¾ç¤ºå¯¹è¯æ¡†
  visible.value = true;
};

// ç‚¹å‡»ç¡®è®¤æ”¶è´§åœ°å€
const confirmAddress = () => {
  // ç¡®è®¤æ”¶è´§åœ°å€
  currAddress.value = tempAddress.value;
  // éšè—å¯¹è¯æ¡†
  visible.value = false;
};
</script>

<template #footer>
  <XtxButton @click="visible = false" type="gray" style="margin-right: 20px">
      å–æ¶ˆ
  </XtxButton>
  <XtxButton @click="confirmAddress" type="primary">ç¡®è®¤</XtxButton>
</template>
```

### æ·»åŠ æ”¶è´§åœ°å€ - è¯¾åç»ƒä¹ 

> `ä»»åŠ¡ç›®æ ‡:`  å®ç°æ”¶è´§åœ°å€çš„æ·»åŠ æ“ä½œ
>
> - æ–°æ³¨å†Œè´¦æˆ·ï¼Œè¿˜æ²¡æœ‰æ”¶è´§åœ°å€ï¼Œæˆ‘ä»¬æ”¯æŒä»–è¿›è¡Œæ”¶è´§åœ°å€çš„æ·»åŠ æ“ä½œã€‚
> - ğŸš¨æ³¨æ„äº‹é¡¹ï¼šä¸€ä¸ªè´¦å·ä¸‹æœ€å¤šåªæœ‰ 10 ä¸ªæ”¶è´§åœ°å€ï¼Œå¦‚æœè¦è¿›è¡Œç»ƒä¹ ï¼Œå¯ä»¥ç”¨ `PostMan` ç­‰æµ‹è¯•å·¥å…·è°ƒç”¨æ¥å£åˆ é™¤åœ°å€åå†æ·»åŠ æ–°åœ°å€ã€‚

![](./media/04-16459815553228.png)

**å®ç°æ€è·¯**

1. å®Œæˆè¡¨å•å¸ƒå±€
2. å®Œæˆç¡®è®¤æ·»åŠ æ“ä½œ

**ä»£ç è½åœ°**

1ï¼‰å‡†å¤‡æ·»åŠ åŠŸèƒ½å¼¹æ¡†

```html
<script setup lang="ts">
//  å‡†å¤‡æ§åˆ¶å¼¹æ¡†å±•ç¤ºçš„å“åº”å¼æ•°æ®
const addVisible = ref(false)
</script>

<template>
  <!-- å¼¹æ¡†å¸ƒå±€ -->
  <XtxDialog title="æ·»åŠ æ”¶è´§åœ°å€" :visible="addVisible" @close="addVisible=false">
    <div class="address-edit">
      <div class="xtx-form">
        <div class="xtx-form-item">
          <div class="label">æ”¶è´§äººï¼š</div>
          <div class="field">
            <input class="input" placeholder="è¯·è¾“å…¥æ”¶è´§äºº" />
          </div>
        </div>
        <div class="xtx-form-item">
          <div class="label">æ‰‹æœºå·ï¼š</div>
          <div class="field">
            <input class="input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
          </div>
        </div>
        <div class="xtx-form-item">
          <div class="label">åœ°åŒºï¼š</div>
          <div class="field">
            <XtxCity placeholder="è¯·é€‰æ‹©æ‰€åœ¨åœ°åŒº" />
          </div>
        </div>
        <div class="xtx-form-item">
          <div class="label">è¯¦ç»†åœ°å€ï¼š</div>
          <div class="field">
            <input class="input" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€" />
          </div>
        </div>
        <div class="xtx-form-item">
          <div class="label">é‚®æ”¿ç¼–ç ï¼š</div>
          <div class="field">
            <input class="input" placeholder="è¯·è¾“å…¥é‚®æ”¿ç¼–ç " />
          </div>
        </div>
        <div class="xtx-form-item">
          <div class="label">åœ°å€æ ‡ç­¾ï¼š</div>
          <div class="field">
            <input class="input" placeholder="è¯·è¾“å…¥åœ°å€æ ‡ç­¾ï¼Œé€—å·åˆ†éš”" />
          </div>
        </div>
      </div>
    </div>
    <template #footer>
      <XtxButton type="gray" style="margin-right: 20px">å–æ¶ˆ</XtxButton>
      <XtxButton type="primary">ç¡®è®¤</XtxButton>
    </template>
  </XtxDialog>
  ...
    
      <!-- ç‚¹å‡»æŒ‰é’®æ‰“å¼€å¼¹æ¡† -->
      <XtxButton class="btn" @click="addVisible = true">æ·»åŠ åœ°å€</XtxButton>
    
</template>


<style scoped lang="less">
// æ ·å¼ä¼˜åŒ–ï¼š
.xtx-city {
  margin-left: 0px;
  /deep/ .select {
    height: 50px;
    line-height: 50px;
  }
  /deep/ .select .value {
    font-size: 14px;
  }
}
</style>
```

2ï¼‰å®ç°è¡¨å•æ•°æ®å’ŒåŒå‘ç»‘å®š

```jsx
 // è¡¨å•æ•°æ®
const addressForm = reactive({
  receiver: '',
  contact: '',
  provinceCode: '',
  cityCode: '',
  countyCode: '',
  address: '',
  postalCode: '',
  addressTags: '',
  isDefault: 0,
  fullLocation: ''
})

// é€‰æ‹©åœ°åŒº
const changeCty = (data) => {
  formData.provinceCode = data.provinceCode
  formData.cityCode = data.cityCode
  formData.countyCode = data.countyCode
  formData.fullLocation = data.fullLocation
}

  <div class="xtx-form">
    <div class="xtx-form-item">
      <div class="label">æ”¶è´§äººï¼š</div>
      <div class="field">
        <input v-model="formData.receiver" class="input" placeholder="è¯·è¾“å…¥æ”¶è´§äºº" />
      </div>
    </div>
    <div class="xtx-form-item">
      <div class="label">æ‰‹æœºå·ï¼š</div>
      <div class="field">
        <input v-model="formData.contact" class="input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
      </div>
    </div>
    <div class="xtx-form-item">
      <div class="label">åœ°åŒºï¼š</div>
      <div class="field">
        <XtxCity placeholder="è¯·é€‰æ‹©æ‰€åœ¨åœ°åŒº"  @change="changeCty"/>
      </div>
    </div>
    <div class="xtx-form-item">
      <div class="label">è¯¦ç»†åœ°å€ï¼š</div>
      <div class="field">
        <input v-model="formData.address" class="input" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€" />
      </div>
    </div>
    <div class="xtx-form-item">
      <div class="label">é‚®æ”¿ç¼–ç ï¼š</div>
      <div class="field">
        <input v-model="formData.postalCode" class="input" placeholder="è¯·è¾“å…¥é‚®æ”¿ç¼–ç " />
      </div>
    </div>
    <div class="xtx-form-item">
      <div class="label">åœ°å€æ ‡ç­¾ï¼š</div>
      <div class="field">
        <input v-model="formData.addressTags" class="input" placeholder="è¯·è¾“å…¥åœ°å€æ ‡ç­¾ï¼Œé€—å·åˆ†éš”" />
      </div>
    </div>
  </div>

```

3ï¼‰å‡†å¤‡æ–°å¢æ¥å£å‡½æ•°`src/api/order.js` 

```js
/**
 * æ·»åŠ æ”¶è´§åœ°å€ä¿¡æ¯
 * @param {Object} address - åœ°å€å¯¹è±¡
 */
export const reqAddAddress = (address) => request('/member/address', 'post', address)

/**
 * è·å–æ”¶è´§åœ°å€åˆ—è¡¨
 */
export const reqFindAddAddress = () => {
  return request('/member/address', 'get')
}
```

4ï¼‰è°ƒç”¨æ¥å£å®Œæˆæ–°å¢

```js
// æäº¤æ“ä½œ
const submit = async () => {
  // æ·»åŠ æ”¶è´§åœ°å€
  await reqAddAddress(addressForm)
  message({ type: 'success', text: 'æ–°å¢åœ°å€æˆåŠŸ' })
  addVisible.value = false
  // æ›´æ–°æ”¶è´§åœ°å€åˆ—è¡¨
  const { result } = await reqFindAddAddress()
  checkoutInfo.value.userAddresses = result
}
```



## æäº¤è®¢å•

`ä»»åŠ¡ç›®æ ‡:`  æ±‡æ€»æäº¤è®¢å•éœ€è¦çš„æ•°æ®ï¼Œè¿›è¡Œæäº¤

**å®ç°æ­¥éª¤**

1. ç»‘å®šæäº¤è®¢å•ç‚¹å‡»äº‹ä»¶ï¼Œæ”¶é›†åç«¯æ‰€éœ€æ•°æ®å¯¹è±¡ï¼Œè¿›è¡Œæäº¤å³å¯ã€‚
2. æäº¤æˆåŠŸä¹‹åï¼Œæç¤ºç”¨æˆ·
3. ğŸš¨**é‡æ–°æ‹‰å–ä¸€ä¸‹è´­ç‰©è½¦åˆ—è¡¨**
4. è·³è½¬åˆ°æ”¯ä»˜é¡µã€‚

**ä»£ç è½åœ°**



### æ¥å£ï¼šæäº¤è®¢å•

**åŸºæœ¬ä¿¡æ¯**

**Pathï¼š** /member/order

**Methodï¼š** POST

**æ¥å£æè¿°ï¼š**

**Body**

| åç§°             | ç±»å‹      | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨                                                         | å…¶ä»–ä¿¡æ¯          |
| ---------------- | --------- | -------- | ------ | ------------------------------------------------------------ | ----------------- |
| goods            | object [] | å¿…é¡»     |        | å•†å“é›†åˆ                                                     | item ç±»å‹: object |
| â”œâ”€ skuId         | string    | å¿…é¡»     |        | skuId                                                        |                   |
| â”œâ”€ count         | integer   | å¿…é¡»     |        | æ•°é‡                                                         |                   |
| addressId        | string    | å¿…é¡»     |        | æ‰€é€‰åœ°å€Id                                                   |                   |
| deliveryTimeType | integer   | å¿…é¡»     |        | é…é€æ—¶é—´ç±»å‹ï¼Œ1ä¸ºä¸é™ï¼Œ2ä¸ºå·¥ä½œæ—¥ï¼Œ3ä¸ºåŒä¼‘æˆ–å‡æ—¥              |                   |
| payType          | integer   | å¿…é¡»     |        | æ”¯ä»˜æ–¹å¼ï¼Œ1ä¸ºåœ¨çº¿æ”¯ä»˜ï¼Œ2ä¸ºè´§åˆ°ä»˜æ¬¾                           |                   |
| payChannel       | integer   | å¿…é¡»     |        | æ”¯ä»˜æ¸ é“ï¼šæ”¯ä»˜æ¸ é“ï¼Œ1æ”¯ä»˜å®ã€2å¾®ä¿¡--æ”¯ä»˜æ–¹å¼ä¸ºåœ¨çº¿æ”¯ä»˜æ—¶ï¼Œä¼ å€¼ï¼Œä¸ºè´§åˆ°ä»˜æ¬¾æ—¶ï¼Œä¸ä¼ å€¼ |                   |
| buyerMessage     | string    | å¿…é¡»     |        | ä¹°å®¶ç•™è¨€                                                     |                   |

### å®Œæˆæäº¤è®¢å•ä¸šåŠ¡

æ·»åŠ  actions 

```ts
  actions: {
    // æäº¤è®¢å•(åˆ›å»ºè®¢å•)
    async createOrder(data: object) {
      // åˆ›å»ºè®¢å•
      const res = await http('POST', '/member/order', data);
      console.log('POST', '/member/order', res);
      // æˆåŠŸæé†’ç”¨æˆ·
      message({ type: 'success', text: 'ä¸‹å•æˆåŠŸ~' });
      // ğŸ””åˆ·æ–°è´­ç‰©è½¦åˆ—è¡¨
      const { cart } = useStore();
      cart.getCartList();
      // è·³è½¬åˆ°æ”¯ä»˜é¡µå¹¶ä¼ é€’è®¢å• id
      router.push('/member/pay?')
    },
  },
```

ç‚¹å‡»æäº¤è®¢å•æŒ‰é’®

```vue
<script setup lang="ts">
// ç‚¹å‡»æäº¤è®¢å•æŒ‰é’®
const submitCheckout = async () => {
  // æ²¡æœ‰æ”¶è´§åœ°å€æç¤º
  if (!currAddress.value.id) {
    return message({ type: "warn", text: "è¯·é€‰æ‹©æ”¶è´§åœ°å€" });
  }
  // å‡†å¤‡æäº¤è®¢å•åç«¯æ‰€éœ€å‚æ•°
  const data = {
    // å•†å“é›†åˆ
    goods: checkoutInfo.value.goods.map(({ skuId, count }) => ({
      skuId,
      count,
    })),
    // æ‰€é€‰åœ°å€ id
    addressId: currAddress.value.id,
    // å…¶ä»–å­—æ®µæ¯”è¾ƒç®€å•å°±ä¸é¢å¤–å¤„ç†äº†
    deliveryTimeType: 1,
    payType: 1,
    payChannel: 1,
    buyerMessage: "ä¹°å®¶ç•™è¨€",
  };
  // æäº¤è®¢å•
  order.createOrder(data)
};
</script>


<template>
  ...
      <XtxButton type="primary" @click="submitCheckout">æäº¤è®¢å•</XtxButton>
  ...
</template>
```

ğŸ‰ åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ç»“ç®—é¡µé¢çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ­£å¼çš„æ”¯ä»˜ç¯èŠ‚äº†ã€‚

