# æ‰©å±•è¡¥å……

## Vite æ’ä»¶ script setup name

> è¯´æ˜ï¼šä¸€æ¬¾èƒ½è®© script setup æ·»åŠ ç»„ä»¶å name çš„æ’ä»¶ã€‚

æ’ä»¶åœ°å€ï¼šhttps://github.com/vbenjs/vite-plugin-vue-setup-extend

é—®é¢˜ï¼šhttps://github.com/vuejs/vue/issues/12263

é—®é¢˜ï¼šhttps://github.com/vuejs/vue/issues/12178

- å®‰è£…æ’ä»¶

```sh
yarn add vite-plugin-vue-setup-extend -D
```

- é…ç½®æ’ä»¶ï¼š`vite.config.ts`

```diff
import { defineConfig, Plugin } from 'vite'
import vue from '@vitejs/plugin-vue'
+ import vueSetupExtend from 'vite-plugin-vue-setup-extend'

export default defineConfig({
  plugins: [
    vue(), 
+   vueSetupExtend()
  ],
})
```

- ç»„ä»¶ä¸­ä½¿ç”¨

```diff
+ <script setup lang="ts" name="App">
+ // 
+ </script>

-<script lang="ts">
-export default {
-  name: "App"
-}
-<script/>

<template>
  <div>Hello App Name </div>
</template>
```



## é¡¹ç›®æ‰“åŒ…ã€é¢„è§ˆã€éƒ¨ç½²

æ‹“å±•é˜…è¯»ï¼š[Viteå®˜æ–¹æ–‡æ¡£](https://cn.vitejs.dev/guide/static-deploy.html)

### é¡¹ç›®æ‰“åŒ…

> æœ¬èŠ‚ç›®æ ‡ï¼šçŸ¥é“æ‰“åŒ…å‘½ä»¤åšäº†å“ªäº›å·¥ä½œï¼Œäº†è§£æœ¬åœ°é¢„è§ˆã€‚

**æ‰“åŒ…æ„å»º**

```sh
yarn build
```

- `vue-tsc` å®‰å…¨æ£€æŸ¥ã€‚
- æ‰“åŒ…æ–‡ä»¶å¹¶è¿›è¡Œä»£ç å‹ç¼©ã€‚

**æœ¬åœ°é¢„è§ˆ**

```
yarn preview
```



### é¡¹ç›®éƒ¨ç½²

è¯´æ˜ï¼šä¸ºäº†ä½“éªŒéƒ¨ç½²æµç¨‹ï¼Œæˆ‘ä»¬æŠŠé¡¹ç›®éƒ¨ç½²åˆ°ç äº‘ `GiteePages`ã€‚

ğŸš¨æ³¨æ„ï¼šå·¥ä½œä¸­ä¸€èˆ¬ç”±è¿è¥è´Ÿè´£éƒ¨ç½²ï¼Œéƒ¨ç½²åˆ°å…¬å¸çš„æœåŠ¡å™¨ã€‚

1. åœ¨ `vite.config.ts` ä¸­è®¾ç½®æ­£ç¡®çš„ `base`ã€‚

```diff
export default defineConfig({
+  base: "./", // è®¾ç½®æ‰“åŒ…è·¯å¾„ï¼Œéƒ¨ç½²åˆ° GiteePages éœ€è¦ç›¸å¯¹äºä»“åº“è·¯å¾„
   ...
});

```

2. æ–°å»º `deloy.sh`  éƒ¨ç½²è„šæœ¬

```sh
#!/usr/bin/env sh

# ç¡®ä¿è„šæœ¬æŠ›å‡ºé‡åˆ°çš„é”™è¯¯
set -e

# ç”Ÿæˆé™æ€æ–‡ä»¶
npm run build

# è¿›å…¥ç”Ÿæˆçš„æ–‡ä»¶å¤¹
cd dist

# å¦‚æœæ˜¯å‘å¸ƒåˆ°è‡ªå®šä¹‰åŸŸå
# echo 'www.example.com' > CNAME

git init
git add -A
git commit -m 'deploy'

# å¦‚æœå‘å¸ƒåˆ° https://<USERNAME>.github.io/<REPO>
# git push -f git@gitee.com:<USERNAME>/<REPO>.git master:gh-pages
git push -f git@gitee.com:Megasu/rabbit-vue3-ts.git master:gh-pages

cd -
```

3. è¿è¡Œ `deploy.sh`
4. åœ¨ç äº‘éƒ¨ç½² `gh-pages` åˆ†æ”¯ã€‚

## çŸ¥è¯†ç‚¹æ‹“å±•è¡¥å……

### å¤„ç†å¼‚æ­¥è¯·æ±‚æ¸²æŸ“ - Suspense

æˆ‘ä»¬æ—¶å¸¸éœ€è¦ï¼šåˆ¤æ–­å¼‚æ­¥è¯·æ±‚çš„çŠ¶æ€ï¼Œç„¶åï¼Œæ ¹æ®è¿™äº›è¯·æ±‚æ¥å±•ç¤ºä¸åŒçš„ç•Œé¢  =>  Suspense éå¸¸æ–¹ä¾¿

`vue3` æ¨å‡ºäº†ä¸€ä¸ªæ–°çš„å†…ç½®ç»„ä»¶ `Suspense` ï¼Œ `Suspense` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»„ä»¶ã€‚

è¯´æ˜ï¼š

- å®ƒä¼šæœ‰ä¸¤ä¸ª `template slot` ï¼Œåˆšå¼€å§‹ä¼šæ¸²æŸ“ `feedback` å†…å®¹ï¼Œç›´åˆ°**è¾¾åˆ°æŸä¸ªæ¡ä»¶ä»¥å**ï¼Œæ‰ä¼šæ¸²æŸ“æ­£å¼çš„å†…å®¹ï¼Œ
- ä¹Ÿå°±æ˜¯ default çš„å†…å®¹ã€‚è¿™æ ·å‘¢ï¼Œè¿›è¡Œå¼‚æ­¥å†…å®¹çš„æ¸²æŸ“å°±ä¼šå˜å¾—ç‰¹åˆ«ç®€å•ã€‚

#### åŠŸèƒ½1ï¼šå¼‚æ­¥ setup ï¼ˆæ”¯æŒé¡¶å±‚ awaitï¼‰

æ–°å»ºï¼šsetup é¡¶å±‚ await ç»„ä»¶ï¼š `TopAwaitCom.vue`

```vue
<script setup lang="ts">
import { http } from '@/utils/request';

// ğŸš¨ é¡¶å±‚ await ä»¥å‰æ˜¯ä¸èƒ½æ¸²æŸ“å‡ºç»„ä»¶å†…å®¹çš„ï¼Œæ‰€æœ‰çš„æ•°æ®ç›¸å½“äºéƒ½è¢« Promise åŒ…è£…è¿‡
const res = await http('GET', '/home/banner');
console.log(res.data.result);
</script>

<template>
  <h1>æˆ‘æ˜¯é¡¶å±‚ await ç»„ä»¶</h1>
</template>

```

å¯¼å…¥ä½¿ç”¨ï¼Œä½†éœ€è¦å¥—ä¸Š `Suspense` ç»„ä»¶ã€‚

```diff
<script setup lang="ts">
import { defineAsyncComponent } from "vue";
import TopAwaitCom from "./TopAwaitCom.vue";
</script>

<template>
+  <Suspense
     <TopAwaitCom />
+    <template #fallback>
+      <h1>Loading...</h1>
+    </template>
+  </Suspense>
</template>

```



#### åŠŸèƒ½2ï¼šå¼‚æ­¥ç»„ä»¶åŠ è½½

```html
<script setup lang="ts">
import { defineAsyncComponent } from "vue";

// ç›´æ¥åŠ è½½ç»„ä»¶
// import TestAsyncCom from "./TestCom.vue";
// å¼‚æ­¥åŠ è½½ç»„ä»¶
const TestAsyncCom = () => import("./TestCom.vue");
</script>

<template>
  <Suspense>
    <template #default>
      <TestAsyncCom />
    </template>
    <template #fallback>
      <h1>Loading...</h1>
    </template>
  </Suspense>
</template>
```





## Vue3 å“åº”å¼åŸç†

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h2>åŒå‘ç»‘å®š</h2>
    <input type="text" value="" />
    <button>ç‚¹å‡»æ”¹å</button>
    <script>
      // ç›®æ ‡å¯¹è±¡
      const obj = reactive({ name: 'zs', age: 18 });

      function reactive(obj) {
        // ç›®æ ‡å¯¹è±¡çš„ä»£ç†
        return new Proxy(obj, {
          get(...args) {
            // return obj[prop];
            return Reflect.get(...args);
          },
          set(obj, prop, value) {
            // obj[prop] = value;
            Reflect.set(obj, prop, value);
            document.querySelector('h2').innerHTML = JSON.stringify(obj);
            input.value = value;
          },
        });
      }

      console.log(obj);

      const input = document.querySelector('input');
      input.addEventListener('input', (e) => {
        obj.name = e.target.value;
      });

      const button = document.querySelector('button');
      button.addEventListener('click', () => {
        obj.name += 'å‘€';
      });
    </script>
  </body>
</html>

```

## Reflect å¯¹è±¡

**Reflect** å¯¹è±¡æ˜¯ `ES6` ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° `API`ï¼Œ`Reflect` æä¾›çš„é™æ€æ–¹æ³•è®©å¯¹è±¡çš„æ“ä½œæ›´åŠ è§„èŒƒç»Ÿä¸€ã€‚

### TS éå†å¯¹è±¡

ğŸ”” ç»éªŒï¼š åœ¨ TS é¡¹ç›®ä¸­ï¼Œå¯¹è±¡éå†é…åˆ `Reflect` ä¼šæ›´é¦™ï¼Œç”¨ `obj[key]` å†™æ³•ä¼š TS é¡¹ç›®æŠ¥é”™ã€‚

[Reflect-MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect)

[Reflect-é˜®ä¸€å³°](https://es6.ruanyifeng.com/#docs/reflect)

|              | Reflect è°ƒç”¨                       | ä¼ ç»Ÿæ“ä½œ           |
| ------------ | ---------------------------------- | ------------------ |
| è·å–         | `Reflect.get(obj, key)`            | `obj[key]`         |
| è®¾ç½®         | `Reflect.set(obj, key, value)`     | `obj[key] = value` |
| åˆ é™¤         | `Reflect.deleteProperty(obj, key)` | `delete obj[key]`  |
| åˆ¤æ–­æ˜¯å¦å­˜åœ¨ | `Reflect.has(obj, key)`            | `key in obj`       |

ä»£ç å†™æ³•å‡çº§ï¼š`src\store\modules\cart.ts`

```ts
// ğŸ› TS éå†å¯¹è±¡ï¼Œé€šè¿‡ lastCartInfo[key] è·å–å’Œä¿®æ”¹å¯¹è±¡ä¼šæŠ¥é”™: key ä¸º any
for (const key in lastCartInfo) {
    // è·å– value
    const value = Reflect.get(lastCartInfo, key);
}
```

### Reflect ä¸ Proxy

`Reflect` å¯é…åˆ `Proxy` ä½¿ç”¨ï¼Œ`Vue3` çš„ `reactive` å‡½æ•°çš„æºç æœ‰åº”ç”¨ã€‚

[reactiveå‡½æ•°æºç è§£è¯»](https://juejin.cn/post/6844903969894973448)





## `JSX/TSX`  åŸºç¡€-ReactåŸºç¡€

### æ¦‚è¿°

`TSX/JSX` è¯­æ³•ç³–ï¼ˆ`React` å›¢é˜Ÿè®¾è®¡å‘æ˜çš„ï¼Œ`Vue` ä¹Ÿè¿›è¡Œäº†æ”¯æŒï¼‰

1. åœ¨ `Vue3` ä¸­å…¶å®å°±æ˜¯`createVNode` çš„è¯­æ³•ç³–ï¼Œè´Ÿè´£åˆ›å»ºè™šæ‹ŸDOMç”¨çš„ã€‚åº•å±‚ä¾èµ– `babel` æ’ä»¶æ”¯æŒã€‚
2. æˆ‘ä»¬åœ¨ Test ç»„ä»¶ä¸­ï¼Œæ¼”ç¤º `jsx/tsx` è¯­æ³•ã€‚



### æ²¡æœ‰ `jsx/tsx` åˆ›å»ºè™šæ‹ŸDOM

ä»£ç æ¼”ç¤º1ï¼š

```html
<script setup lang="ts">
import { createVNode } from 'vue';

const VDOM = createVNode('h1', { id: 'box' }, 'hello');
</script>

<template>
  <VDOM />
</template>
```

ä»£ç æ¼”ç¤º2ï¼š

```html
<script setup lang="ts">
import { createVNode } from 'vue';

const VDOM = createVNode("div", { id: "box" }, [
      createVNode("p", {}, "æˆ‘æ˜¯ä¸€ä¸ªæ®µè½1"),
      createVNode("p", {}, "æˆ‘æ˜¯ä¸€ä¸ªæ®µè½2"),
    ]);
</script>
```

æ€è€ƒï¼šæ¸²æŸ“ä»¥ä¸‹ç»“æ„ï¼Ÿ

```jsx
<ul>
  <li>111</li>
  <li>222</li>
  <li>333</li>
  <li>444</li>
</ul>
```

å†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•çš„å†™æ³•å‘¢ï¼Ÿ



### æœ‰ `jsx/tsx` åˆ›å»ºè™šæ‹ŸDOM

> æœ¬èŠ‚ç›®æ ‡ï¼šsetup ä¸­å¯ä»¥ä¹¦å†™å“åº”å¼æ•°æ®ï¼Œç”¨äºç»‘å®šåˆ° `tsx/jsx` ç»“æ„ä¸­ã€‚

åŸºç¡€ç”¨æ³•

```vue
<script setup lang="tsx">
const VDOM = () => <h1>Hello TSX in Setup</h1>;
</script>

<template>
  <VDOM />
</template>
```



### TSX çš„è¿›é˜¶ç”¨æ³•

> æœ¬èŠ‚ç›®æ ‡ï¼šå†…å®¹ç»‘å®šï¼Œå±æ€§ç»‘å®šï¼Œäº‹ä»¶ç»‘å®šï¼Œæ¡ä»¶æ¸²æŸ“ï¼Œåˆ—è¡¨æ¸²æŸ“ã€‚

```vue
<script setup lang="tsx">
import { ref } from "vue";

const count = ref(0);
const isHide = ref(true);
const add = () => {
  count.value += 1;
};
const list = ref([
  { id: 1, content: "åƒé¥­", done: true },
  { id: 2, content: "ç¡è§‰", done: false },
  { id: 3, content: "æ‰“ä»£ç ", done: true },
]);
// script - æ•°æ®ç»‘å®šåœ¨ JSX ç”¨ä¸€å¯¹èŠ±æ‹¬å·
const VDOM = () => {
  return (
    <div>
      <h1>Hello TSX in Setup</h1>
      <p>{count.value}</p>
      <button onClick={add}>ç‚¹å‡»+1</button>
      <button
        onClick={() => {
          isHide.value = !isHide.value;
        }}
      >
        åˆ‡æ¢æ˜¾ç¤ºéšè—
      </button>
      <h2>æ¡ä»¶æ¸²æŸ“</h2>
      {isHide.value ? <div>loading</div> : <div>ç»“æ„2</div>}
      <h2>åˆ—è¡¨æ¸²æŸ“</h2>
      <ul>
        {list.value.map((item) => (
          <li key={item.id}>{item.content}</li>
        ))}
      </ul>
    </div>
  );
};
</script>

<template>
  <VDOM />
</template>
```

### å‡½æ•°å¼ç»„ä»¶

`Vue3` ä¹Ÿæ”¯æŒå‡½æ•°å¼ç»„ä»¶ï¼Œå¯é€šè¿‡ `.tsx/.jsx` åç¼€åæ–‡ä»¶åˆ›å»ºç»„ä»¶ï¼Œå†™æ³•éå¸¸ç±»ä¼¼ `React` çš„å‡½æ•°å¼ç»„ä»¶è¯­æ³•ã€‚

ç°åœ¨ `JSX/TSX` å†™æ³•å¤§å®¶çœ‹ä¸æ‡‚ï¼Œå­¦å®Œ `React` åçœ‹èµ·æ¥å°±è½»æ¾äº† ã€‚

ç”±äº `JSX/TSX` ä¸æ˜¯ `Vue` çš„ä¸»æµè¯­æ³•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£å³å¯ã€‚

æ‹“å±•é˜…è¯»ï¼šhttps://juejin.cn/post/7007731144418394149