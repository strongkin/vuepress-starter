#  è¯¦æƒ…æ¨¡å—

> ç›®æ ‡ï¼šç•Œé¢æ¸²æŸ“éƒ¨åˆ†æˆ‘ä»¬å¿«é€Ÿå‡†å¤‡ï¼Œè¯¦æƒ…æ¨¡å—çš„é‡ç‚¹éƒ½åœ¨ç»„ä»¶å°è£…ã€‚

##  åŸºç¡€å¸ƒå±€å’Œè·¯ç”±

`ä»»åŠ¡ç›®æ ‡:`   å®Œæˆå•†å“è¯¦æƒ…çš„åŸºç¡€å¸ƒå±€å’Œè·¯ç”±é…ç½®

![](./media/01-16459812143554.png)

1ï¼‰æ–°å»ºé¡µé¢ç»„ä»¶

`src/views/Goods/index.vue`

```vue
<script setup lang="ts">
//
</script>

<template>
  <div class="xtx-goods-page">
    <div class="container">
      <!-- å•†å“ä¿¡æ¯ -->
      <div class="goods-info">
        <!-- å›¾ç‰‡é¢„è§ˆåŒº -->
        <div class="./media"></div>
        <!-- å•†å“ä¿¡æ¯åŒº -->
        <div class="spec"></div>
      </div>
      <!-- å•†å“è¯¦æƒ… -->
      <div class="goods-footer">
        <div class="goods-article">
          <!-- å•†å“è¯¦æƒ… -->
          <div class="goods-tabs"></div>
        </div>
        <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
        <div class="goods-aside"></div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.container {
  margin-top: 20px;
}
.goods-info {
  min-height: 600px;
  background: #fff;
  display: flex;
  ../media {
    width: 580px;
    height: 600px;
    padding: 30px 50px;
  }
  .spec {
    flex: 1;
    padding: 30px 30px 30px 0;
  }
}
.goods-footer {
  display: flex;
  margin-top: 20px;
  .goods-article {
    width: 940px;
    margin-right: 20px;
  }
  .goods-aside {
    width: 280px;
    min-height: 1000px;
  }
}
.goods-tabs {
  min-height: 600px;
  background: #fff;
}
.goods-warn {
  min-height: 600px;
  background: #fff;
  margin-top: 20px;
}
</style>

```

2ï¼‰è·¯ç”±é…ç½®

`src/router/index.ts`

```js
const routes = [
  {
    path: '/',
    component: Layout,
    children: [
      // ...
      {
        path: '/goods/:id',
        component: () => import('@/views/Goods/index.vue')
      }
    ]
  }
]
```

3ï¼‰æµ‹è¯•è·¯ç”±è·³è½¬



## è·å–å•†å“è¯¦æƒ…æ•°æ®

### æ­¥éª¤

1. è·å–è·¯ç”± id å‚æ•°

2. åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ axios å‘é€è¯·æ±‚

3. å‡†å¤‡ TS ç±»å‹å£°æ˜æ–‡ä»¶

4. ä¿å­˜åç«¯è¿”å›æ•°æ®ï¼Œå¹¶æŒ‡å®šTSç±»å‹(æœ‰æ›´å¥½çš„æç¤º)

### å•†å“è¯¦æƒ…æ¥å£

**åŸºæœ¬ä¿¡æ¯**

**Pathï¼š** /goods

**Methodï¼š** GET

**æ¥å£æè¿°ï¼š**

è§„æ ¼é›†åˆä¸€å®šè¦å’Œ `skus` é›†åˆä¸‹çš„ `specs` é¡ºåºä¿æŒä¸€è‡´

**è¯·æ±‚å‚æ•°**

**Query**

| å‚æ•°åç§° | æ˜¯å¦å¿…é¡» | ç¤ºä¾‹    | å¤‡æ³¨   |
| -------- | -------- | ------- | ------ |
| id       | æ˜¯       | 3995885 | å•†å“id |

### å‘é€è¯·æ±‚

**å®ç°æ­¥éª¤**

1. åœ¨ç»„ä»¶setupä¸­è·å–å•†å“è¯¦æƒ…æ•°æ®

```vue
<script setup lang="ts">
import { http } from "@/utils/request";
import { onMounted } from "vue";
import { useRoute } from "vue-router";

const route = useRoute();
const { id } = route.params;
onMounted(async () => {
  const res = await http("GET", "/goods", { id: id });
  console.log("/goods", res.data.result);
});
</script>
```

### å®šä¹‰ TS ç±»å‹

æ–°å»ºç±»å‹å£°æ˜æ–‡ä»¶ï¼š`src/types/api/goods.d.ts`

```js
// ç»Ÿä¸€å…ˆä½¿ç”¨ Sku ç»„ä»¶ä¸­å®šä¹‰çš„å•†å“è¯¦æƒ…ç±»å‹
export * from "@/components/XtxUI/Sku/goods";
```

ç±»å‹å‡ºå£ç»‘å®šï¼š`src\types\index.d.ts`

```diff
// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ç±»å‹æ–‡ä»¶
export * from "./api/home";
export * from "./api/category";
+ export * from "./api/goods";
```

ç»„ä»¶ä¸­åº”ç”¨ç±»å‹

`src/views/goods/index.vue`

```vue
<script setup lang="ts">
import { http } from "@/utils/request";
import { onMounted, ref } from "vue";
import { useRoute } from "vue-router";
import type { GoodsDetail } from "@/types";

const route = useRoute();
const { id } = route.params;
const goods = ref<GoodsDetail>();
onMounted(async () => {
  const res = await http<GoodsDetail>("GET", "/goods", { id: id });
  console.log("/goods", res.data.result);
  goods.value = res.data.result;
});
</script>
```



## å•†å“ä¿¡æ¯æ¸²æŸ“

![](./media/24.png)

### é™æ€ç»“æ„å‡†å¤‡-CV

`src\views\Goods\index.vue`

```vue
<template>
  <div class="xtx-goods-page">
    <div class="container">
      <!-- å•†å“ä¿¡æ¯ -->
      <div class="goods-info">
        <div class="./media">
          <!-- å›¾ç‰‡é¢„è§ˆåŒº -->
          <div class="goods-image">
            <!-- å›¾ç‰‡é¢„è§ˆç»„ä»¶ -->
          </div>
          <!-- ç»Ÿè®¡æ•°é‡ -->
          <ul class="goods-sales">
            <li>
              <p>é”€é‡äººæ°”</p>
              <p>100+</p>
              <p><i class="iconfont icon-task-filling"></i>é”€é‡äººæ°”</p>
            </li>
            <li>
              <p>å•†å“è¯„ä»·</p>
              <p>200+</p>
              <p><i class="iconfont icon-comment-filling"></i>æŸ¥çœ‹è¯„ä»·</p>
            </li>
            <li>
              <p>æ”¶è—äººæ°”</p>
              <p>80+</p>
              <p><i class="iconfont icon-favorite-filling"></i>æ”¶è—å•†å“</p>
            </li>
            <li>
              <p>å“ç‰Œä¿¡æ¯</p>
              <p>90+</p>
              <p><i class="iconfont icon-dynamic-filling"></i>å“ç‰Œä¸»é¡µ</p>
            </li>
          </ul>
        </div>
        <!-- å•†å“ä¿¡æ¯åŒº -->
        <div class="spec">
          <!-- å•†å“ä¸»è¦ä¿¡æ¯ -->
          <div class="goods-main">
            <p class="g-name">è¿™æ˜¯å•†å“æ ‡é¢˜</p>
            <p class="g-desc">è¿™æ˜¯å•†å“æè¿°</p>
            <p class="g-desc">è¿™æ˜¯é€‰ä¸­çš„å•†å“è§„æ ¼</p>
            <p class="g-price">
              <span>å•†å“ç°åœ¨çš„ä»·é’±</span>
              <span>å•†å“åŸæ¥çš„ä»·æ ¼</span>
            </p>
            <div class="g-service">
              <dl>
                <dt>ä¿ƒé”€</dt>
                <dd>12æœˆå¥½ç‰©æ”¾é€ï¼ŒAppé¢†åˆ¸è´­ä¹°ç›´é™120å…ƒ</dd>
              </dl>
              <dl>
                <dt>é…é€</dt>
                <dd>è‡³</dd>
                <dd>
                  <XtxCity />
                </dd>
              </dl>
              <dl>
                <dt>æœåŠ¡</dt>
                <dd>
                  <span>æ— å¿§é€€è´§</span>
                  <span>å¿«é€Ÿé€€æ¬¾</span>
                  <span>å…è´¹åŒ…é‚®</span>
                  <a href="javascript:;">äº†è§£è¯¦æƒ…</a>
                </dd>
              </dl>
            </div>
          </div>
          <!-- è§„æ ¼é€‰æ‹©ç»„ä»¶ -->
          <!-- æ•°é‡é€‰æ‹©ç»„ä»¶ -->
          <!-- æŒ‰é’®ç»„ä»¶ -->
        </div>
      </div>
      <!-- å•†å“è¯¦æƒ… -->
      <div class="goods-footer">
        <div class="goods-article">
          <!-- å•†å“è¯¦æƒ… -->
          <div class="goods-tabs"></div>
        </div>
        <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
        <div class="goods-aside"></div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.container {
  margin-top: 20px;
}

// å•†å“ä¿¡æ¯
.goods-info {
  min-height: 600px;
  background: #fff;
  display: flex;
  ../media {
    width: 580px;
    height: 600px;
    padding: 30px 50px;
  }
  .spec {
    flex: 1;
    padding: 30px 30px 30px 0;
  }
}

// å›¾ç‰‡é¢„è§ˆåŒº
.goods-image {
  width: 480px;
  height: 400px;
  background-color: #eee;
}

// ç»Ÿè®¡æ•°é‡
.goods-sales {
  display: flex;
  width: 400px;
  align-items: center;
  text-align: center;
  height: 140px;
  li {
    flex: 1;
    position: relative;
    ~ li::after {
      position: absolute;
      top: 10px;
      left: 0;
      height: 60px;
      border-left: 1px solid #e4e4e4;
      content: "";
    }
    p {
      &:first-child {
        color: #999;
      }
      &:nth-child(2) {
        color: @priceColor;
        margin-top: 10px;
      }
      &:last-child {
        color: #666;
        margin-top: 10px;
        i {
          color: @xtxColor;
          font-size: 14px;
          margin-right: 2px;
        }
        &:hover {
          color: @xtxColor;
          cursor: pointer;
        }
      }
    }
  }
}

// å•†å“ä¿¡æ¯åŒº
.spec {
  .g-name {
    font-size: 22px;
  }
  .g-desc {
    color: #999;
    margin-top: 10px;
  }
  .g-price {
    margin-top: 10px;
    span {
      &::before {
        content: "Â¥";
        font-size: 14px;
      }
      &:first-child {
        color: @priceColor;
        margin-right: 10px;
        font-size: 22px;
      }
      &:last-child {
        color: #999;
        text-decoration: line-through;
        font-size: 16px;
      }
    }
  }
  .g-service {
    background: #f5f5f5;
    width: 500px;
    padding: 20px 10px 0 10px;
    margin-top: 10px;
    dl {
      padding-bottom: 20px;
      display: flex;
      align-items: center;
      dt {
        width: 50px;
        color: #999;
      }
      dd {
        color: #666;
        &:last-child {
          span {
            margin-right: 10px;
            &::before {
              content: "â€¢";
              color: @xtxColor;
              margin-right: 2px;
            }
          }
          a {
            color: @xtxColor;
          }
        }
      }
    }
  }
}

.goods-footer {
  display: flex;
  margin-top: 20px;
  .goods-article {
    width: 940px;
    margin-right: 20px;
  }
  .goods-aside {
    width: 280px;
    min-height: 1000px;
  }
}
.goods-tabs {
  min-height: 600px;
  background: #fff;
}
.goods-warn {
  min-height: 600px;
  background: #fff;
  margin-top: 20px;
}
</style>

```



### å•†å“ä¿¡æ¯æ¸²æŸ“

`ä»»åŠ¡ç›®æ ‡:`  æŒ‰ç…§åŠŸèƒ½æ¸²æŸ“å•†å“ä¿¡æ¯ã€‚

![](./media/24-16459812306155.png)

å•†å“ä¿¡æ¯åŒº

```html
  <!-- å•†å“ä¿¡æ¯åŒº -->
  <div class="spec">
    <div class="goods-main">
      <p class="g-name">{{ goods.name }}</p>
      <p class="g-desc">{{ goods.desc }}</p>
      <p class="g-desc">è¿™æ˜¯é€‰ä¸­çš„å•†å“è§„æ ¼</p>
      <p class="g-price">
        <span>{{ goods.price }}</span>
        <span>{{ goods.oldPrice }}</span>
      </p>
    ...
```

### å›¾ç‰‡é¢„è§ˆå®ç°

![](./media/05-1627767527526.png)

`ä»»åŠ¡ç›®æ ‡:`  é€šè¿‡å›¾ç‰‡é¢„è§ˆç»„ä»¶ï¼Œå®ç°å•†å“å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ã€‚

```html
<!-- å›¾ç‰‡é¢„è§ˆåŒº -->
<div class="./media">
  <!-- å›¾ç‰‡é¢„è§ˆåŒº -->
  <XtxImageView :image-list="goods.mainPictures" />
</div>
```



### æ·»åŠ  loading æ•ˆæœ

- ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œå•†å“æ•°æ®åœ¨æ¸²æŸ“æ˜¯æ·»åŠ  `v-if` æ¡ä»¶ï¼Œä½¿ç”¨æ•°æ®æ—¶çœç•¥å¤§é‡çš„  `?.` å†™æ³•ã€‚

- åŒæ—¶å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œæ·»åŠ  `loading` æ•ˆæœã€‚

```diff
<template>
  <div class="xtx-goods-page">
    <div class="container">
      <!-- å•†å“ä¿¡æ¯ -->
-      <div class="goods-info">
+      <div v-if="goods" class="goods-info">
       ...
+      <div v-else class="goods-info xtx-loading"></div>
    ...
</template>

<style scoped lang="less">
// ...
+ .xtx-loading {
+   background: #fff url(@/assets/images/loading.gif) no-repeat center;
+ }
</style>
```



## æŒ‰é’®ç»„ä»¶å®ç°ğŸš¨

å…ˆç›´æ¥ä½¿ç”¨ç»„ä»¶åº“æä¾›çš„ç»„ä»¶ï¼Œå°è¯•è‡ªå·±å®ç° `Button` ç»„ä»¶çš„å°è£…ã€‚

```html
<!-- æŒ‰é’®ç»„ä»¶ -->
<XtxButton type="primary" size="middle" style="margin-top: 20px">
    åŠ å…¥è´­ç‰©è½¦
</XtxButton>
```

### æŒ‰é’®ç»„ä»¶å¼€å‘æ­¥éª¤

1. å‡†å¤‡é™æ€ç»“æ„
2. åˆ†ææŒ‰é’®ç»„ä»¶çš„è‡ªå®šä¹‰å±æ€§
3. `defineProps` å®šä¹‰ Props æ¥æ”¶å€¼
4.  æ¨¡æ¿ä¸­ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„å€¼è®¾ç½®æŒ‰é’®æ ·å¼

### é™æ€ç»“æ„-CV

```vue
<script setup lang="ts">
// æ­¥éª¤ï¼š
// 1. å‡†å¤‡é™æ€ç»“æ„
// 2. åˆ†ææŒ‰é’®ç»„ä»¶çš„è‡ªå®šä¹‰å±æ€§
// 3. `defineProps` å®šä¹‰ Props æ¥æ”¶å€¼
// 4. æ¨¡æ¿ä¸­ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„å€¼è®¾ç½®æŒ‰é’®æ ·å¼
</script>

<template>
  <button class="xtx-button ellipsis" :class="`middle default`">
    <slot></slot>
  </button>
</template>

<style scoped lang="less">
// åŸºäºç±»åå®šä¹‰ä¸€äº›å’Œå®šåˆ¶æ ·å¼æ— å…³çš„æ ·å¼
.xtx-button {
  appearance: none;
  border: none;
  outline: none;
  background: #fff;
  text-align: center;
  border: 1px solid transparent;
  border-radius: 4px;
  cursor: pointer;
}
// ---------å¤§å°ç±»å-------------
// å¤§
.large {
  width: 240px;
  height: 50px;
  font-size: 16px;
}
// ä¸­
.middle {
  width: 180px;
  height: 50px;
  font-size: 16px;
}
// å°
.small {
  width: 100px;
  height: 32px;
}
//è¶…å°
.mini {
  width: 60px;
  height: 32px;
}

// ---------é¢œè‰²ç±»å----------
// é»˜è®¤è‰²
.default {
  border-color: #e4e4e4;
  color: #666;
}
// ç¡®è®¤
.primary {
  border-color: @xtxColor;
  background-color: @xtxColor;
  color: #fff;
}
// æ™®é€š
.plain {
  border-color: @xtxColor;
  color: @xtxColor;
  background-color: lighten(@xtxColor, 50%);
}
// ç°è‰²
.gray {
  border-color: #ccc;
  background-color: #ccc;
  color: #fff;
}
</style>
```

### Props é»˜è®¤å€¼

#### å†™æ³•1 - ç±»å‹æ–­è¨€å†™æ³•

- `PropType` ç±»å‹æ–­è¨€å†™æ³•åŒæ ·é€‚ç”¨äº `é€‰é¡¹å¼API` å’Œ `ç»„åˆå¼API`

```vue
<script setup lang="ts">
// è®¾ç½® Props é»˜è®¤å€¼
// PropType ç±»å‹å®šä¹‰å†™æ³•åŒæ ·é€‚ç”¨äºé€‰é¡¹å¼ API
import type { PropType } from "vue";

defineProps({
  size: {
    type: String as PropType<"mini" | "small" | "middle" | "large">,
    default: "small",
  },
  type: {
    type: String as PropType<"gray" | "plain" | "primary" | "default">,
    default: "gray",
  },
});
</script>
```



#### å†™æ³•2 - `withDefaults` å†™æ³•

- `withDefaults` æ¯”è¾ƒå°‘è§ï¼Œå†™æ³•æ¯”è¾ƒç¹çï¼Œäº†è§£ä¸€ä¸‹å³å¯ã€‚

```ts
withDefaults(
  defineProps<{
    // æŒ‰é’®å¤§å°
    size?: "mini" | "small" | "middle" | "large";
    // æŒ‰é’®é¢œè‰²
    type?: "gray" | "plain" | "primary" | "default";
  }>(), 
  {
  size: 'mini',
  type: 'primary',
});
```



#### å†™æ³•3 - å“åº”æ€§è¯­æ³•ç³–(å®éªŒæ€§)

- å®éªŒæ€§å†™æ³• `Vue` ç‰ˆæœ¬è¦æ±‚ `vue@3.2.25+`ï¼Œéœ€ä¿®æ”¹ `Vite` çš„é…ç½®ï¼Œå¹¶ä¸”ä¿®æ”¹ `EsLint` æ£€æŸ¥è§„åˆ™åæ‰èƒ½ä½¿ç”¨ã€‚
- å®éªŒæ€§å†™æ³•å¾ˆæ–¹ä¾¿ï¼Œå±äº[å“åº”æ€§è¯­æ³•ç³–](https://staging-cn.vuejs.org/guide/extras/reactivity-transform.html#reactive-props-destructure)ï¼Œä½†å®˜æ–¹è¿˜æ²¡æ­£å¼å‘å¸ƒã€‚

```vue
<script setup lang="ts">
// å“åº”æ€§è¯­æ³•ç³–(å®éªŒæ€§)å†™æ³• `Vue` ç‰ˆæœ¬è¦æ±‚ `vue@3.2.25+`
// ğŸš¨ éœ€ä¿®æ”¹é…ç½®åæ‰èƒ½ä½¿ç”¨ï¼š
//      1. vite.config.ts   å¼€å¯å“åº”æ€§è¯­æ³•ç³–(å®éªŒæ€§)
//      2. .eslintrc.cjs    å…³é—­æ£€æŸ¥è§„åˆ™
// æ³¨æ„ï¼šå®éªŒæ€§å†™æ³•åœ¨ yarn dev æ—¶ä¼šæœ‰é»„è‰²æé†’ï¼Œæˆ‘ä»¬çŸ¥é“è‡ªå·±å†å¹²ä»€ä¹ˆï¼Œå¿½ç•¥é»„è‰²æé†’å³å¯
const { type = 'default', size = 'middle' } = defineProps<{
  type?: 'default' | 'primary' | 'plain' | 'gray';
  size?: 'large' | 'middle' | 'small' | 'mini';
}>();
</script>
```

`vite.config.ts` 

```diff
import { fileURLToPath, URL } from 'url';

import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import vueJsx from '@vitejs/plugin-vue-jsx';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    vue({
+      // å¼€å¯<å®éªŒæ€§>çš„å“åº”æ€§è¯­æ³•ç³–æ¥è§£å†³ prop å®šä¹‰é»˜è®¤å€¼çš„é—®é¢˜
+      reactivityTransform: true,
    }),
    vueJsx(),
  ],
});

```

å…³é—­ eslint è§„åˆ™

```diff
/* eslint-env node */
require('@rushstack/eslint-patch/modern-module-resolution');

module.exports = {
  root: true,
  // è‡ªå®šä¹‰è§„åˆ™
  rules: {
    // å…³é—­å¤šè¯ç»„åˆçš„ç»„ä»¶å‘½åè¦æ±‚: off å…³é—­
    'vue/multi-word-component-names': 'off',
+    // å…³é—­propsä¸èƒ½è§£æ„
+    'vue/no-setup-props-destructure': 'off',
  },
  extends: [
    'plugin:vue/vue3-essential',
    'eslint:recommended',
    '@vue/eslint-config-typescript/recommended',
    '@vue/eslint-config-prettier',
  ],
};

```



å¸¸è§é—®é¢˜ï¼š

- é—®ï¼šä¸‰ç§è®¾ç½®é»˜è®¤å€¼çš„å†™æ³•ï¼Œå¼€å‘è€…å¦‚ä½•é€‰æ‹©ï¼Ÿ
- ç­”ï¼š
  - `Vue` å®˜æ–¹ä¹Ÿåœ¨æ¢ç´¢é˜¶æ®µï¼Œå®éªŒæ€§å†™æ³•æœ€æ–¹ä¾¿ï¼Œä½†è¦æ±‚Vueç‰ˆæœ¬è¾ƒæ–°ï¼Œç›®å‰è¿˜æ²¡å®Œå…¨å®šç¨¿ã€‚
  - æ­£å¼é¡¹ç›®å»ºè®®æŒ‰å›¢é˜Ÿä¹ æƒ¯æ¥é€‰æ‹©ï¼Œè€é¡¹ç›®ç”¨ç±»å‹æ–­è¨€å†™æ³•è¾ƒä¸ºå¸¸è§ã€‚

##  v-model è¯­æ³•ç³–

> ç›®æ ‡ï¼šç†Ÿæ‚‰ v-model åŒå‘ç»‘å®šè¯­æ³•ç³–åŸç†ï¼Œå¹¶å®ç°è‡ªå®šä¹‰ç»„ä»¶åŒå‘ç»‘å®šã€‚

### çˆ¶ç»„ä»¶

- `vue3`ä¸­ï¼Œç»„ä»¶ v-model åŒå‘ç»‘å®šè¯­æ³•ç³–å…¶å®ç”± `:modelValue` å’Œ `@update:modelValue` ä¸¤éƒ¨åˆ†ç»„åˆè€Œæˆã€‚

```vue
<!-- v-model è¯­æ³•ç³–ç”± :modelValue å’Œ @update:modelValue ä¸¤éƒ¨åˆ†ç»„åˆè€Œæˆ -->
<MyCount  v-model="count" />

<!-- è¯­æ³•ç³–åŸç† -->
<MyCount :model-value="count" @update:model-value="(val) => (count = val)" />
<!-- æˆ– -->
<MyCount :model-value="count" @update:model-value="count = $event" />
```

è¡¥å……ï¼šåœ¨ `Vue2`ä¸­ï¼Œç»„ä»¶ v-model åŒå‘ç»‘å®šè¯­æ³•ç³–å…¶å®ç”± `:value` å’Œ `@input` ä¸¤éƒ¨åˆ†ç»„åˆè€Œæˆã€‚

### å­ç»„ä»¶

- å­ç»„ä»¶å¤„ç† `v-model` éœ€è¦å®šä¹‰ `modelValue` å±æ€§å’Œ `update:modelValue` äº‹ä»¶ã€‚

```vue
<script setup lang="ts">
// æ¥æ”¶ v-model çš„è‡ªå®šä¹‰å±æ€§ modelValue
const props = defineProps<{
  modelValue: number;
}>();

// æ³¨å†Œ v-model çš„è‡ªå®šä¹‰äº‹ä»¶ update:modelValue
const emit = defineEmits<{
  (event: 'update:modelValue', val: number): void;
}>();
</script>
```



## æ•°é‡ç»„ä»¶å®ç°ğŸš¨ğŸš¨

`ä»»åŠ¡ç›®æ ‡:`  å®ç°å•†å“çš„æ•°é‡æ“ä½œç»„ä»¶çš„å°è£…

![](./media/14-1627939478852.png)

**å®ç°æ­¥éª¤**

1. æ­å»ºç»„ä»¶é™æ€ç»“æ„å¹¶å®ç°å¢å‡é€»è¾‘
2. é€šè¿‡propsä¼ å…¥æ§åˆ¶æœ€å¤§å’Œæœ€å°å€¼
3. å®ç°ç»„ä»¶çš„ `v-model` åŒå‘ç»‘å®š ï¼ˆéš¾ç‚¹ï¼‰

```jsx
<MyCount v-model="num"><MyCount>  æ•°å­—æ¡†

å¸Œæœ›å®ç° v-model åŒå‘ç»‘å®š
1. çˆ¶ç»„ä»¶ä¸­ï¼Œä¿®æ”¹äº†ï¼Œè®¾ç½®äº† num å€¼ï¼Œ å­ç»„ä»¶éœ€è¦å®æ—¶æ›´æ–°
2. å­ç»„ä»¶ä¸­ï¼Œç‚¹å‡»äº† +  -, è°ƒæ•´äº†æ•°å€¼ï¼Œ å¸Œæœ›ç»‘å®šçš„ num å€¼ä¹Ÿèƒ½è‡ªåŠ¨æ›´æ–°
```

### é™æ€ç»“æ„-CV

æ–°å»ºç»„ä»¶ï¼š`src\views\Test\components\goods-count.vue`

```html
<script setup lang="ts">
// éœ€æ±‚ï¼š
//   1. æ˜¾ç¤ºæ ‡ç­¾å’Œæ•°é‡
//   2. åŠ å·å’Œæœ€å¤§å€¼å¤„ç†
//   3. å‡å·å’Œæœ€å°å€¼å¤„ç†
//   4. props é»˜è®¤å€¼å¤„ç†
</script>

<template>
  <div class="xtx-numbox">
    <div class="label">æ•°é‡</div>
    <div class="numbox">
      <a href="javascript:;">-</a>
      <input type="text" readonly :value="1" />
      <a href="javascript:;">+</a>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-numbox {
  display: flex;
  align-items: center;
  .label {
    width: 60px;
    color: #999;
    padding-left: 10px;
  }
  .numbox {
    width: 120px;
    height: 30px;
    border: 1px solid #e4e4e4;
    display: flex;
    > a {
      width: 29px;
      line-height: 28px;
      text-align: center;
      background: #f8f8f8;
      font-size: 16px;
      color: #666;
      &:first-of-type {
        border-right: 1px solid #e4e4e4;
      }
      &:last-of-type {
        border-left: 1px solid #e4e4e4;
      }
    }
    > input {
      width: 60px;
      padding: 0 5px;
      text-align: center;
      color: #666;
    }
  }
}
</style>

```

### æ˜¾ç¤ºæ ‡ç­¾å’Œæ•°é‡

```vue
<script setup lang="ts">
defineProps<{
  // æ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾
  isLabel?: boolean;
  // v-model è¯­æ³•ç³–çš„ props
  modelValue: number;
}>();
</script>

<template>
  <div class="xtx-numbox">
    <div class="label" v-if="isLabel">æ•°é‡</div>
    <div class="numbox">
      <a href="javascript:;">-</a>
      <input type="text" readonly :value="modelValue" />
      <a href="javascript:;">+</a>
    </div>
  </div>
</template>
```

### åŠ å·å’Œæœ€å¤§å€¼å¤„ç†

```vue
<script setup lang="ts">
const { isLabel, modelValue, max } = defineProps<{
  // æ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾
  isLabel?: boolean;
  // v-model è¯­æ³•ç³–çš„ props
  modelValue: number;
  // æœ€å¤§å€¼
  max: number;
}>();

// v-model è¯­æ³•ç³–çš„ update:modelValue
const emit = defineEmits<{
  (event: 'update:modelValue', value: number): void;
}>();

// åŠ å·å’Œæœ€å¤§å€¼å¤„ç†
const add = () => {
  // ä¸´æ—¶åŠ 
  const temp = modelValue + 1;
  // æ˜¯å¦è¶…è¿‡æœ€å¤§å€¼ï¼Œè¶…è¿‡ç›´æ¥ return é€€å‡ºï¼Œä¸æ›´æ–°çˆ¶ç»„ä»¶çš„æ•°æ®
  if (temp > max) return;
  // æ›´æ–° v-model ç»‘å®šçš„æ•°æ®
  emit('update:modelValue', temp);
};
</script>

<template>
  <div class="xtx-numbox">
    <div v-if="isLabel" class="label">æ•°é‡</div>
    <div class="numbox">
      <a href="javascript:;">-</a>
      <input type="text" readonly :value="modelValue" />
      <a href="javascript:;" @click="add">+</a>
    </div>
  </div>
</template>
```

### å‡å·å’Œæœ€å°å€¼å¤„ç†

- å‚è€ƒæœ€å¤§å€¼å¤„ç†

### é»˜è®¤å€¼å¤„ç†

- å¯é€‰ props æ·»åŠ é»˜è®¤å€¼ã€‚

```vue
<script setup lang="ts">
const {
  modelValue,
  isLable = false,
  max = 100,
  min = 1,
} = defineProps<{
  // æ•°é‡
  modelValue: number;
  // æ˜¯å¦æ˜¾ç¤ºæ ‡ç­¾
  isLable?: boolean;
  // æœ€å¤§å€¼
  max?: number;
  // æœ€å°å€¼
  min?: number;
}>();
</script>
```



## å•†å“è§„æ ¼ç»„ä»¶å®ç°ğŸš¨ğŸš¨ğŸš¨

> ç›®æ ‡ï¼šå•†å“è§„æ ¼å¤„ç†æ˜¯ç”µå•†ç½‘ç«™ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„åŠŸèƒ½æ¨¡å—ï¼Œæˆ‘ä»¬è¯¾å ‚è‡ªå·±å®ç°ä¸€ç‰ˆå•†å“è§„æ ¼ç»„ä»¶çš„å°è£…ã€‚
>
> æµ‹è¯•å•†å“idï¼š 1379052170040578049 å’Œ 1369155859933827074

![](./media/12.png)

### 1. â˜… ç†è§£åŸºç¡€ sku æ¦‚å¿µ

å®˜æ–¹è¯æœ¯ï¼š

- `SPU`ï¼ˆStandard Product Unitï¼‰ï¼šæ ‡å‡†åŒ–äº§å“å•å…ƒã€‚ï¼ˆ`IphoneX`ï¼‰   `Iphone12`

  æ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯çš„  **`é›†åˆ`**ï¼Œè¯¥é›†åˆæè¿°äº†ä¸€ä¸ªäº§å“çš„ç‰¹æ€§ã€‚

  é€šä¿—ç‚¹è®²ï¼Œå±æ€§å€¼ã€ç‰¹æ€§ç›¸åŒçš„å•†å“å°±å¯ä»¥ç§°ä¸ºä¸€ä¸ªSPUã€‚(å¹¿ä¹‰ï¼Œå®½æ³›)

- `SKU`ï¼ˆStock Keeping Unitï¼‰**`åº“å­˜ é‡ å•ä½`**ã€‚ï¼ˆ`Iphone`  è“è‰²çº¢è‰²ç²‰è‰²é»‘è‰²ï¼Œ64g 128g 256g  =>  4è‰² * 3è§„æ ¼  =>  12ç§ SKU ï¼‰

  å³åº“å­˜è¿›å‡ºè®¡é‡çš„å•ä½ï¼Œ å¯ä»¥æ˜¯ä»¥ä»¶ã€ç›’ã€æ‰˜ç›˜ç­‰ä¸ºå•ä½ã€‚

  **SKUæ˜¯ç‰©ç†ä¸Šä¸å¯åˆ†å‰²çš„æœ€å°å­˜è´§å•å…ƒã€‚**åœ¨ä½¿ç”¨æ—¶è¦æ ¹æ®ä¸åŒä¸šæ€ï¼Œä¸åŒç®¡ç†æ¨¡å¼æ¥å¤„ç†ã€‚

å›¾è§£ï¼š

![image-20210801072132025](./media/image-20210801072132025.png)



**è§„æ ¼ç»„ä»¶å‚è€ƒç”¨æ³•**

```diff
<script setup lang="ts">
+import type { SkuInfo } from "@/components/XtxUI/Sku/index.vue";


+const changeSku = (skuInfo: SkuInfo) => {
+  console.log("å½“å‰é€‰æ‹©çš„skuä¿¡æ¯ä¸º", skuInfo);
+};
</script>


<template>
        ...
        <!-- å•†å“ä¿¡æ¯åŒº -->
        <div class="spec">
          <!-- å•†å“ä¸»è¦ä¿¡æ¯ -->
          <div class="goods-main">
              ...
          </div>
+          <!-- ğŸ“Œè§„æ ¼é€‰æ‹©ç»„ä»¶ -->
+          <XtxSku :goods="goods" @change="changeSku" />
          <!-- æ•°é‡é€‰æ‹©ç»„ä»¶ -->
          <!-- æŒ‰é’®ç»„ä»¶ -->
        </div>
        ...
</template>
```



### 2. â˜… è§„æ ¼ç»„ä»¶-åŸºç¡€ç»“æ„å’Œæ ·å¼

> ç›®æ ‡ï¼šè‡ªå·±å®ç° `Sku` ç»„ä»¶åº“çš„å°è£…ï¼ŒåŠŸèƒ½å‚è€ƒç»„ä»¶åº“ä¸­çš„ `XtxSku` ç»„ä»¶ã€‚

è‡ªå·±å°è£…å¤§è‡´æ­¥éª¤ï¼š

- å‡†å¤‡ç»„ä»¶
- ä½¿ç”¨ç»„ä»¶

è½åœ°ä»£ç ï¼š

- æ–°å»ºç»„ä»¶ç»“æ„ `src/views/goods/components/goods-sku.vue`

```html
<script setup lang="ts" name="MySku">
//
</script>

<template>
  <div class="goods-sku">
    <dl>
      <dt>é¢œè‰²</dt>
      <dd>
        <img
          class="selected"
          src="https://yanxuan-item.nosdn.127.net/d77c1f9347d06565a05e606bd4f949e0.png"
          alt=""
        />
        <img
          class="disabled"
          src="https://yanxuan-item.nosdn.127.net/d77c1f9347d06565a05e606bd4f949e0.png"
          alt=""
        />
      </dd>
    </dl>
    <dl>
      <dt>å°ºå¯¸</dt>
      <dd>
        <span class="disabled">10è‹±å¯¸</span>
        <span class="selected">20è‹±å¯¸</span>
        <span>30è‹±å¯¸</span>
      </dd>
    </dl>
    <dl>
      <dt>ç‰ˆæœ¬</dt>
      <dd>
        <span>ç¾ç‰ˆ</span>
        <span>æ¸¯ç‰ˆ</span>
      </dd>
    </dl>
  </div>
</template>

<style scoped lang="less">
.sku-state-mixin () {
  border: 1px solid #e4e4e4;
  margin-right: 10px;
  cursor: pointer;
  &.selected {
    border-color: @xtxColor;
  }
  &.disabled {
    opacity: 0.6;
    border-style: dashed;
    cursor: not-allowed;
  }
}
.goods-sku {
  padding-left: 10px;
  padding-top: 20px;
  dl {
    display: flex;
    padding-bottom: 20px;
    align-items: center;
    dt {
      width: 50px;
      color: #999;
    }
    dd {
      flex: 1;
      color: #666;
      > img {
        width: 50px;
        height: 50px;
        .sku-state-mixin ();
      }
      > span {
        display: inline-block;
        height: 30px;
        line-height: 28px;
        padding: 0 20px;
        .sku-state-mixin ();
      }
    }
  }
}
</style>

```

å¯¼å…¥ä½¿ç”¨ç»„ä»¶

```jsx
<!-- å•†å“ä¿¡æ¯åŒº -->
<div class="spec">
  <!-- å‚è€ƒçš„Skuç»„ä»¶ -->
  <XtxSku :goods="goods" @change="changeSku" />
  <!-- è‡ªå·±çš„Skuç»„ä»¶ -->
  <GoodsSku :goods="goods"/>
</div>
```



**çˆ¶ä¼ å­**

`Sku` ç»„ä»¶æ¥æ”¶æ•°æ®ï¼š  `src\views\Goods\components\goods-sku.vue`

```vue
<script setup lang="ts">
import type { Goods } from "@/components/XtxUI/Sku/goods";

interface Props {
  goods: Goods;
}
const props = defineProps<Props>();
</script>
```



### 3. â˜… è§„æ ¼ç»„ä»¶-æ¸²æŸ“ä¸é€‰ä¸­æ•ˆæœ

> ç›®çš„ï¼šæ ¹æ®å•†å“ä¿¡æ¯æ¸²æŸ“è§„æ ¼ï¼Œå®Œæˆé€‰ä¸­ï¼Œå–æ¶ˆé€‰ä¸­æ•ˆæœã€‚

å¤§è‡´æ­¥éª¤ï¼š

- ä¾èµ– `goods.specs` æ¸²æŸ“è§„æ ¼
- ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œå®Œæˆé€‰ä¸­å’Œå–æ¶ˆé€‰ä¸­
  - å½“å‰ç‚¹çš„æ˜¯é€‰ä¸­ï¼Œå–æ¶ˆå³å¯
  - å½“å‰ç‚¹çš„æœªé€‰ä¸­ï¼Œå…ˆå½“å‰è§„æ ¼æŒ‰é’®å…¨éƒ¨å–æ¶ˆï¼Œå½“å‰æŒ‰é’®é€‰ä¸­ã€‚

è½åœ°ä»£ç ï¼š

```jsx
<GoodsSku :goods="goods" />
```

`src/views/goods/components/goods-sku.vue` åŸºæœ¬æ¸²æŸ“

```html

<script setup lang="ts">
import type { Goods } from "@/components/XtxUI/Sku/goods";

interface Props {
  goods: Goods;
}
const props = defineProps<Props>();
</script>

<template>
  <div class="goods-sku">
    <dl v-for="(spec, index) in goods.specs" :key="index">
      <dt>{{ spec.name }}</dt>
      <dd>
        <template v-for="btnObj in spec.values" :key="btnObj.name">
          <img v-if="btnObj.picture" :src="btnObj.picture" alt="" />
          <span v-else>{{ btnObj.name }}</span>
        </template>
      </dd>
    </dl>
  </div>
</template>
```

æ³¨æ„ï¼šæ¯ä¸ªæŒ‰é’®ï¼Œéƒ½åº”è¯¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œæ ‡è®°é€‰ä¸­è¿˜æ˜¯æ²¡é€‰ä¸­ã€‚

1. çº¦å®šæ¯ä¸ªæŒ‰é’®éƒ½æœ‰è‡ªå·±çš„é€‰ä¸­çŠ¶æ€ selected
2. ç‚¹å‡»å·²é€‰ä¸­é¡¹ï¼š å–æ¶ˆé€‰ä¸­
3. ç‚¹å‡»æœªé€‰ä¸­é¡¹ï¼š æ’ä»–ï¼Œè¿›è¡Œè‡ªæˆ‘é€‰ä¸­

`src/views/goods/components/goods-sku.vue`

```html
<script setup lang="ts">
import type { Goods, Spec, Value } from "@/components/XtxUI/Sku/goods";

interface Props {
  goods: Goods;
}
const props = defineProps<Props>();

const changeSku = (btnObj: Value, spec: Spec) => {
  if (btnObj.selected) {
    btnObj.selected = false;
  } else {
    // ç‚¹äº®è‡ªå·±ï¼Œå…ˆå¹²æ‰æ‰€æœ‰äºº
    spec.values.forEach((bt: Value) => {
      bt.selected = false;
    });
    btnObj.selected = true;
  }
};
</script>

<template>
  <div class="goods-sku">
    <dl v-for="(spec, index) in goods.specs" :key="index">
      <dt>{{ spec.name }}</dt>
      <dd>
        <template v-for="btnObj in spec.values" :key="btnObj.name">
          <img
            :class="{ selected: btnObj.selected }"
            @click="changeSku(btnObj, spec)"
            v-if="btnObj.picture"
            :src="btnObj.picture"
            alt=""
          />
          <span
            :class="{ selected: btnObj.selected }"
            @click="changeSku(btnObj, spec)"
            v-else
            >{{ btnObj.name }}</span
          >
        </template>
      </dd>
    </dl>
  </div>
</template>
```



### 4. â˜… è§„æ ¼ç»„ä»¶-ç¦ç”¨æ•ˆæœ-æ€è·¯åˆ†æ

> ç›®æ ‡ï¼šå¤§è‡´äº†è§£ç¦ç”¨æ•ˆæœçš„æ•´ä½“æ€è·¯ï¼Œæ³¨æ„åªæ˜¯äº†è§£ã€‚

![1613887164658](./media/1613887164658.4b06864e.png)

å¤§è‡´æ­¥éª¤ï¼š

1. æ ¹æ®åå°è¿”å›çš„ `skus` æ•°æ®å¾—åˆ°æœ‰æ•ˆ `sku` ç»„åˆ
2. æ ¹æ®æœ‰æ•ˆçš„ `sku` ç»„åˆå¾—åˆ°æ‰€æœ‰çš„å­é›†é›†åˆ
3. æ ¹æ®å­é›†é›†åˆç»„åˆæˆä¸€ä¸ªè·¯å¾„å­—å…¸ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡ã€‚
4. åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™å»åˆ¤æ–­æ¯ä¸ªè§„æ ¼æ˜¯å¦ç‚¹å‡»
5. åœ¨ç‚¹å‡»è§„æ ¼çš„æ—¶å€™å»åˆ¤æ–­å…¶ä»–è§„æ ¼æ˜¯å¦å¯ç‚¹å‡»
6. åˆ¤æ–­çš„ä¾æ®æ˜¯ï¼Œæ‹¿ç€è¯´æœ‰è§„æ ¼å’Œç°åœ¨å·²ç»é€‰ä¸­çš„è§„åˆ™å–æ­é…ï¼Œå¾—åˆ°å¯èµ°è·¯å¾„ã€‚
   1. å¦‚æœå¯èµ°è·¯å¾„åœ¨å­—å…¸ä¸­ï¼Œå¯ç‚¹å‡»
   2. å¦‚æœå¯èµ°è·¯å¾„ä¸åœ¨å­—å…¸ä¸­ï¼Œç¦ç”¨

### 5. â˜… è§„æ ¼ç»„ä»¶-è·¯å¾„å­—å…¸å‡†å¤‡ğŸš¨ğŸš¨ğŸš¨

> ç›®çš„ï¼šæ ¹æ®åå° `skus` æ•°æ®å¾—åˆ°å¯èµ°è·¯å¾„å­—å…¸å¯¹è±¡

- JavaScript ç®—æ³•åº“[ç‚¹å‡»æŸ¥çœ‹](https://gitee.com/megasu/javascript-algorithms)
- å¹‚é›†ç®—æ³• [ç‚¹å‡»æŸ¥çœ‹](https://gitee.com/Megasu/javascript-algorithms/blob/master/src/algorithms/sets/power-set/bwPowerSet.js) 

æ–°å»ºæ–‡ä»¶ï¼š `src/vendor/power-set.ts`  å‡†å¤‡æ±‚å­é›†çš„ç®—æ³•å‡½æ•°ã€‚

```jsx
/**
 * Find power-set of a set using BITWISE approach.
 *
 * @param {*[]} originalSet
 * @return {*[][]}
 */
export default function bwPowerSet(originalSet: unknown[]) {
  const subSets = [];

  // We will have 2^n possible combinations (where n is a length of original set).
  // It is because for every element of original set we will decide whether to include
  // it or not (2 options for each set element).
  const numberOfCombinations = 2 ** originalSet.length;

  // Each number in binary representation in a range from 0 to 2^n does exactly what we need:
  // it shows by its bits (0 or 1) whether to include related element from the set or not.
  // For example, for the set {1, 2, 3} the binary number of 0b010 would mean that we need to
  // include only "2" to the current set.
  for (
    let combinationIndex = 0;
    combinationIndex < numberOfCombinations;
    combinationIndex += 1
  ) {
    const subSet = [];

    for (
      let setElementIndex = 0;
      setElementIndex < originalSet.length;
      setElementIndex += 1
    ) {
      // Decide whether we need to include current element into the subset or not.
      if (combinationIndex & (1 << setElementIndex)) {
        subSet.push(originalSet[setElementIndex]);
      }
    }

    // Add current subset to the list of all subsets.
    subSets.push(subSet);
  }

  return subSets;
}

```

`src/views/goods/components/goods-sku.vue`

1. è¿‡æ»¤å‡º æœ‰åº“å­˜çš„  æœ‰æ•ˆ sku
2. å¤„ç†å¾—åˆ° skuå±æ€§å€¼ æ•°ç»„
3. å¤„ç†å¾—åˆ° skuå±æ€§å€¼ æ•°ç»„çš„å­é›†
4. æ•´ç†åˆ°å­—å…¸ä¸­

```vue
<script setup lang="ts">
import type {
  Goods,
  Sku,
  Spec,
  Value,
} from "@/components/XtxUI/Sku/goods";
import bwPowerSet from "@/vendor/power-set";

interface Props {
  goods: Goods;
}
const props = defineProps<Props>();

const changeSku = (btnObj: Value, spec: Spec) => {
  if (btnObj.selected) {
    btnObj.selected = false;
  } else {
    // ç‚¹äº®è‡ªå·±ï¼Œå…ˆå¹²æ‰æ‰€æœ‰äºº
    spec.values.forEach((bt: Value) => {
      bt.selected = false;
    });
    btnObj.selected = true;
  }
};

// å¤„ç†å¯èµ°è·¯å¾„å­—å…¸å¯¹è±¡
type PathMap = { [key: string]: string[] };
type Skus = Sku[]
const spliter = "â˜…";
// æ ¹æ®skusæ•°æ®å¾—åˆ°è·¯å¾„å­—å…¸å¯¹è±¡
const getPathMap = (skus: Skus) => {
  // 0. åˆå§‹åŒ–å¯èµ°è·¯å¾„å­—å…¸å¯¹è±¡ä¸ºç©ºå¯¹è±¡
  const pathMap = {} as PathMap;
  // 1. éå† skus é›†åˆ
  skus.forEach((sku) => {
    // 2. è¿‡æ»¤å‡ºæœ‰åº“å­˜æœ‰æ•ˆçš„sku
    if (sku.inventory) {
      // 3. å¾—åˆ°skuå±æ€§å€¼æ•°ç»„
      const specs = sku.specs.map((spec) => spec.valueName);
      // 4. å¾—åˆ°skuå±æ€§å€¼æ•°ç»„çš„å­é›†
      const powerSet = bwPowerSet(specs);
      // 5. è®¾ç½®ç»™è·¯å¾„å­—å…¸å¯¹è±¡
      powerSet.forEach((set) => {
        // 6. å¤„ç†æˆå­—ç¬¦ä¸²æ–¹ä¾¿æŸ¥æ‰¾
        const key = set.join(",");
        // 7. å¦‚æœè¿˜æ²¡æœ‰æ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„
        if (!pathMap[key]) {
            pathMap[key] = []
        }
        // 8. å·²ç»æœ‰keyå¾€æ•°ç»„è¿½åŠ  skuid
        pathMap[key].push(sku.id);
      });
    }
  });
  return pathMap;
};

// è·å–å¯èµ°è·¯å¾„å­—å…¸å¯¹è±¡
const pathMap = getPathMap(props.goods.skus);
console.log(`ç»„åˆå­—å…¸ç»“æœ`, pathMap);
</script>
```

- å‚ç…§ç¤ºä¾‹

![1616919264380](./media/1616919264380.ea52b946.png)



### 6. â˜… è§„æ ¼ç»„ä»¶-ç¦ç”¨æ•ˆæœ

>  æµ‹è¯•å•†å“idï¼š 1379052170040578049 å’Œ 1369155859933827074

ç›®æ ‡ï¼šåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç‚¹å‡»è§„æ ¼çš„æ—¶å€™ï¼Œå»æ›´æ–°å…¶ä»–æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€ã€‚

æ ¸å¿ƒæ€è·¯ï¼š

1. éå†æ‰€æœ‰çš„è§„æ ¼æŒ‰é’®ï¼Œåˆ¤æ–­è§„æ ¼æŒ‰é’®åœ¨ `pathMap` ä¸­æ˜¯å¦å­˜åœ¨ï¼Œ å¦‚æœä¸å­˜åœ¨ï¼Œå°±è¦ç¦ç”¨

![image-20210802234449870](./media/image-20210802234449870.png)

#### åˆå§‹åŒ–æŒ‰é’®ç¦ç”¨çŠ¶æ€

`src/views/goods/components/goods-sku.vue`

å‡†å¤‡ `æ›´æ–°æŒ‰é’®çŠ¶æ€` çš„æ–¹æ³•

```diff
<template>
  <div class="goods-sku">
    <dl v-for="(spec, index) in goods.specs" :key="index">
      <dt>{{ spec.name }}</dt>
      <dd>
        <template v-for="btnObj in spec.values" :key="btnObj.name">
          <img
-            :class="{ selected: btnObj.selected }"
+            :class="{ selected: btnObj.selected, disabled: btnObj.disabled }"
            @click="changeSku(btnObj, spec)"
            v-if="btnObj.picture"
            :src="btnObj.picture"
            alt=""
          />
          <span
-            :class="{ selected: btnObj.selected }"
+            :class="{ selected: btnObj.selected, disabled: btnObj.disabled }"
            @click="changeSku(btnObj, spec)"
            v-else
            >{{ btnObj.name }}</span
          >
        </template>
      </dd>
    </dl>
  </div>
</template>
```

```jsx
// ğŸš¨ æ›´æ–°æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€
// ğŸš¨ æ›´æ–°ç¦ç”¨çŠ¶æ€æ ¸å¿ƒï¼šè·å–å½“å‰ç”¨æˆ·é€‰ä¸­çš„è§„æ ¼ï¼Œå†æ¨¡æ‹Ÿç”¨æˆ·ä¸‹ä¸€æ¬¡çš„è§„æ ¼é€‰æ‹©ï¼Œå»å­—å…¸ä¸­æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°è®¾ç½®ä¸ºç¦ç”¨çŠ¶æ€
type Specs = Spec[];
const updateDisabledStatus = (specs: Specs, pathMap: PathMap) => {
  specs.forEach((spec) => {
    spec.values.forEach((btnObj) => {
      if (pathMap[btnObj.name]) {
        btnObj.disabled = false;
      } else {
        btnObj.disabled = true;
      }
    });
  });
};

// âŒ› ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™æ›´æ–°ç¦ç”¨çŠ¶æ€
updateDisabledStatus(props.goods.specs, pathMap);
```



#### æ›´æ–°ç¦ç”¨çŠ¶æ€ ğŸš¨ğŸš¨

2. é»˜è®¤è¿›æ¥çš„ç¦ç”¨å·²ç»å®Œæˆï¼Œ ä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬é€‰ä¸­æŸä¸ªæŒ‰é’®äº†ï¼Œä¼šéœ€è¦é¢å¤–å†³å®šå…¶ä»–æŒ‰é’®æ˜¯å¦ç¦ç”¨  ï¼ˆä¸­å›½ï¼Œæ—¥æœ¬æ˜¯å¦ç¦ç”¨ï¼‰

æµ‹è¯•ç”¨çš„å•†å“ idï¼š`1369155859933827074`

![image-20210803000944264](./media/image-20210803000944264.png)

â€‹    **éœ€è¦å°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œè·å–é€‰ä¸­çš„å€¼ï¼š**

â€‹	ä»€ä¹ˆéƒ½æ²¡é€‰ï¼š  `["",  "",  ""]`

â€‹	é€‰ä¸­é»‘è‰²:         `["é»‘è‰²", "", ""]`

â€‹	é€‰ä¸­10cm:       `["",  "",  "10cm"]`

```jsx
// è·å–é€‰ä¸­çš„è§„æ ¼çš„å€¼
// åŸåˆ™ï¼šå¾—åˆ°çš„ç»“æœè¦ä¿è¯é¡ºåº ["é€‰ä¸­è§„æ ¼", undefined, undefined]
// ğŸš¨ ç”±äºä¹¦å†™é¡ºåºé—®é¢˜ï¼Œå¯ä»¥ç”¨ function å®šä¹‰å‡½æ•°æå‡
function getSelectedSpec(specs: Specs) {
  // æ³¨æ„ç±»å‹å®šä¹‰
  const arr: string[] = [];
  specs.forEach((spec, index) => {
    // æ ¹æ®specä¸­valuesä¸­æ‰¾æ˜¯å¦æœ‰ï¼Œselectedä¸ºtrueçš„ï¼ŒæŠŠselectedä¸ºtrueçš„é‚£ä¸ªæŒ‰é’®å­˜å‚¨èµ·æ¥
    const btnObj = spec.values.find((item) => item.selected);
    // å¦‚æœä¸ºé€‰ä¸­ï¼Œå°±æŠŠ name æ·»åŠ åˆ°æ•°ç»„ä¸­
    arr[index] = btnObj ? btnObj.name : "";
  });
  return arr;
}
```

3. æ¯æ¬¡é‡æ–°é€‰æ‹©åï¼Œæ›´æ–°æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€

```jsx
// ğŸ”” æ›´æ–°ç¦ç”¨çŠ¶æ€æ ¸å¿ƒï¼šè·å–å½“å‰ç”¨æˆ·é€‰ä¸­çš„è§„æ ¼ï¼Œå†æ¨¡æ‹Ÿç”¨æˆ·ä¸‹ä¸€æ¬¡çš„è§„æ ¼é€‰æ‹©ï¼Œå»å­—å…¸ä¸­æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°è®¾ç½®ä¸ºç¦ç”¨çŠ¶æ€
type Specs = Spec[];
// æ›´æ–°æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€
const updateDisabledStatus = (specs: Specs, pathMap: PathMap) => {
  // éå†æ¯ä¸€ç§è§„æ ¼
  specs.forEach((spec, i) => {
    // å…ˆæ‹¿åˆ°å½“å‰é€‰æ‹©çš„é¡¹ç›®
    const selectedValues = getSelectedSpec(specs);
    // éå†æ¯ä¸€ä¸ªæŒ‰é’®
    spec.values.forEach((btnObj) => {
      // å¦‚æœæŒ‰é’®æœªè¢«é€‰æ‹©
      if (!btnObj.selected) {
        // ğŸš¨æ¨¡æ‹Ÿç”¨æˆ·é€‰æ‹©
        selectedValues[i] = btnObj.name;
        // å»æ‰ç©ºå€¼ä¹‹åç»„åˆæˆæŸ¥æ‰¾å­—å…¸çš„ key
        const key = selectedValues.filter((v) => v).join(",");
        // åˆ¤æ–­ç»„åˆåçš„æƒ…å†µï¼Œåœ¨å­—å…¸ä¸­æ˜¯å¦èƒ½æ‰¾åˆ°
        if (pathMap[key]) {
          btnObj.disabled = false;
        } else {
          btnObj.disabled = true;
        }
      }
    });
  });
};



// ç‚¹å‡»æŒ‰é’®äº‹ä»¶
const changeSku = (btnObj: Value, spec: Spec) => {
  ...
  // æ¯æ¬¡ç‚¹å‡»æ›´æ–°é€‰ä¸­çŠ¶æ€
  updateDisabledStatus(props.goods.specs, pathMap);
```

 

### 7. â˜… è§„æ ¼ç»„ä»¶-æ•°æ®é€šè®¯

> ç›®çš„ï¼šé€‰æ‹©è§„æ ¼åè§¦å‘changeäº‹ä»¶ä¼ å‡ºé€‰æ‹©çš„ `sku` æ•°æ®ã€‚

æ ¹æ®é€‰æ‹©çš„å®Œæ•´ `sku` è§„æ ¼ä¼ å‡º `sku` ä¿¡æ¯

`src/views/goods/components/goods-sku.vue`

```jsx
// ç‚¹å‡»æŒ‰é’®äº‹ä»¶
const changeSku = (btnObj: Value, spec: Spec) => {
  ...
  // ğŸš¨è§„æ ¼ç»„ä»¶-æ•°æ®é€šè®¯
  if (btnObj.disabled) return;
  // è·å–é€‰ä¸­çŠ¶æ€
  const selectedArr = getSelectedSpec(props.goods.specs).filter((v) => v);
  // é€‰ä¸­æ»¡å…¨éƒ¨
  if (selectedArr.length === props.goods.specs.length) {
    // æ ¹æ®é€‰ä¸­ç»„åˆå»å­—å…¸æŸ¥æ‰¾
    const getSkuPath = pathMap[selectedArr.join(spliter)];
    // å¦‚æœæŸ¥æ‰¾ä¸åˆ°ç›´æ¥é€€å‡º
    if (!getSkuPath) return;
    // æŸ¥æ‰¾åˆ°è·å– SkuId
    const skuId = getSkuPath[0];
    // è·å– Sku ä¿¡æ¯
    const sku = props.goods.skus.find((sku) => sku.id === skuId);
    if (sku) {
      // ä¼ é€’ç»™çˆ¶ç»„ä»¶
      emit("change", {
        skuId: sku.id,
        price: sku.price,
        oldPrice: sku.oldPrice,
        inventory: sku.inventory,
      });
    }
  } else {
    // æœ‰æ²¡é€‰ä¸­çš„
    emit("change", {});
  }
};
```

çˆ¶ç»„ä»¶ç›‘å¬æ¥æ”¶

```jsx
<script setup lang="ts" name="Goods">
// ...
const changeSkuFn = (val: unknown) => {
  console.log("å½“å‰é€‰ä¸­skuä¿¡æ¯ä¸º", val);
};
</script>

<GoodsSku :goods="goods" @change="changeSkuFn"/>
```

### 8. â˜… TS è‡ªå®šä¹‰äº‹ä»¶ç±»å‹æ³¨è§£

æ™®é€šç”¨æ³•ï¼Œå½¢å‚ä¸­æ²¡æœ‰ç±»å‹ã€‚

```ts
// æ™®é€šç”¨æ³•
const emit = defineEmits(['change']);
```

è¿›é˜¶ç”¨æ³•ï¼Œå®šä¹‰å½¢å‚ç±»å‹ã€‚

```ts
export interface SkuEmit {
  skuId: string;
  price: string;
  oldPrice: string;
  inventory: number;
};
// å®šä¹‰ç±»å‹
const emit = defineEmits<{
  (e: 'change', val: SkuEmit): void;
}>()
```

å‡çº§æ”¹é€ 

```ts
const changeSkuFn = (skuInfo: SkuEmit) => {
  console.log("ğŸ¯å½“å‰å•†å“è§„æ ¼", skuInfo);
};
```

### 9. â˜…æ›´æ–°å•†å“ä¿¡æ¯

```ts
// å½“å•†å“è§„æ ¼é€‰æ‹©å‘ç”Ÿæ”¹å˜æ—¶
const skuId = ref('');
const attrsText = ref('');
const changeSkuFn = (skuInfo: SkuEmit) => {
  console.log('ğŸ¯å½“å‰å•†å“è§„æ ¼', skuInfo);
  // å­˜å‚¨ skuIdï¼Œç”¨äºåŠ å…¥è´­ç‰©è½¦
  skuId.value = skuInfo.skuId || '';
  // å­˜å‚¨è§„æ ¼æ–‡æœ¬ï¼Œç”¨äºåŠ å…¥è´­ç‰©è½¦(æœ¬åœ°ç‰ˆ)
  attrsText.value = skuInfo.specsText || '';
  // éç©ºåˆ¤æ–­
  if (goods.value && skuInfo.skuId) {
    // æ›´æ–°å•†å“æœ€æ–°ä»·æ ¼ï¼Œå•†å“åŸä»·ï¼Œå•†å“åº“å­˜
    goods.value.price = skuInfo.price;
    goods.value.oldPrice = skuInfo.oldPrice;
    goods.value.inventory = skuInfo.inventory;
  }
};
```



## è¯¦æƒ…å±•ç¤ºå®ç°-è¯¾åç»ƒä¹ 

> è¯´æ˜ï¼šåˆ—è¡¨æ¸²æŸ“éƒ¨åˆ†ï¼Œè‡ªå·±è¯¾åå®ç°å³å¯ã€‚

`ä»»åŠ¡ç›®æ ‡:`  å®ç°å•†å“è¯¦æƒ…ä¿¡æ¯çš„å±•ç¤º

**å®ç°æ­¥éª¤**

1. æŠŠè¯¦æƒ…æ•°æ®é€šè¿‡ props ä¼ å…¥
2. æ¥æ”¶æ•°æ®å¹¶æ¸²æŸ“æ¨¡æ¿

**ä»£ç è½åœ°**

1ï¼‰ä¼ å…¥æ•°æ®

```html
<!-- å•†å“è¯¦æƒ… -->
<GoodsDetail :goods="goods"/>
```

2ï¼‰æ¥æ”¶å¹¶æ¸²æŸ“æ•°æ®

```html
<script setup lang="ts">
import type { Goods } from "@/types";

interface Props {
  goods: Goods;
}
defineProps<Props>();
</script>

<template>
  <div class="goods-tabs">
    <nav>
      <a>å•†å“è¯¦æƒ…</a>
    </nav>
    <div class="goods-detail">
      <!-- å±æ€§ -->
      <ul class="attrs">
        <li v-for="item in goods.details.properties" :key="item.value">
          <span class="dt">{{ item.name }}</span>
          <span class="dd">{{ item.value }}</span>
        </li>
      </ul>
      <!-- å›¾ç‰‡ -->
      <img
        v-for="item in goods.details.pictures"
        :key="item"
        :src="item"
        alt=""
      />
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-tabs {
  min-height: 600px;
  background: #fff;
  nav {
    height: 70px;
    line-height: 70px;
    display: flex;
    border-bottom: 1px solid #f5f5f5;
    a {
      padding: 0 40px;
      font-size: 18px;
      position: relative;
      > span {
        color: @priceColor;
        font-size: 16px;
        margin-left: 10px;
      }
    }
  }
}
.goods-detail {
  padding: 40px;
  .attrs {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 30px;
    li {
      display: flex;
      margin-bottom: 10px;
      width: 50%;
      .dt {
        width: 100px;
        color: #999;
      }
      .dd {
        flex: 1;
        color: #666;
      }
    }
  }
  > img {
    width: 100%;
  }
}
</style>
```

## çƒ­æ¦œåŒºåŸŸå®ç°-è¯¾åç»ƒä¹ 

> è¯´æ˜ï¼šåˆ—è¡¨æ¸²æŸ“éƒ¨åˆ†ï¼Œè‡ªå·±è¯¾åå®ç°å³å¯ã€‚

`ä»»åŠ¡ç›®æ ‡:`  å±•ç¤º24å°æ—¶çƒ­æ¦œå•†å“ï¼Œå’Œå‘¨çƒ­æ¦œå•†å“

**å®ç°æ­¥éª¤**

1. å®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼Œå®Œæˆå¤šä¸ªç»„ä»¶å±•ç°å‹æ€ï¼Œæ ¹æ®ä¼ å…¥ç»„ä»¶çš„ç±»å‹å†³å®š
   - 1: ä»£è¡¨24å°æ—¶çƒ­é”€æ¦œ 	
   - 2: ä»£è¡¨å‘¨çƒ­é”€æ¦œ	 
   - 3: ä»£è¡¨æ€»çƒ­é”€æ¦œ
2. æ ¹æ®ä¼ å…¥çš„typeè·å–æ•°æ®ï¼Œå®Œæˆå•†å“å±•ç¤ºå’Œæ ‡é¢˜æ ·å¼çš„è®¾ç½®

### 1. å®šä¹‰ç»„ä»¶

`src/views/Goods/components/goods-hot.vue`

```html
<script setup lang="ts">
import GoodsItem from "@/views/Category/components/goods-item.vue";
import type { PropType } from "vue";
const props = defineProps({
  type: {
    type: Number as PropType<1 | 2 | 3>,
    default: 1,
  },
});

// æ ‡é¢˜å¯¹è±¡
const titleObj = {
  1: "24å°æ—¶çƒ­é”€æ¦œ",
  2: "å‘¨çƒ­é”€æ¦œ",
  3: "æ€»çƒ­é”€æ¦œ",
};
</script>

<template>
  <div class="goods-hot">
    <h3>{{ titleObj[props.type] }}</h3>
    <div class="goods-list">
      <!-- å•†å“åŒºå— -->
      <GoodsItem v-for="(item, index) in 4" :key="index" />
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-hot {
  background-color: #fff;
  margin-bottom: 20px;
  h3 {
    height: 70px;
    background: @helpColor;
    color: #fff;
    font-size: 18px;
    line-height: 70px;
    padding-left: 25px;
    margin-bottom: 10px;
    font-weight: normal;
  }
  .goods-list {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
}
</style>

```

2ï¼‰ä½¿ç”¨ç»„ä»¶

`src/views/Goods/index.vue`

```jsx
import GoodsHot from './components/goods-hot'

components: { GoodsHot }

<!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
<div class="goods-aside">
  <GoodsHot :type="1" />
  <GoodsHot :type="2" />
  <GoodsHot :type="3" />
</div>
```

### 2. è·å–æ•°æ®æ¸²æŸ“ç»„ä»¶

`src/views/goods/components/goot-hot.vue`

```html
<script setup lang="ts">
// ğŸš¨å¯¼å…¥æ—¶å‡ºç°å‘½åå†²çªï¼Œå¯ä»¥é€šè¿‡ as é‡å‘½å
import type { GoodsItem as Item } from "@/types";
import { http } from "@/utils/request";
import GoodsItem from "@/views/Category/components/goods-item.vue";
import { onMounted, ref, type PropType } from "vue";
import { useRoute } from "vue-router";
const props = defineProps({
  type: {
    type: Number as PropType<1 | 2 | 3>,
    default: 1,
  },
});

// æ ‡é¢˜å¯¹è±¡
const titleObj = {
  1: "24å°æ—¶çƒ­é”€æ¦œ",
  2: "å‘¨çƒ­é”€æ¦œ",
  3: "æ€»çƒ­é”€æ¦œ",
};

// å‘é€è¯·æ±‚è·å–æ•°æ®
const route = useRoute();
const { id } = route.params;
const list = ref<Item[]>([]);
onMounted(async () => {
  const res = await http<Item[]>("GET", "/goods/hot", {
    id: id,
    type: props.type,
  });
  list.value = res.data.result;
});
</script>

<template>
  <div class="goods-hot">
    <h3>{{ titleObj[props.type] }}</h3>
    <div class="goods-list">
      <!-- å•†å“åŒºå— -->
      <GoodsItem v-for="item in list" :key="item.id" :goods="item" />
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-hot {
  background-color: #fff;
  margin-bottom: 20px;
  h3 {
    height: 70px;
    background: @helpColor;
    color: #fff;
    font-size: 18px;
    line-height: 70px;
    padding-left: 25px;
    margin-bottom: 10px;
    font-weight: normal;
  }
  .goods-list {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
}
</style>

```



