# ä¼šå‘˜ä¸­å¿ƒæ¨¡å—

## ä¸ªäººä¸­å¿ƒ

### ä¸ªäººä¸­å¿ƒ-è·¯ç”±é…ç½®

> æœ¬èŠ‚ç›®æ ‡ï¼šä¸ªäººä¸­å¿ƒäºŒçº§è·¯ç”±é…ç½®ã€‚

![image-20210822062307681](./media/image-20210822062307681.png)

ï¼ˆ1ï¼‰åˆ›å»ºç»„ä»¶ `src/views/Member/Layout/index.vue`

```vue
<script setup lang="ts">
//
</script>

<template>
  <div>ä¸ªäººä¸­å¿ƒå¸ƒå±€å®¹å™¨</div>
</template>

```

ï¼ˆ2ï¼‰é…ç½®è·¯ç”±

```js
{
    path: "/",
    component: Layout,
    children: [
      ...
      {
        path: "/member",
        component: () => import("@/views/Member/Layout/index.vue"),
      },
    ],
  },
```

ï¼ˆ3ï¼‰ä¿®æ”¹é¦–é¡µå¤´éƒ¨å¯¼èˆªçš„é“¾æ¥

```jsx
<li>
  <RouterLink to="/member" ><i class="iconfont icon-user"></i>
  	{{ profile.nickname || profile.account }}
  </RouterLink>
</li>

<li><RouterLink to="/member">ä¼šå‘˜ä¸­å¿ƒ</RouterLink></li>
```



### ä¸ªäººä¸­å¿ƒ-ä¸‰çº§è·¯ç”±é…ç½®

> æœ¬èŠ‚ç›®çš„ï¼šå®Œæˆä¸ªäººä¸­å¿ƒé¡µé¢åŸºç¡€æ¶å­ï¼Œé…ç½®è·¯ç”±ã€‚

![image-20210822063714663](./media/image-20210822063714663.png)

å¤§è‡´æ­¥éª¤ï¼š

- å‡†å¤‡ä¸ªäººä¸­å¿ƒå·¦èœå•ç»„ä»¶
- å‡†å¤‡ä¸ªäººä¸­å¿ƒå¸ƒå±€å®¹å™¨ç»„ä»¶
- å‡†å¤‡ä¸ªäººä¸­å¿ƒé¦–é¡µç»„ä»¶
- é…ç½®è·¯ç”±è§„åˆ™

è½åœ°ä»£ç ï¼š

1. å‡†å¤‡ä¸ªäººä¸­å¿ƒå·¦èœå•ç»„ä»¶

`src/views/Member/Layout/components/member-aside.vue`

```vue
<script setup lang="ts">
//
</script>

<template>
  <div class="xtx-member-aside">
    <div class="user-manage">
      <h4>æˆ‘çš„è´¦æˆ·</h4>
      <div class="links">
        <a href="javascript:;">ä¸ªäººä¸­å¿ƒ</a>
        <a href="javascript:;">æ¶ˆæ¯é€šçŸ¥</a>
        <a href="javascript:;">ä¸ªäººä¿¡æ¯</a>
        <a href="javascript:;">å®‰å…¨è®¾ç½®</a>
        <a href="javascript:;">åœ°å€ç®¡ç†</a>
        <a href="javascript:;">æˆ‘çš„ç§¯åˆ†</a>
        <a href="javascript:;">æˆ‘çš„è¶³è¿¹</a>
        <a href="javascript:;">é‚€è¯·æœ‰ç¤¼</a>
        <a href="javascript:;">å¹¸è¿æŠ½å¥–</a>
      </div>
      <h4>äº¤æ˜“ç®¡ç†</h4>
      <div class="links">
        <a href="javascript:;">æˆ‘çš„è®¢å•</a>
        <a href="javascript:;">ä¼˜æƒ åˆ¸</a>
        <a href="javascript:;">ç¤¼å“å¡</a>
        <a href="javascript:;">è¯„ä»·æ™’å•</a>
        <a href="javascript:;">å”®åæœåŠ¡</a>
      </div>
      <h4>æˆ‘çš„æ”¶è—</h4>
      <div class="links">
        <a href="javascript:;">æ”¶è—çš„å•†å“</a>
        <a href="javascript:;">æ”¶è—çš„ä¸“é¢˜</a>
        <a href="javascript:;">å…³æ³¨çš„å“ç‰Œ</a>
      </div>
      <h4>å¸®åŠ©ä¸­å¿ƒ</h4>
      <div class="links">
        <a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a>
        <a href="javascript:;">åœ¨çº¿å®¢æœ</a>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-member-aside {
  width: 220px;
  margin-right: 20px;
  border-radius: 2px;
  .user-manage {
    background-color: #fff;
    h4 {
      font-size: 18px;
      font-weight: 400;
      padding: 20px 52px 5px;
      border-top: 1px solid #f6f6f6;
    }

    .links {
      padding: 0 52px 10px;
    }

    a {
      display: block;
      line-height: 1;
      padding: 15px 0;
      font-size: 14px;
      color: #666;
      position: relative;

      &:hover {
        color: @xtxColor;
      }
      &.active {
        color: @xtxColor;

        &:before {
          display: block;
        }
      }

      &:before {
        content: '';
        display: none;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        position: absolute;
        top: 19px;
        left: -16px;
        background-color: @xtxColor;
      }
    }
  }
}
</style>

```

2. å‡†å¤‡ä¸ªäººä¸­å¿ƒå¸ƒå±€å®¹å™¨ç»„ä»¶

`src/views/Member/Layout/index.vue`

```vue
<script setup lang="ts">
import MemberAside from './components/member-aside.vue';
</script>

<template>
  <div class="container">
    <MemberAside />
    <div class="article">
      <!-- ä¸‰çº§è·¯ç”±çš„æŒ‚è½½ç‚¹ -->
      <RouterView />
    </div>
  </div>
</template>

<style scoped lang="less">
.container {
  display: flex;
  padding-top: 20px;
  .article {
    width: 1000px;
  }
}
</style>

```

3. å‡†å¤‡ä¸­å¿ƒé¦–é¡µç»„ä»¶ï¼š`src/views/Member/Home/index.vue`  

```vue
<script setup lang="ts">
//
</script>

<template>
  <div class="member-home">
    <h2>ä¸ªäººä¸­å¿ƒ</h2>
  </div>
</template>

```

4. å‡†å¤‡è®¢å•ç»„ä»¶ï¼š`src/views/Member/Order/index.vue`

```jsx
<script setup lang="ts">
//
</script>

<template>
  <div class="member-order">
    <h3>è®¢å•åˆ—è¡¨</h3>
  </div>
</template>

```

4. é…ç½®è·¯ç”±è§„åˆ™

```jsx
  {
    path: '/',
    component: Layout,
    children: [
      ...
      {
        path: "/member",
        component: () => import("@/views/Member/Layout/index.vue"),
        children: [
          {
            path: "/member",
            component: () => import("@/views/Member/Home/index.vue"),
          },
          {
            path: "/member/order",
            component: () => import("@/views/Member/Order/index.vue"),
          },
        ],
      },
    ]
  },
```



### æ–°ç‰ˆè·¯ç”±-å¯¼èˆªå®ˆå« ğŸš¨

- `VueRouter@4` çš„çš„ç¬¬ä¸‰ä¸ªå‚æ•° `next` ï¼Œå˜æˆäº†å¯é€‰å‚æ•°ã€‚
- å¯ä»¥é€šè¿‡å‡½æ•°å†…éƒ¨çš„è¿”å›å€¼ `return` å®ç°ä»¥å‰ `next` å‡½æ•°çš„åŠŸèƒ½ã€‚
- å¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œ`undefined` æˆ–è¿”å› `true`ï¼Œ**åˆ™å¯¼èˆªæ˜¯æœ‰æ•ˆçš„**ï¼Œå¹¶è°ƒç”¨ä¸‹ä¸€ä¸ªå¯¼èˆªå®ˆå«ã€‚

```ts
// to      å»å“ªé‡Œ
// from    ä»å“ªé‡Œæ¥
// next    æ”¾è¡Œå‡½æ•°(å¯é€‰)
// è·¯ç”±è®¾è®¡  éœ€è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®çš„é¡µé¢ï¼Œç»Ÿä¸€éƒ½æ˜¯ /member å¼€å¤´
router.beforeEach((to) => {
  const { member } = useStore();
  // è¿›è¡Œåˆ¤æ–­ï¼šæœªç™»å½•æƒ…å†µä½†æ˜¯è®¿é—® /member å¼€å¤´çš„è·¯å¾„ï¼Œéœ€è¦è·³è½¬ç™»å½•é¡µ
  if (!member.isLogin && to.path.startsWith("/member")) {
    return `/login?target=${to.fullPath}`;
  }
});
```

- VueRouter å˜æ›´ï¼šhttps://router.vuejs.org/zh/guide/migration/index.html

- Vue3 å˜æ›´ï¼š https://v3.cn.vuejs.org/guide/migration/introduction.html




### ä¸ªäººä¸­å¿ƒ-èœå•æ¿€æ´»

> ç›®æ ‡ï¼šåŠ¨æ€æ¿€æ´»å·¦ä¾§èœå•

å¤§è‡´æ­¥éª¤ï¼š

- æ·»åŠ ä¸ªäººä¸­å¿ƒè·¯ç”±åœ°å€ï¼Œè®¾ç½®ç²¾å‡†åŒ¹é…ç±»å
- æ·»åŠ æˆ‘çš„è®¢å•è·¯ç”±ä¸ç»„ä»¶

```text
router-link-active         æ¨¡æ‹ŸåŒ¹é…ï¼Œä¸€èˆ¬ç”¨äºçˆ¶çº§è·¯ç”±é«˜äº®
router-link-exact-active   ç²¾ç¡®åŒ¹é…ï¼Œä¸€èˆ¬ç”¨äºå½“å‰è·¯ç”±é«˜äº®
```

ç±»åä¿®æ”¹ï¼š`src/components/app-member-aside.vue`

```vue
<template>
  <div class="xtx-member-aside">
    <div class="user-manage">
      <h4>æˆ‘çš„è´¦æˆ·</h4>
      <div class="links">
+        <RouterLink to="/member">ä¸ªäººä¸­å¿ƒ</RouterLink>
         ...
      </div>
      <h4>äº¤æ˜“ç®¡ç†</h4>
      <div class="links">
+        <RouterLink to="/member/order">æˆ‘çš„è®¢å•</RouterLink>
         ...
      </div>
      ...
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-member-aside {
   ...
  .user-manage {
    ...
    a {
      ...
      
+      // ä¸ªäººä¸­å¿ƒ-å·¦ä¾§èœå•é«˜äº®ç±»å
+      &.router-link-exact-active {
+        color: @xtxColor;
+        &:before {
+          display: block;
+        }
+      }

      ...
    }
  }
}
</style>

```



### ä¸ªäººä¸­å¿ƒ-é¦–é¡µå¸ƒå±€

> æœ¬èŠ‚ç›®æ ‡ï¼šå®Œæˆä¸ªäººä¸­å¿ƒ-é¦–é¡µåŸºç¡€å¸ƒå±€

å¤§è‡´æ­¥éª¤ï¼š

- å‡†å¤‡æ¦‚è§ˆç»„ä»¶
- ç»„ä»¶é¢æ¿ç»„ä»¶

è½åœ°ä»£ç ï¼š

1. å‡†å¤‡æ¦‚è§ˆç»„ä»¶

`src/views/Member/Home/components/home-overview.vue`

```vue
<script setup lang="ts">
//
</script>

<template>
  <!-- æ¦‚è§ˆ -->
  <div class="home-overview">
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <div class="user-meta">
      <div class="avatar">
        <img
          src="http://zhoushugang.gitee.io/erabbit-client-pc-static/uploads/avatar_1.png"
        />
      </div>
      <h4>å¾è²è²</h4>
    </div>
    <div class="item">
      <a href="javascript:;">
        <span class="iconfont icon-hy"></span>
        <p>ä¼šå‘˜ä¸­å¿ƒ</p>
      </a>
      <a href="javascript:;">
        <span class="iconfont icon-aq"></span>
        <p>å®‰å…¨è®¾ç½®</p>
      </a>
      <a href="javascript:;">
        <span class="iconfont icon-dw"></span>
        <p>åœ°å€ç®¡ç†</p>
      </a>
    </div>
  </div>
</template>

<style scoped lang="less">
.home-overview {
  height: 132px;
  background: url(@/assets/images/center-bg.png) no-repeat center / cover;
  display: flex;
  .user-meta {
    flex: 1;
    display: flex;
    align-items: center;
    .avatar {
      width: 85px;
      height: 85px;
      border-radius: 50%;
      overflow: hidden;
      margin-left: 60px;
      img {
        width: 100%;
        height: 100%;
      }
    }
    h4 {
      padding-left: 26px;
      font-size: 18px;
      font-weight: normal;
      color: white;
    }
  }
  .item {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    &:first-child {
      border-right: 1px solid #f4f4f4;
    }
    a {
      color: white;
      font-size: 16px;
      text-align: center;
      .iconfont {
        font-size: 32px;
      }
      p {
        line-height: 32px;
      }
    }
  }
}
</style>

```

2. ç»„ä»¶é¢æ¿ç»„ä»¶

`src/views/Member/Home/components/home-panel.vue`

```vue
<script setup lang="ts">
defineProps<{
  title: string;
}>();
</script>

<template>
  <div class="home-panel">
    <div class="header">
      <h4>{{ title }}</h4>
      <XtxMore to="/" />
    </div>
    <!-- å•†å“åˆ—è¡¨ -->
    <div class="goods-list"></div>
  </div>
</template>

<style scoped lang="less">
.home-panel {
  background-color: #fff;
  padding: 0 20px;
  margin-top: 20px;
  height: 400px;
  .header {
    height: 66px;
    border-bottom: 1px solid #f5f5f5;
    padding: 18px 0;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    h4 {
      font-size: 22px;
      font-weight: normal;
    }
  }
}
</style>

```

3. ä½¿ç”¨é¢æ¿ç»„ä»¶ï¼ŒçŒœä½ å–œæ¬¢ç»„ä»¶

`src/views/member/home/index.vue`

```vue
<script setup lang="ts">
import HomeOverview from "./components/home-overview.vue";
import HomePanel from "./components/home-panel.vue";
</script>

<template>
  <div class="member-home">
    <HomeOverview />
    <HomePanel title="æ”¶è—çš„å•†å“" />
    <HomePanel title="æˆ‘çš„è¶³è¿¹" />
  </div>
</template>
```



### ä¸ªäººä¸­å¿ƒ-æ¸²æŸ“é¡µé¢

> ç›®çš„ï¼šç”¨æˆ·ä¿¡æ¯å±•ç¤ºï¼Œé¢æ¿å†…å•†å“å±•ç¤ºã€‚

`src/views/member/home/components/home-overview.vue`

```vue
<script setup lang="ts">
import useStore from "@/store";
import { storeToRefs } from "pinia";
// å›¾ç‰‡åŠ è½½å¤±è´¥ä¼šè§¦å‘ error äº‹ä»¶ï¼ŒåŠ è½½å¤±è´¥ä½¿ç”¨é»˜è®¤å ä½å›¾
import defaultImg from "@/assets/images/200.png";

const { member } = useStore();
// è§£æ„ profile å¹¶ä¿æŒå“åº”å¼
const { profile } = storeToRefs(member);
</script>

<template>
  <!-- æ¦‚è§ˆ -->
  <div class="home-overview">
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <div class="user-meta">
      <div class="avatar">
        <img :src="profile.avatar" @error="profile.avatar = defaultImg;" />
      </div>
      <h4>
        {{ profile.nickname || profile.account || profile.mobile }}
      </h4>
    </div>
    ...
  </div>
</template>
```



## è®¢å•ç®¡ç†

![image-20210822072536117](./media/image-20210822072536117-164598173513312.png)



```vue
<script setup lang="ts">
import { ref } from "vue";

// ç”¨äºåŒå‘ç»‘å®šé«˜äº®çš„åç§°
const activeName = ref("all");
// ç‚¹å‡» tab è§¦å‘çš„è‡ªå®šä¹‰äº‹ä»¶
const tabClick = (index: number) => {
  console.log("å½“å‰ç‚¹å‡»çš„ä¸‹æ ‡ä¸º", index);
};
</script>

<template>
  <div class="member-order">
    <XtxTabs v-model="activeName" @tab-click="({ index }) => tabClick(index)">
      <XtxTabPane name="all" label="å…¨éƒ¨è®¢å•">1</XtxTabPane>
      <XtxTabPane name="unpay" label="å¾…ä»˜æ¬¾">2</XtxTabPane>
      <XtxTabPane name="deliver" label="ä»£å‘è´§">3</XtxTabPane>
    </XtxTabs>
  </div>
</template>

```





### è®¢å•ç®¡ç† - ä½¿ç”¨ Tabs ç»„ä»¶

`src/constants/order.ts`   è®¢å•çŠ¶æ€å¸¸é‡æ•°æ®ï¼Œå¤šä¸ªç»„ä»¶éƒ½è¦ç”¨åˆ°è¿™ä¸ªæ•°ç»„ï¼Œå®šä¹‰æˆå¸¸é‡æ–¹ä¾¿å¤ç”¨ã€‚

```js
// è®¢å•çŠ¶æ€
export const orderStatus = [
  { name: "all", label: "å…¨éƒ¨è®¢å•" },
  { name: "unpay", label: "å¾…ä»˜æ¬¾" },
  { name: "deliver", label: "å¾…å‘è´§" },
  { name: "receive", label: "å¾…æ”¶è´§" },
  { name: "comment", label: "å¾…è¯„ä»·" },
  { name: "complete", label: "å·²å®Œæˆ" },
  { name: "cancel", label: "å·²å–æ¶ˆ" },
];

```

`src/views/Member/Order/index.vue`

```vue
<script setup lang="ts">
import { ref } from "vue";
import { orderStatus } from "@/constants";

// ç”¨äºåŒå‘ç»‘å®šé«˜äº®çš„åç§°
const activeName = ref(orderStatus[0].name);
</script>

<template>
  <div class="member-order">
    <XtxTabs v-model="activeName">
      <XtxTabPane
        v-for="item in orderStatus"
        :key="item.name"
        :name="item.name"
        :label="item.label"
      />
    </XtxTabs>
  </div>
</template>

```



### è®¢å•ç®¡ç† - é™æ€å¸ƒå±€ - CV

> ç›®æ ‡ï¼šå®Œæˆè®¢å•é™æ€å¸ƒå±€ã€‚
>

![image-20210822072943219](./media/image-20210822072943219.png)



1. æ–°å»º è®¢å•é¡¹ `order-item` ç»„ä»¶ï¼š `src/views/Member/Order/components/order-item.vue`

```vue
<script setup lang="ts">
//
</script>

<template>
  <div class="order-item">
    <div class="head">
      <span>ä¸‹å•æ—¶é—´ï¼š2022-02-07 00:05:20</span>
      <span>è®¢å•ç¼–å·ï¼š62205697599</span>
      <span class="down-time">
        <i class="iconfont icon-down-time"></i>
        <b>ä»˜æ¬¾æˆªæ­¢ï¼š28åˆ†20ç§’</b>
      </span>
    </div>
    <div class="body">
      <div class="column goods">
        <ul>
          <li v-for="item in 2" :key="item">
            <a class="image" href="javascript:;">
              <img
                src="https://yanxuan-item.nosdn.127.net/f7a4f643e245d03771d6f12c94e71214.png"
                alt=""
              />
            </a>
            <div class="info">
              <p class="name ellipsis-2">
                åŸåˆ›è®¾è®¡ä¸€ä½“åŒ–æœºèº«,ç²¾è‡´è¿·ä½ ç ´å£æœº350mL
              </p>
              <p class="attr ellipsis">
                <span>é¢œè‰²ï¼šç»¿è‰²</span>
                <span>å°ºå¯¸ï¼š10å¯¸</span>
              </p>
            </div>
            <div class="price">Â¥9.50</div>
            <div class="count">x1</div>
          </li>
        </ul>
      </div>
      <div class="column state">
        <p>å¾…ä»˜æ¬¾</p>
      </div>
      <div class="column amount">
        <p class="red">Â¥19.00</p>
        <p>ï¼ˆå«è¿è´¹ï¼šÂ¥10.00ï¼‰</p>
        <p>åœ¨çº¿æ”¯ä»˜</p>
      </div>
      <div class="column action">
        <XtxButton type="primary" size="small">ç«‹å³ä»˜æ¬¾</XtxButton>
        <p><a href="javascript:;">æŸ¥çœ‹è¯¦æƒ…</a></p>
        <p><a href="javascript:;">å–æ¶ˆè®¢å•</a></p>
      </div>
    </div>
  </div>
</template>

<style lang="less" scoped>
.order-item {
  margin-bottom: 20px;
  border: 1px solid #f5f5f5;
  .head {
    height: 50px;
    line-height: 50px;
    background: #f5f5f5;
    padding: 0 20px;
    overflow: hidden;
    span {
      margin-right: 20px;
      &.down-time {
        margin-right: 0;
        float: right;
        i {
          vertical-align: middle;
          margin-right: 3px;
        }
        b {
          vertical-align: middle;
          font-weight: normal;
        }
      }
    }
    .del {
      margin-right: 0;
      float: right;
      color: #999;
    }
  }
  .body {
    display: flex;
    align-items: stretch;
    .column {
      border-left: 1px solid #f5f5f5;
      text-align: center;
      padding: 20px;
      > p {
        padding-top: 10px;
      }
      &:first-child {
        border-left: none;
      }
      &.goods {
        flex: 1;
        padding: 0;
        align-self: center;
        ul {
          li {
            border-bottom: 1px solid #f5f5f5;
            padding: 10px;
            display: flex;
            &:last-child {
              border-bottom: none;
            }
            .image {
              width: 70px;
              height: 70px;
              border: 1px solid #f5f5f5;
            }
            .info {
              width: 220px;
              text-align: left;
              padding: 0 10px;
              p {
                margin-bottom: 5px;
                &.name {
                  height: 38px;
                }
                &.attr {
                  color: #999;
                  font-size: 12px;
                  span {
                    margin-right: 5px;
                  }
                }
              }
            }
            .price {
              width: 100px;
            }
            .count {
              width: 80px;
            }
          }
        }
      }
      &.state {
        width: 120px;
        .green {
          color: @xtxColor;
        }
      }
      &.amount {
        width: 200px;
        .red {
          color: @priceColor;
        }
      }
      &.action {
        width: 140px;
        a {
          display: block;
          &:hover {
            color: @xtxColor;
          }
        }
      }
    }
  }
}
</style>

```

2. åœ¨åˆ—è¡¨é¡µä¸­ä½¿ç”¨ï¼š`src\views\Member\Order\index.vue`

```vue
<script setup lang="ts">
import { ref } from "vue";
import { orderStatus } from "@/constants/order";
import OrderItem from "./components/order-item.vue";
const activeName = ref("all");
</script>

<template>
  <div class="member-order-page">
    <!-- 1. Tabs ç»„ä»¶ -->
    <XtxTabs v-model="activeName">
      <XtxTabPane
        v-for="item in orderStatus"
        :key="item.name"
        :label="item.label"
        :name="item.name"
      />
    </XtxTabs>
    <!-- 2. å•†å“åˆ—è¡¨ -->
    <div class="order-list">
      <OrderItem />
      <OrderItem />
      <OrderItem />
    </div>
  </div>
</template>

<style scoped lang="less">
.order-list {
  background-color: #fff;
  padding: 20px;
}
</style>

```



### è®¢å•ç®¡ç† - è®¢å•åˆ—è¡¨æ•°æ®è·å–

#### æ¥å£ï¼šè·å–æˆ‘çš„è®¢å•

**Pathï¼š** /member/order

**Methodï¼š** GET

**è¯·æ±‚å‚æ•°**

**Query**

| å‚æ•°åç§°   | æ˜¯å¦å¿…é¡» | ç¤ºä¾‹ | å¤‡æ³¨                                                         |
| ---------- | -------- | ---- | ------------------------------------------------------------ |
| page       | æ˜¯       | 1    | é¡µç                                                          |
| pageSize   | æ˜¯       | 10   | é¡µå°ºå¯¸                                                       |
| orderState | å¦       | 1    | è®¢å•çŠ¶æ€ï¼Œ1ä¸ºå¾…ä»˜æ¬¾ã€2ä¸ºå¾…å‘è´§ã€3ä¸ºå¾…æ”¶è´§ã€4ä¸ºå¾…è¯„ä»·ã€5ä¸ºå·²å®Œæˆã€6ä¸ºå·²å–æ¶ˆï¼Œæœªä¼ è¯¥å‚æ•°æˆ–0ä¸ºå…¨éƒ¨ |

#### å‘é€è¯·æ±‚è·å–è®¢å•åˆ—è¡¨

`src\views\Member\Order\index.vue`

```vue
<script setup lang="ts">
import { onMounted, ref, reactive } from "vue";
import { orderStatus } from "@/constants";
import OrderItem from "./components/order-item.vue";
import { http } from "@/utils/request";
// ç”¨äºåŒå‘ç»‘å®šé«˜äº®çš„åç§°
const activeName = ref(orderStatus[0].name);

// å¯¹è±¡ç»“æ„ç¡®å®šï¼Œå¯ä»¥ç”¨ reactive å®šä¹‰å“åº”å¼å¯¹è±¡
const query = reactive({
  orderState: 0,
  page: 1,
  pageSize: 2,
});

// è®¢å•åˆ—è¡¨æ€»ä¿¡æ¯
onMounted(async () => {
  // æ ¹æ®å‚æ•°è·å–è®¢å•åˆ—è¡¨ä¿¡æ¯
  const res = await http<OrderListInfo>("GET", "/member/order", query);
  console.log("GET", "/member/order", res.data.result);
});
</script>
```

#### æ·»åŠ  TS ç±»å‹å£°æ˜

æ·»åŠ ç±»å‹å£°æ˜ï¼š`src\types\api\order.d.ts`

```ts

// è®¢å•é¡¹
export interface OrderItem {
  id: string;
  createTime: string;
  payType: number;
  orderState: number;
  payLatestTime: string;
  postFee: number;
  payMoney: number;
  totalMoney: number;
  totalNum: number;
  skus: Sku[];
  payChannel: number;
  countdown: number;
}

// è®¢å•åˆ—è¡¨åˆ«å
export type OrderList = OrderItem[];

// è®¢å•åˆ—è¡¨æ€»ä¿¡æ¯
export interface OrderListInfo {
  counts: number;
  pageSize: number;
  pages: number;
  page: number;
  // åº”ç”¨è®¢å•åˆ—è¡¨åˆ«å
  items: OrderList;
}

```



### è®¢å•ç®¡ç† - åˆ—è¡¨æ¸²æŸ“ ğŸš¨

> ç›®æ ‡ï¼šå®Œæˆè®¢å•åˆ—è¡¨é»˜è®¤æ¸²æŸ“ã€‚



**å¤§è‡´æ­¥éª¤ï¼š**

- æ•°æ®çˆ¶ä¼ å­
- æ¸²æŸ“è®¢å•æ•°æ®



**è½åœ°ä»£ç ï¼š**

1. å®šä¹‰å“åº”å¼æ•°æ®

```diff
<script setup lang="ts">
+import type { OrderListInfo } from "@/types";

...

+// è®¢å•åˆ—è¡¨æ€»ä¿¡æ¯
+const orderListInfo = ref<OrderListInfo>();
onMounted(async () => {
  // æ ¹æ®å‚æ•°è·å–è®¢å•åˆ—è¡¨ä¿¡æ¯
  const res = await http<OrderListInfo>("GET", "/member/order", query);
  console.log("GET", "/member/order", res.data.result);
+  orderListInfo.value = res.data.result;
});
</script>
```



2. åˆ—è¡¨å¾ªç¯ï¼Œæ•°æ®çˆ¶ä¼ å­ã€‚

```vue
<div class="order-list">
    <OrderItem v-for="item in orderListInfo?.items" :key="item.id" :order="item" />
</div>
```

5. æ¸²æŸ“ `OrderItem` å­ç»„ä»¶

```html
<script setup lang="ts">
import { orderStatus } from "@/constants/order";
import { useCountDown } from "@/hooks";
import type { OrderItem } from "@/types";
interface Props {
  order: OrderItem;
}
const props = defineProps<Props>();
const { countTimeText, start } = useCountDown();
start(props.order.countdown);
</script>

<template>
  <div class="order-item" v-if="order.id">
    <div class="head">
      <span>ä¸‹å•æ—¶é—´ï¼š{{ order.createTime }}</span>
      <span>è®¢å•ç¼–å·ï¼š{{ order.id }}</span>
      <!-- æœªä»˜æ¬¾ï¼Œå€’è®¡æ—¶æ—¶é—´è¿˜æœ‰ -->
      <span class="down-time">
        <i class="iconfont icon-down-time"></i>
        <b>ä»˜æ¬¾æˆªæ­¢ï¼š{{ countTimeText }}</b>
      </span>
    </div>
    <div class="body">
      <div class="column goods">
        <ul>
          <li v-for="item in order.skus" :key="item.id">
            <a class="image" href="javascript:;">
              <img :src="item.image" alt="" />
            </a>
            <div class="info">
              <p class="name ellipsis-2">
                {{ item.name }}
              </p>
              <p class="attr ellipsis">
                <span>{{ item.attrsText }}</span>
              </p>
            </div>
            <div class="price">Â¥{{ item.realPay }}</div>
            <div class="count">x{{ item.quantity }}</div>
          </li>
        </ul>
      </div>
      <div class="column state">
        <p>{{ orderStatus[order.orderState].label }}</p>
        <p v-if="order.orderState === 3">
          <a href="javascript:;" class="green">æŸ¥çœ‹ç‰©æµ</a>
        </p>
        <p v-if="order.orderState === 4">
          <a href="javascript:;" class="green">è¯„ä»·å•†å“</a>
        </p>
        <p v-if="order.orderState === 5">
          <a href="javascript:;" class="green">æŸ¥çœ‹è¯„ä»·</a>
        </p>
      </div>
      <div class="column amount">
        <p class="red">Â¥{{ order.payMoney }}</p>
        <p>ï¼ˆå«è¿è´¹ï¼šÂ¥{{ order.postFee }}ï¼‰</p>
        <p>åœ¨çº¿æ”¯ä»˜</p>
      </div>
      <div class="column action">
        <XtxButton v-if="order.orderState === 1" type="primary" size="small">
            ç«‹å³ä»˜æ¬¾
        </XtxButton>
        <XtxButton v-if="order.orderState === 3" type="primary" size="small">
            ç¡®è®¤æ”¶è´§
        </XtxButton>
        <p><a href="javascript:;">æŸ¥çœ‹è¯¦æƒ…</a></p>
        <p v-if="[2, 3, 4, 5].includes(order.orderState)">>
          <a href="javascript:;">å†æ¬¡è´­ä¹°</a>
        </p>
        <p v-if="[4, 5].includes(order.orderState)">
          <a href="javascript:;">ç”³è¯·å”®å</a>
        </p>
        <p v-if="order.orderState === 1"><a href="javascript:;">å–æ¶ˆè®¢å•</a></p>
      </div>
    </div>
  </div>
</template>
```



### è®¢å•ç®¡ç† -  åˆ‡æ¢åˆ—è¡¨

æ¨¡æ‹Ÿå‘è´§ï¼šhttp://pcapi-xiaotuxian-front-devtest.itheima.net/member/order/consignment/:id

```jsx
<XtxTabs v-model="activeName"  @tab-click="({ index }) => tabClick(index)">
  <XtxTabsPanel
    v-for="item in orderStatus"
    :key="item.name"
    :label="item.label"
    :name="item.name"
  />
</XtxTabs>


const loadDate = async () => {
  const res = await http<OrderListInfo>("GET", "/member/order", requestParams);
  console.log("GET", "/member/order", res.data.result);
  orderListInfo.value = res.data.result;
};

watch(
  requestParams,
  () => {
    loadDate();
  },
  { im./mediate: true }
);

const tabClick = (index: number) => {
  requestParams.orderState = index;
};
```



##  tabs ç»„ä»¶å°è£… -TSX

> ç›®çš„ï¼šå°è£…ä¸€ä¸ªé«˜å¯ç”¨ tabs ç»„ä»¶ã€‚ç±»ä¼¼äºï¼šhttps://element-plus.gitee.io/zh-CN/component/tabs.html

å¤§è‡´æ­¥éª¤ï¼š

- `xtx-tabs` ç»„ä»¶å®¹å™¨ å¯ä»¥æœ‰å¤šä¸ª `xtx-tab-pane` ç»„ä»¶é¢æ¿ï¼Œ`script` å†…å®¹ `<slot />`
- `xtx-tab-pane` æ”¯æŒï¼š  æ ‡é¢˜ `label`ï¼Œåç§° `name`ï¼Œ`template` å†…å®¹ `<slot />`
- `xtx-tabs`  ç»„ä»¶ç»„ç»‡ç»“æ„ï¼Œæ§åˆ¶ç‚¹å‡»äº‹ä»¶ï¼Œæ ‡ç­¾é¡µæ¿€æ´»ã€‚



### å°è£… tabs ç»„ä»¶ - å‡†å¤‡ç»“æ„

å‡†å¤‡ä¸¤ä¸ªç»„ä»¶

`src\views\Test\components\Tabs\index.vue`

```jsx
<script setup lang="tsx">
const Tabs = () => {
  return <div class="xtx-tabs">tabs</div>;
};
</script>

<template>
  <Tabs />
</template>
```



`src\views\Test\components\Tabs\pane.vue`

```vue
<script setup lang="ts">
interface Props {
  label?: string;
  name?: string;
}
defineProps<Props>();
</script>

<template>
  <div class="xtx-tabs-panel">
    <slot></slot>
  </div>
</template>
```



**ä½¿ç”¨ç»„ä»¶**

`src\views\Test\index.vue`

```vue
<script setup lang="ts">
import Tabs from "./components/Tabs/index.vue";
import TabPane from "./components/Tabs/pane.vue";
</script>

<template>
  <Tabs>
    <TabPane name="all" label="å…¨éƒ¨">
      <h1>å…¨éƒ¨çš„å†…å®¹</h1>
    </TabPane>
    <TabPane name="unpay" label="å¾…ä»˜æ¬¾">
      <h1>å¾…ä»˜æ¬¾å†…å®¹</h1>
    </TabPane>
  </Tabs>
</template>

```

### å°è£… tabs ç»„ä»¶ - TSX/JSX æ’æ§½ ğŸš¨

é€šè¿‡ `useSlots()` è·å–æ’æ§½ï¼Œ æ¸²æŸ“å†…å®¹

```jsx
<script setup lang="tsx">
import { useSlots, type Slots } from "vue";

const slots: Slots = useSlots();
const panels = slots.default?.();
const navs = (
  <nav>
    <a href="javascript:;">æ ‡é¢˜1</a>
    <a href="javascript:;">æ ‡é¢˜2</a>
    <a href="javascript:;">æ ‡é¢˜3</a>
    <a href="javascript:;">æ ‡é¢˜4</a>
    <a href="javascript:;">æ ‡é¢˜5</a>
  </nav>
);

const Tabs = () => {
  return <div class="xtx-tabs">{[navs, panels]}</div>;
};
</script>

<template>
  <Tabs />
</template>
```

nav å¤´éƒ¨å¯¼èˆªï¼Œåº”è¯¥åŸºäº `slots.default()` åŠ¨æ€æ¸²æŸ“

```jsx
<script setup lang="tsx">
import { useSlots, type Slots } from "vue";

const slots: Slots = useSlots();
const panels = slots.default?.();
const navs = (
  <nav>
    {panels?.map((item) => {
      return <a href="javascript:;">{item.props?.label}</a>;
    })}
  </nav>
);
const Tabs = () => {
  return <div class="xtx-tabs">{[navs, panels]}</div>;
};
</script>

<template>
  <Tabs />
</template>
```

### å°è£… tabs ç»„ä»¶ - æ”¯æŒ v-model

`src\views\Test\index.vue`

```vue
<script setup lang="ts">
import { ref } from "vue";
import Tabs from "./components/Tabs/index.vue";
import TabPane from "./components/Tabs/pane.vue";

const activeName = ref("all");
</script>

<template>
  <Tabs v-model="activeName">
    <TabPane name="all" label="å…¨éƒ¨" />
    <TabPane name="unpay" label="å¾…ä»˜æ¬¾" />
  </Tabs>
</template>
```

`src\views\Test\components\Tabs\index.vue`

```vue
<script setup lang="tsx">
import { useSlots, type Slots, type VNode } from "vue";

interface Props {
  modelValue?: string;
}
const props = defineProps<Props>();
const emit = defineEmits(["update:modelValue"]);
console.log(props, emit);

const slots: Slots = useSlots();
const panels = slots.default?.();
const navs = (
  <nav>
    {panels?.map((item, index) => {
      return (
        <a
          href="javascript:;"
          class={{ active: props.modelValue === item.props?.name }}
          onClick={() => clickFn(item, index)}
        >
          {item.props?.label}
        </a>
      );
    })}
  </nav>
);

const clickFn = (item: VNode, index: number) => {
  console.log({ item, index });
  emit("update:modelValue", item?.props?.name);
};

const Tabs = () => {
  return <div class="xtx-tabs">{[navs, panels]}</div>;
};
</script>

<template>
  <Tabs />
</template>

```

### å°è£… tabs ç»„ä»¶ -  é¢æ¿åˆ‡æ¢ - ä¾èµ–æ³¨å…¥

tabsç»„ä»¶ï¼š`src\views\Test\components\Tabs\index.vue`

```diff
<script setup lang="tsx">
+import { provide } from "vue";
...
+const { modelValue } = toRefs(props);
+provide("activeNameValue", modelValue);
</script>
```

tabs-pane ç»„ä»¶æ¥æ”¶

```diff
<script setup lang="ts" name="pane">
import { inject } from "vue";

interface Props {
  label?: string;
  name?: string;
}
defineProps<Props>()
+const activeNameValue = inject("activeNameValue");
</script>

<template>
+  <div class="xtx-tabs-panel" v-show="activeNameValue === name">
    <slot></slot>
  </div>
</template>
```



### å°è£… tabs ç»„ä»¶ - v-for æ¸²æŸ“

```js
// è®¢å•çŠ¶æ€
const orderStatus = [
  { name: 'all', label: 'å…¨éƒ¨è®¢å•' },
  { name: 'unpay', label: 'å¾…ä»˜æ¬¾' },
  { name: 'deliver', label: 'å¾…å‘è´§' },
  { name: 'receive', label: 'å¾…æ”¶è´§' },
  { name: 'comment', label: 'å¾…è¯„ä»·' },
  { name: 'complete', label: 'å·²å®Œæˆ' },
  { name: 'cancel', label: 'å·²å–æ¶ˆ' }
]
```

ç»„ä»¶å‡çº§ï¼š

- åŠ¨æ€åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ï¼Œç»„ç»‡tabsåˆ—è¡¨

```jsx
const arr = slots.default?.()
const panes = []

arr.forEach(item => {
  // å¤„ç†åŸºæœ¬çš„å†™æ³•ï¼Œç›´æ¥å†…éƒ¨å†™ XtxTabsPanel
  if (item.type.name === 'XtxTabsPane') {
    panes.push(item)
  } else {
    // å¤„ç†v-forçš„æƒ…å†µ
    if (item.children && item.children[0]?.type?.name === 'XtxTabsPane') {
      // ä¸€ä¸ªèŠ‚ç‚¹ => 7ä¸ªpanel
      item.children.forEach(panel => {
        panes.push(panel)
      })
    }
  }
})
```



### æ”¯æŒ tab-click  - å®Œæ•´ä»£ç 

`src/components/Tabs/index.vue`

```vue
<script>
import { provide, toRefs } from 'vue'
export default {
  name: 'XtxTabs',
  props: {
    modelValue: {
      type: String,
      default: ''
    }
  },
  setup (props, { emit }) {
    const clickFn = (item, index) => {
      // console.log('ç‚¹å‡»äº†å¯¼èˆª')
      // å­ä¼ çˆ¶ï¼Œæ›´æ–°åˆ°çˆ¶ç»„ä»¶çš„ modelValue
      emit('update:modelValue', item.props.name)
      emit('tab-click', {
        tab: item,
        index: index
      })
    }

    // å“åº”å¼æ•°æ®çš„èƒ½åŠ›ï¼šåœ¨propsèº«ä¸Š
    // ä¼ é€’è¿‡å»çš„ï¼Œä¸æ˜¯ä¸€ä¸ªå“åº”å¼çš„æ•°æ®ï¼Œå˜äº†ï¼Œæ˜¯ä¸ä¼šæ›´æ–°çš„
    const { modelValue } = toRefs(props)
    provide('activeName', modelValue)

    return {
      clickFn
    }
  },

  render () {
    const arr = this.$slots.default()
    const panels = []

    arr.forEach(item => {
      // å¤„ç†åŸºæœ¬çš„å†™æ³•ï¼Œç›´æ¥å†…éƒ¨å†™ XtxTabsPanel
      if (item.type.name === 'XtxTabsPanel') {
        panels.push(item)
      } else {
        // å¤„ç†v-forçš„æƒ…å†µ
        if (item.children && item.children[0]?.type?.name === 'XtxTabsPanel') {
          // ä¸€ä¸ªèŠ‚ç‚¹ => 7ä¸ªpanel
          item.children.forEach(panel => {
            panels.push(panel)
          })
        }
      }
    })

    const nav = (
      <nav>
        {
          panels.map((item, index) => {
            return (
              <a
                class={ { active: this.modelValue === item.props.name } }
                href="javascript:;"
                onClick={() => this.clickFn(item, index)}
              >
                {item.props.label}
              </a>
            )
          })
        }
      </nav>
    )

    return (
      <div class="xtx-tabs">
        {[nav, panels]}
      </div>
    )
  }
}
</script>

<style lang="less">
.xtx-tabs {
  background: #fff;
  > nav {
    height: 60px;
    line-height: 60px;
    display: flex;
    border-bottom: 1px solid #f5f5f5;
    > a {
      width: 110px;
      border-right: 1px solid #f5f5f5;
      text-align: center;
      font-size: 16px;
      &.active {
        border-top: 2px solid @xtxColor;
        height: 60px;
        background: #fff;
        line-height: 56px;
      }
    }
  }
}
</style>

```

`src/components/Tabs/panel.vue`

```vue
<template>
  <div class="xtx-tabs-panel" v-show="activeName === name">
    <slot></slot>
  </div>
</template>

<script>
import { inject } from 'vue'
export default {
  name: 'XtxTabsPanel',
  props: {
    label: {
      type: String,
      default: ''
    },
    name: {
      type: String,
      default: ''
    }
  },
  setup () {
    const activeName = inject('activeName')
    return { activeName }
  }
}
</script>
```











