

# é»‘é©¬ä¼˜è´­-åˆ†ç±»

## ä»Šæ—¥é‡ç‚¹

* å•†å“åˆ†ç±»å’Œæœç´¢

## 01-åˆ†ç±»-éœ€æ±‚åˆ†æ

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å•†åŸåˆ†ç±»åŠŸèƒ½éœ€æ±‚åˆ†æ

* æ¨¡ç‰ˆç»“æ„åˆ†æ

* é¡µé¢æ»šåŠ¨å’ŒåŒºåŸŸæ»šåŠ¨

  ç§»åŠ¨ç«¯ä¸¤è€…ä¹‹é—´å­˜åœ¨å†²çªï¼Œå°ç¨‹åºä¸‹ä½¿ç”¨**scroll-viewç»„ä»¶å®ç°åŒºåŸŸæ»šåŠ¨**ã€‚

* æ¥å£åˆ†æ

æŠ€å·§ï¼šä½¿ç”¨å¾®ä¿¡ç¼–è¯‘æ¨¡å¼åˆ‡æ¢åˆ†ç±»ä¸ºé»˜è®¤é¦–é¡µ

## 02-åˆ†ç±»-è·å–æ•°æ®-æ¸²æŸ“

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**è·å–åˆ†ç±»æ•°æ®ï¼Œæ¸²æŸ“æ¨¡ç‰ˆ

![image-20211121121249640](./assets/image-20211121121249640.png)

æ­¥éª¤ï¼š

1. é»˜è®¤æ¸²æŸ“ç¬¬ä¸€ä¸ªäºŒçº§åˆ†ç±»
2. ä½¿ç”¨è®¡ç®—å±æ€§ï¼Œå¤„ç†äºŒä¸‰çº§åˆ†ç±»æ¸²æŸ“æ•°æ®

```js
  data() {
    return {
      // åˆ†ç±»æ•°æ®
      cates: []
    };
  },
  computed: {
    // å­çº§åˆ†ç±»
    sub() {
      return this.cates.length && this.cates[0].children;
    }
  },
  methods: {
    // è·å–åˆ†ç±»æ•°æ®
    async getCate() {
      const { msg, data } = await this.request({
        url: "/api/public/v1/categories"
      });
      console.log(msg, data);
      if (msg.status === 200) {
        this.cates = data;
      }
    }
  },
  onLoad() {
    this.getCate();
  },
```

```html
    <!-- åˆ†ç±» -->
    <view class="category">
      <!-- é¡¶çº§åˆ†ç±» -->
      <view class="sup">
        <scroll-view scroll-y>
          <text
            :key="item.cat_id"
            v-for="(item,i) in cates"
          >{{item.cat_name}}</text>
        </scroll-view>
      </view>
      <!-- å­çº§åˆ†ç±» -->
      <view class="sub">
        <scroll-view scroll-y>
          <!-- å°é¢å›¾ -->
          <image src="http://static.botue.com/ugo/uploads/category.png" class="thumb" />
          <view class="children" :key="item.cat_id" v-for="item in sub">
            <view class="title">{{item.cat_name}}</view>
            <!-- å“ç‰Œ -->
            <view class="brands">
              <navigator
                :url="'/packone/list/index?query='+it.cat_name"
                :key="it.cat_id"
                v-for="it in item.children"
              >
                <image :src="it.cat_icon" />
                <text>{{it.cat_name}}</text>
              </navigator>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>
```

æ³¨æ„ï¼šå¤„ç†catesç©ºæ•°ç»„æƒ…å†µ=ã€‹è·Ÿå…ƒç´ `<view v-if="cates.length">`

## 03-åˆ†ç±»-äº¤äº’åŠŸèƒ½

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å®ç°åˆ†ç±»åˆ‡æ¢åŠŸèƒ½

æ­¥éª¤ï¼š

1. ç»‘å®šäº‹ä»¶ï¼Œè·å–ç´¢å¼•ï¼Œè®¾ç½®å½“å‰é€‰ä¸­çš„ä¸€çº§åˆ†ç±»ç´¢å¼•
2. æ ¹æ®ç´¢å¼•æ·»åŠ classé«˜äº®æ ·å¼

```js
  data() {
    return {
      // ä¸€çº§åˆ†ç±»é€‰ä¸­çš„ç´¢å¼•
      active: 0
    };
  },
```

```js
      <!-- é¡¶çº§åˆ†ç±» -->
      <view class="sup">
        <scroll-view scroll-y>
          <text
            @click="switchCate(i)"
            :class="{active:i === active}"
            :key="item.cat_id"
            v-for="(item,i) in cates"
          >{{item.cat_name}}</text>
        </scroll-view>
      </view>
```

```js
    switchCate(index) {
      this.active = index;
    },
```



## 04-åˆ†ç±»-æœç´¢-å»ºè®®å•†å“

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å®ç°æœç´¢ç»„ä»¶ï¼Œæœç´¢æ—¶å±•ç¤ºå»ºè®®çš„å•†å“åç§°åˆ—è¡¨

![image-20211121121420478](./assets/image-20211121121420478.png)

è¯´æ˜ï¼šAPIæŸ¥è¯¢å»ºè®®å•†å“`/api/public/v1/goods/qsearch`

æ­¥éª¤ï¼š

1. æœç´¢æ¡†ç»‘å®šinputäº‹ä»¶å’Œv-model
2. æ ¹æ®å…³é”®è¯æŸ¥è¯¢APIæ¥å£ï¼Œè·å–å»ºè®®çš„å•†å“æ•°æ®ï¼Œå¹¶å±•ç¤º

   * æ ¹æ®resulté•¿åº¦ï¼Œæ¡ä»¶æ¸²æŸ“=ã€‹æ˜¯å¦æ˜¾ç¤ºå»ºè®®å•†å“åˆ—è¡¨

`search.vue`

äº‹ä»¶å’Œæ¨¡æ¿æ¸²æŸ“

```diff
    <view class="sinput">
      <input
        @focus="search"
        type="text"
+        @input="searchPrd"
+        v-model="keyWord"
        placeholder="æœç´¢"
      />
      <button @click="cancel">å–æ¶ˆ</button>
    </view>

    <!-- æœç´¢çŠ¶æ€æ˜¾ç¤º=ã€‹ä¸‹è¾¹å†…å®¹ -->
    <view class="scontent" v-show="isSearch">
      <!-- æœç´¢å†å² -->
+      <block v-if="result.length === 0">
        <div class="title">
          æœç´¢å†å²
          <span class="clear"></span>
        </div>
        <!-- æœç´¢å†å² -->
        <div class="history">
          <navigator url="/pages/list/index">å°ç±³</navigator>
          <navigator url="/pages/list/index">æ™ºèƒ½ç”µè§†</navigator>
          <navigator url="/pages/list/index">å°ç±³ç©ºæ°”å‡€åŒ–å™¨</navigator>
          <navigator url="/pages/list/index">è¥¿é—¨å­æ´—ç¢—æœº</navigator>
          <navigator url="/pages/list/index">åä¸ºæ‰‹æœº</navigator>
          <navigator url="/pages/list/index">è‹¹æœ</navigator>
          <navigator url="/pages/list/index">é”¤å­</navigator>
        </div>
      </block>
      <!-- æœç´¢å»ºè®®å•†å“ -->
+      <scroll-view scroll-y class="result" v-else>
        <navigator
          v-for="item in result"
          :key="item.goods_id"
          :url="'/packone/goods/index?id=' + item.goods_id"
          >{{ item.goods_name }}</navigator
        >
      </scroll-view>
    </view>
```

å˜é‡

```diff
data() {
  return {
    isSearch: false,
+    keyWord: "",
+    result: []
  };
},
```
æ–¹æ³•
```js
  // è·å–æœç´¢å»ºè®®å•†å“=ã€‹å‡½æ•°é˜²æŠ–å¤„ç†
  searchPrd () {
    this.timer && clearTimeout(this.timer)
    this.timer = setTimeout(async () => {
      // å¦‚æœå…³é”®è¯ä¸ºç©º=ã€‹æ¸…é™¤å†å²å»ºè®®å•†å“åˆ—è¡¨
      if (!this.keyWord) {
        return this.result = []
      }
      const { msg, data } = await this.request({
        url: "/api/public/v1/goods/qsearch",
        data: {
          query: this.keyWord
          // cid: this.activeId
        }
      })
      console.log(data)
      if (msg.status === 200) {
        this.result = data
      }
    }, 600)
  }
```



## 05-åˆ†ç±»-æœç´¢-è·³è½¬

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å®ç°æœç´¢ç»„ä»¶ï¼Œæœç´¢ç¡®è®¤æ—¶è·³è½¬åˆ°å•†å“åˆ—è¡¨ï¼ˆç»“æœï¼‰é¡µé¢

è¯´æ˜ï¼šå•†å“ç»“æœé¡µ`/packone/list/index`

æ­¥éª¤ï¼š

1. inputç»‘å®šconfirmäº‹ä»¶ï¼ˆæµ‹è¯•æ—¶ï¼Œä½¿ç”¨å›è½¦ç¡®è®¤ï¼‰
2. æœç´¢ç¡®è®¤æ—¶ï¼Œè·¯ç”±è·³è½¬åˆ°ç»“æœé¡µå¹¶æºå¸¦æŸ¥è¯¢å‚æ•°

`search.vue`

```js
goResult() {
  uni.navigateTo({
    url: "/packone/list/index?query="+this.keyWord
  });
},
```

```diff
      <input
+        @confirm="goResult"
        @input="searchPrd"
        @focus="search"
        v-model="keyWord"
        type="text"
        placeholder="æœç´¢"
      />
```



## 06-åˆ†ç±»-æœç´¢-å†å²

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å®ç°æœç´¢ç»„ä»¶ï¼Œæœç´¢å†å²å±•ç¤ºå’Œæ¸…é™¤ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰

![image-20211121121736622](./assets/image-20211121121736622.png)

æ­¥éª¤ï¼š

1. è®¾ç½®history:[]æ•°æ®å’Œé»˜è®¤å€¼ï¼Œä»æœ¬åœ°è·å–
2. **æœç´¢ç¡®è®¤æ—¶**ï¼ŒæŠŠæœç´¢å…³é”®è¯ä¿å­˜åˆ°æœ¬åœ°=ã€‹å»é‡
3. ç‚¹å‡»æ¸…é™¤æŒ‰é’®ï¼Œæ¸…é™¤æœ¬åœ°æœç´¢å†å²æ•°æ®

```vue
      <!-- æœç´¢å†å² -->
      <block v-if="result.length === 0">
        <div class="title">
          æœç´¢å†å²
          <span @click="clearHistory" class="clear"></span>
        </div>
        <!-- æœç´¢å†å² -->
        <div class="history">
          <navigator
            :key="i"
            v-for="(item, i) in history"
            :url="`/packone/list/index?query=${item}`"
            >{{ item }}</navigator
          >
        </div>
      </block>
```

```js
  data() {
    return {
      history: uni.getStorageSync("history") || []
    };
  },   
    clearHistory() {
      this.history = [];
      uni.removeStorageSync("history");
    },
    goResult () {
      // å¤„ç†æœç´¢å†å²
      this.history.push(this.keyWord)
      // å»é‡
      this.history = [...new Set(this.history)]
      uni.setStorage({
        key: "history",
        data: this.history
      })
      uni.navigateTo({
        url: "/packone/list/index?query=" + this.keyWord
      })
    },
```

æ³¨æ„ï¼šè®¾ç½®historyé»˜è®¤å€¼ï¼Œè·å–æœ¬åœ°æ•°æ®ä½¿ç”¨åŒæ­¥æ–¹æ³•(ä¼ å…¥å­—ç¬¦ä¸²å‚æ•°)

## 07-åˆ†ç±»-æœç´¢-ç»“æœé¡µ

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**æ ¹æ®urlä¸­æºå¸¦å‚æ•°ï¼Œè¯·æ±‚æ¥å£è·å–æœç´¢å•†å“æ•°æ®å¹¶æ¸²æŸ“

![image-20211121121826034](./assets/image-20211121121826034.png)

è¯´æ˜ï¼š

* ç›®å½•ï¼š`/packone/list/index`
* æŸ¥è¯¢å‚æ•°ï¼šå°ç±³æˆ–å£çº¢ğŸ’„ï¼ˆåå°æœ‰æ•°æ®ï¼‰
* æ¥å£ï¼š`/api/public/v1/goods/search`

æ­¥éª¤ï¼š

1. é€šè¿‡onLoadç”Ÿå‘½å‘¨æœŸè·å–æŸ¥è¯¢å‚æ•°
2. è°ƒç”¨æ¥å£è·å–ç»“æœæ•°æ®æ¸²æŸ“

```js
  data() {
    return {
      list: [],
      total:0
    };
  },
```

```js
// event 
onLoad(params) {
    this.getList(params);
},
    // methods
    async getList(data) {
      const { msg, data: _d } = await this.request({
        url: "/api/public/v1/goods/search",
        data
      });
      this.total = _d.total
      if (msg.status === 200) {
        this.list.push(..._d.goods)
      }
    }    
```
```vue
    <!-- å•†å“åˆ—è¡¨ -->
    <scroll-view class="goods" scroll-y>
      <!-- éå† -->
      <view
        class="item"
        v-for="item in list"
        :key="item.goods_id"
        @click="goDetail(item.goods_id)"
      >
        <!-- å•†å“å›¾ç‰‡ -->
        <image class="pic" :src="item.goods_small_logo" />
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="meta">
          <view class="name">{{ item.goods_name }}</view>
          <view class="price">
            <text>ï¿¥</text>{{ item.goods_price }}
            <text>.00</text>
          </view>
        </view>
      </view>
    </scroll-view>
```



## 08-åˆ†ç±»-æœç´¢-ç»“æœé¡µ-è§¦åº•äº‹ä»¶

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å®ç°é¡µé¢è§¦åº•ç›‘æµ‹

```js
 <scroll-view @scrolltolower="getMore" class="goods" scroll-y>
```

æ³¨æ„ï¼š

* ä¸¤ç§æ–¹å¼å®ç°
  1. é¡µé¢æ»šåŠ¨ï¼ˆæ‰ä¼šè§¦å‘ï¼‰ï¼šonReachBottomï¼ˆé’©å­å‡½æ•°ï¼‰
  2. scroll-viewç»„ä»¶ï¼ˆåŒºåŸŸæ»šåŠ¨ï¼‰ï¼šscrolltolowerï¼ˆäº‹ä»¶ï¼‰

## 09-åˆ†ç±»-æœç´¢-ç»“æœé¡µ-ä¸Šæ‹‰åŠ è½½

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å®ç°ä¸Šæ‹‰åŠ è½½æ›´å¤šï¼ˆåˆ†é¡µï¼‰

éœ€æ±‚ï¼šé¡µé¢æ‹‰åˆ°åº•éƒ¨æ—¶ï¼ŒåŠ è½½ä¸‹ä¸€é¡µæ•°æ®å¹¶æ¸²æŸ“

æ­¥éª¤ï¼š

1. å®šä¹‰æŸ¥è¯¢å‚æ•°
1. åˆ¤æ–­æ•°æ®æ˜¯å¦åŠ è½½å®Œæˆ
2. æ²¡æœ‰å®Œæˆé¡µç åŠ ä¸€ç»§ç»­è¯·æ±‚
2. å®Œæˆæ˜¾ç¤ºæ²¡æœ‰æ›´å¤š

```diff
  data () {
    // å­˜å‚¨æ¸²æŸ“ç›¸å…³æ•°æ®
    return {
      // åˆ—è¡¨
      list: [],
+      query: {
        pagenum: 1,
        pagesize: 20,
        query: ''
+      },
      total: 0
    }
  },
```

```js
onLoad(params) {
  this.query.query = params.query
  this.getList(this.query);
},
```

```js
computed: {
  // æ˜¯å¦åŠ è½½å®Œæˆ
  nomore () {
    return this.total === this.list.length
  }
},
// åŠ è½½æ›´å¤š
getMore () {
  if (this.nomore) return
  this.query.pagenum++
  this.getList(this.query)
},
```
```vue
<!-- åˆ—è¡¨åŠ è½½å®Œæˆæ˜¾ç¤º -->
<view class="nomore" v-if="nomore">æ²¡æœ‰æ›´å¤šæ•°æ®...</view>
```

## 10-åˆ†ç±»-æœç´¢-ç»“æœé¡µ-ä¼˜åŒ–

**`æœ¬èŠ‚ç›®æ ‡ï¼š`**å…¨å±€è¯·æ±‚é®ç½©å±‚

éœ€æ±‚ï¼šç½‘ç»œæƒ…å†µå·®åˆ°æƒ…å†µä¸‹ï¼Œç»™è¯·æ±‚åŠ ä¸Šé®ç½©å±‚

```diff
  uni.showLoading({
    title: 'åŠ è½½ä¸­...',
+    mask: true
  });
```

## ä»Šæ—¥æ€»ç»“



