<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>主页的token拦截处理 | TS文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/vuepress-starter/images/logo.png">
    <meta name="description" content="TS文档翻译">
    
    <link rel="preload" href="/vuepress-starter/assets/css/0.styles.3647dceb.css" as="style"><link rel="preload" href="/vuepress-starter/assets/js/app.af2c115b.js" as="script"><link rel="preload" href="/vuepress-starter/assets/js/8.63529011.js" as="script"><link rel="preload" href="/vuepress-starter/assets/js/1.2f7c1606.js" as="script"><link rel="preload" href="/vuepress-starter/assets/js/15.59b3d65a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/js/10.d1ad8d6f.js"><link rel="prefetch" href="/vuepress-starter/assets/js/100.f12de9b2.js"><link rel="prefetch" href="/vuepress-starter/assets/js/101.59ac571e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/102.4e66aa87.js"><link rel="prefetch" href="/vuepress-starter/assets/js/103.1846477e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/104.aa44073e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/105.00a89df4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/106.59f754a7.js"><link rel="prefetch" href="/vuepress-starter/assets/js/107.a73d8110.js"><link rel="prefetch" href="/vuepress-starter/assets/js/108.9bad5514.js"><link rel="prefetch" href="/vuepress-starter/assets/js/109.5ad3d715.js"><link rel="prefetch" href="/vuepress-starter/assets/js/11.a76c94e6.js"><link rel="prefetch" href="/vuepress-starter/assets/js/110.b64a2c67.js"><link rel="prefetch" href="/vuepress-starter/assets/js/111.23b6b626.js"><link rel="prefetch" href="/vuepress-starter/assets/js/112.84a5320a.js"><link rel="prefetch" href="/vuepress-starter/assets/js/113.53143628.js"><link rel="prefetch" href="/vuepress-starter/assets/js/114.d124bbdd.js"><link rel="prefetch" href="/vuepress-starter/assets/js/115.bdfe8853.js"><link rel="prefetch" href="/vuepress-starter/assets/js/116.e3848f95.js"><link rel="prefetch" href="/vuepress-starter/assets/js/117.36eca13c.js"><link rel="prefetch" href="/vuepress-starter/assets/js/12.b3096d36.js"><link rel="prefetch" href="/vuepress-starter/assets/js/13.6a1695cd.js"><link rel="prefetch" href="/vuepress-starter/assets/js/14.4bd4604f.js"><link rel="prefetch" href="/vuepress-starter/assets/js/16.a35c8ebf.js"><link rel="prefetch" href="/vuepress-starter/assets/js/17.c94e61f2.js"><link rel="prefetch" href="/vuepress-starter/assets/js/18.2cb59b1e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/19.04d49a2a.js"><link rel="prefetch" href="/vuepress-starter/assets/js/20.097beaca.js"><link rel="prefetch" href="/vuepress-starter/assets/js/21.af978db5.js"><link rel="prefetch" href="/vuepress-starter/assets/js/22.092ef6bf.js"><link rel="prefetch" href="/vuepress-starter/assets/js/23.ce5aea29.js"><link rel="prefetch" href="/vuepress-starter/assets/js/24.c90105f4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/25.c74e2565.js"><link rel="prefetch" href="/vuepress-starter/assets/js/26.158ecdb0.js"><link rel="prefetch" href="/vuepress-starter/assets/js/27.4d39818b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/28.527ee2c5.js"><link rel="prefetch" href="/vuepress-starter/assets/js/29.21bd69e0.js"><link rel="prefetch" href="/vuepress-starter/assets/js/3.904189fc.js"><link rel="prefetch" href="/vuepress-starter/assets/js/30.cc1f9398.js"><link rel="prefetch" href="/vuepress-starter/assets/js/31.2e925761.js"><link rel="prefetch" href="/vuepress-starter/assets/js/32.535a03f0.js"><link rel="prefetch" href="/vuepress-starter/assets/js/33.a33db8bf.js"><link rel="prefetch" href="/vuepress-starter/assets/js/34.cdcfe638.js"><link rel="prefetch" href="/vuepress-starter/assets/js/35.b96f7c0f.js"><link rel="prefetch" href="/vuepress-starter/assets/js/36.fbee8135.js"><link rel="prefetch" href="/vuepress-starter/assets/js/37.a2eb9177.js"><link rel="prefetch" href="/vuepress-starter/assets/js/38.09effb51.js"><link rel="prefetch" href="/vuepress-starter/assets/js/39.bebeef29.js"><link rel="prefetch" href="/vuepress-starter/assets/js/4.abb4805b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/40.9060901e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/41.b729f9c4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/42.24a56128.js"><link rel="prefetch" href="/vuepress-starter/assets/js/43.cb448aa2.js"><link rel="prefetch" href="/vuepress-starter/assets/js/44.766da26e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/45.cb6bfd9c.js"><link rel="prefetch" href="/vuepress-starter/assets/js/46.3a01d5ea.js"><link rel="prefetch" href="/vuepress-starter/assets/js/47.38987945.js"><link rel="prefetch" href="/vuepress-starter/assets/js/48.e39480da.js"><link rel="prefetch" href="/vuepress-starter/assets/js/49.19bb60cc.js"><link rel="prefetch" href="/vuepress-starter/assets/js/5.2937d3f5.js"><link rel="prefetch" href="/vuepress-starter/assets/js/50.e02ae5b4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/51.02d7b896.js"><link rel="prefetch" href="/vuepress-starter/assets/js/52.5588a30d.js"><link rel="prefetch" href="/vuepress-starter/assets/js/53.3f366a15.js"><link rel="prefetch" href="/vuepress-starter/assets/js/54.cda1e355.js"><link rel="prefetch" href="/vuepress-starter/assets/js/55.b230d82a.js"><link rel="prefetch" href="/vuepress-starter/assets/js/56.dff9d1e6.js"><link rel="prefetch" href="/vuepress-starter/assets/js/57.afc977a6.js"><link rel="prefetch" href="/vuepress-starter/assets/js/58.873e3872.js"><link rel="prefetch" href="/vuepress-starter/assets/js/59.bcd177ea.js"><link rel="prefetch" href="/vuepress-starter/assets/js/6.acdbe7ef.js"><link rel="prefetch" href="/vuepress-starter/assets/js/60.d32b3a3f.js"><link rel="prefetch" href="/vuepress-starter/assets/js/61.6dcc86a7.js"><link rel="prefetch" href="/vuepress-starter/assets/js/62.e0d864cc.js"><link rel="prefetch" href="/vuepress-starter/assets/js/63.a621a33f.js"><link rel="prefetch" href="/vuepress-starter/assets/js/64.ff4626f4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/65.5a60215c.js"><link rel="prefetch" href="/vuepress-starter/assets/js/66.a383859d.js"><link rel="prefetch" href="/vuepress-starter/assets/js/67.6dae2f39.js"><link rel="prefetch" href="/vuepress-starter/assets/js/68.7e4856f4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/69.ce3a7596.js"><link rel="prefetch" href="/vuepress-starter/assets/js/7.ced7450e.js"><link rel="prefetch" href="/vuepress-starter/assets/js/70.993d366b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/71.6dac8c23.js"><link rel="prefetch" href="/vuepress-starter/assets/js/72.0236857c.js"><link rel="prefetch" href="/vuepress-starter/assets/js/73.f3a4476b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/74.9ab34f7b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/75.e925dad1.js"><link rel="prefetch" href="/vuepress-starter/assets/js/76.b17a9db2.js"><link rel="prefetch" href="/vuepress-starter/assets/js/77.2253730b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/78.6102913a.js"><link rel="prefetch" href="/vuepress-starter/assets/js/79.a28037b4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/80.1b7ef791.js"><link rel="prefetch" href="/vuepress-starter/assets/js/81.24f200c4.js"><link rel="prefetch" href="/vuepress-starter/assets/js/82.b48bdc39.js"><link rel="prefetch" href="/vuepress-starter/assets/js/83.bea816b2.js"><link rel="prefetch" href="/vuepress-starter/assets/js/84.5777ee7c.js"><link rel="prefetch" href="/vuepress-starter/assets/js/85.d3c4b66b.js"><link rel="prefetch" href="/vuepress-starter/assets/js/86.479bc70d.js"><link rel="prefetch" href="/vuepress-starter/assets/js/87.d45dd7e5.js"><link rel="prefetch" href="/vuepress-starter/assets/js/88.8f6f20c6.js"><link rel="prefetch" href="/vuepress-starter/assets/js/89.259f0e8a.js"><link rel="prefetch" href="/vuepress-starter/assets/js/9.325435d5.js"><link rel="prefetch" href="/vuepress-starter/assets/js/90.4c7066f6.js"><link rel="prefetch" href="/vuepress-starter/assets/js/91.54e7a55d.js"><link rel="prefetch" href="/vuepress-starter/assets/js/92.adb5d1fa.js"><link rel="prefetch" href="/vuepress-starter/assets/js/93.a7a266ba.js"><link rel="prefetch" href="/vuepress-starter/assets/js/94.b10f7db7.js"><link rel="prefetch" href="/vuepress-starter/assets/js/95.eda38ca7.js"><link rel="prefetch" href="/vuepress-starter/assets/js/96.4b358369.js"><link rel="prefetch" href="/vuepress-starter/assets/js/97.207b8b04.js"><link rel="prefetch" href="/vuepress-starter/assets/js/98.be8f48b7.js"><link rel="prefetch" href="/vuepress-starter/assets/js/99.18ed1159.js">
    <link rel="stylesheet" href="/vuepress-starter/assets/css/0.styles.3647dceb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>TS文档</h3> <p class="description" data-v-59e6cb88>TS文档翻译</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2022
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-starter/" class="home-link router-link-active"><img src="/vuepress-starter/images/logo.png" alt="TS文档" class="logo"> <span class="site-name">TS文档</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-starter/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/vuepress-starter/page/js/" class="nav-link"><i class="undefined"></i>
  面试集合
</a></div><div class="nav-item"><a href="/vuepress-starter/handbook/ConditionalTypes.html" class="nav-link"><i class="undefined"></i>
  vue组件
</a></div><div class="nav-item"><a href="/vuepress-starter/vue/vuebase.html" class="nav-link"><i class="undefined"></i>
  vue学习
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
       JavaScript 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/strongkin" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>102</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-starter/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/vuepress-starter/page/js/" class="nav-link"><i class="undefined"></i>
  面试集合
</a></div><div class="nav-item"><a href="/vuepress-starter/handbook/ConditionalTypes.html" class="nav-link"><i class="undefined"></i>
  vue组件
</a></div><div class="nav-item"><a href="/vuepress-starter/vue/vuebase.html" class="nav-link"><i class="undefined"></i>
  vue学习
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
       JavaScript 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/strongkin" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-starter/vue/vuebase.html" class="sidebar-link">vue基础</a></li><li><a href="/vuepress-starter/vue/vuex.html" class="sidebar-link">vuex</a></li><li><a href="/vuepress-starter/vue/vueRouter.html" class="sidebar-link">vueRouter路由</a></li><li><a href="/vuepress-starter/vue/vueSource.html" class="sidebar-link">vue源码</a></li><li><a href="/vuepress-starter/vue/vueInterview.html" class="sidebar-link">vue面试</a></li><li><a href="/vuepress-starter/vue/vue3.html" class="sidebar-link">vue3</a></li><li><a href="/vuepress-starter/vue/vueVirtualDom.html" class="sidebar-link">虚拟DOM</a></li><li><a href="/vuepress-starter/vue/vueResponed.html" class="sidebar-link">响应式原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>人力管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-starter/vue/hrsaas/01-vuex基础.html" class="sidebar-link">vuex基础</a></li><li><a href="/vuepress-starter/vue/hrsaas/02-基础环境搭建.html" class="sidebar-link">基础环境搭建</a></li><li><a href="/vuepress-starter/vue/hrsaas/03-登录模块.html" class="sidebar-link">登录模块</a></li><li><a href="/vuepress-starter/vue/hrsaas/04-主页模块.html" class="active sidebar-link">主页模块</a></li><li><a href="/vuepress-starter/vue/hrsaas/05-路由和页面.html" class="sidebar-link">路由和页面</a></li><li><a href="/vuepress-starter/vue/hrsaas/06-组织架构.html" class="sidebar-link">组织架构</a></li><li><a href="/vuepress-starter/vue/hrsaas/07-公司和角色.html" class="sidebar-link">公司和角色</a></li><li><a href="/vuepress-starter/vue/hrsaas/08-员工管理.html" class="sidebar-link">员工管理</a></li><li><a href="/vuepress-starter/vue/hrsaas/09-权限设计和管理.html" class="sidebar-link">权限设计和管理</a></li><li><a href="/vuepress-starter/vue/hrsaas/10-其他模块集成.html" class="sidebar-link">其他模块集成</a></li><li><a href="/vuepress-starter/vue/hrsaas/11-主页审批-图表.html" class="sidebar-link">主页审批-图表</a></li><li><a href="/vuepress-starter/vue/hrsaas/12-多语言tab页全屏主题.html" class="sidebar-link">多语言tab页全屏主题</a></li><li><a href="/vuepress-starter/vue/hrsaas/13-打包上线.html" class="sidebar-link">打包上线</a></li><li><a href="/vuepress-starter/vue/hrsaas/Element表单校验补充.html" class="sidebar-link">Element表单校验补充</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小兔仙</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-starter/vue/rabbit/00-vue3入门.html" class="sidebar-link">vue3入门</a></li><li><a href="/vuepress-starter/vue/rabbit/01-项目介绍.html" class="sidebar-link">项目介绍</a></li><li><a href="/vuepress-starter/vue/rabbit/02-项目起步.html" class="sidebar-link">项目起步</a></li><li><a href="/vuepress-starter/vue/rabbit/03-首页模块-Layout.html" class="sidebar-link">首页模块-Layout</a></li><li><a href="/vuepress-starter/vue/rabbit/04-首页模块-main主体.html" class="sidebar-link">首页模块-main主体</a></li><li><a href="/vuepress-starter/vue/rabbit/05-分类模块.html" class="sidebar-link">分类模块</a></li><li><a href="/vuepress-starter/vue/rabbit/06-详情模块.html" class="sidebar-link">详情模块</a></li><li><a href="/vuepress-starter/vue/rabbit/07-登录模块.html" class="sidebar-link">登录模块</a></li><li><a href="/vuepress-starter/vue/rabbit/08-购物车模块.html" class="sidebar-link">购物车模块</a></li><li><a href="/vuepress-starter/vue/rabbit/09-结算中心模块.html" class="sidebar-link">结算中心模块</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2022
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">主页的token拦截处理</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="主页的token拦截处理"><a href="#主页的token拦截处理" class="header-anchor">#</a> 主页的token拦截处理</h2> <p><strong><code>目标</code></strong>：根据token处理主页的访问权限问题</p> <h3 id="权限拦截的流程图"><a href="#权限拦截的流程图" class="header-anchor">#</a> 权限拦截的流程图</h3> <blockquote><p>我们已经完成了登录的过程，并且存储了token，但是此时主页并没有因为token的有无而被控制访问权限</p></blockquote> <p>接下来我们需要实现以下如下的流程图</p> <p><img src="/vuepress-starter/assets/img/image-20200714093601730.dd87ee68.png" alt="image-20200714093601730"></p> <blockquote><p>在基础框架阶段，我们已经知道**<code>src/permission.js</code>**是专门处理路由权限的，所以我们在这里处理</p></blockquote> <h3 id="流程图转化代码"><a href="#流程图转化代码" class="header-anchor">#</a> 流程图转化代码</h3> <p><strong>流程图转化的代码</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 权限拦截 导航守卫 路由守卫  router</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span> <span class="token comment">// 引入路由实例</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span> <span class="token comment">// 引入vuex store实例</span>
<span class="token keyword">import</span> NProgress <span class="token keyword">from</span> <span class="token string">'nprogress'</span> <span class="token comment">// 引入一份进度条插件</span>
<span class="token keyword">import</span> <span class="token string">'nprogress/nprogress.css'</span> <span class="token comment">// 引入进度条样式</span>

<span class="token keyword">const</span> whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token string">'/404'</span><span class="token punctuation">]</span> <span class="token comment">// 定义白名单  所有不受权限控制的页面</span>
<span class="token comment">// 路由的前置守卫</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 开启进度条</span>
  <span class="token comment">//  首先判断有无token</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//   如果有token 继续判断是不是去登录页</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  表示去的是登录页</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token comment">// 跳到主页</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 直接放行</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果没有token</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>whiteList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果找到了 表示在在名单里面</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token comment">// 跳到登录页</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 手动强制关闭一次  为了解决 手动切换地址时  进度条的不关闭的问题</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 后置守卫</span>
router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 关闭进度条</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><blockquote><p>在导航守卫的位置，我们添加了NProgress的插件，可以完成进入时的进度条效果</p></blockquote> <p><strong>提交代码</strong></p> <p><strong><code>本节任务</code></strong>：完成主页中根据有无token，进行页面访问的处理</p> <h2 id="主页的左侧导航样式"><a href="#主页的左侧导航样式" class="header-anchor">#</a> 主页的左侧导航样式</h2> <p>**<code>目标</code>**设置左侧的导航样式</p> <blockquote><p>接下来我们需要将左侧导航设置成如图样式</p></blockquote> <p><img src="/vuepress-starter/assets/img/image-20200714142517337.62ad7679.png" alt="image-20200714142517337"></p> <blockquote><p>主页的布局组件位置**<code>src/layout</code>**</p></blockquote> <p><strong>主页布局架构</strong></p> <p><img src="/vuepress-starter/assets/img/image-20200812023354631.483751d5.png" alt="image-20200812023354631"></p> <p><strong>左侧导航组件的样式文件</strong><code>styles/siderbar.scss</code></p> <p><strong>设置背景渐变色</strong></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.sidebar-container</span> <span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>bottom<span class="token punctuation">,</span> #3d6df8<span class="token punctuation">,</span> #5b8cff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>设置左侧导航背景图片</strong></p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.scrollbar-wrapper </span><span class="token punctuation">{</span> 
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url">url</span><span class="token punctuation">(</span><span class="token string">'~@/./assets/common/leftnavBg.png'</span><span class="token punctuation">)</span> no-repeat 0 100%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>注意</code></strong>：在scss中，如果我们想要使用**<code>@</code><strong>别名，需要在前面加上一个</strong><code>~</code>**才可以</p> <p><strong>设置菜单选中颜色</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>    .el-menu <span class="token punctuation">{</span>
      border: none<span class="token punctuation">;</span>
      height: <span class="token number">100</span>%<span class="token punctuation">;</span>
      width: <span class="token number">100</span>% <span class="token operator">!</span>important<span class="token punctuation">;</span>
      a<span class="token punctuation">{</span>
        li<span class="token punctuation">{</span>
          .svg-icon<span class="token punctuation">{</span>
            color: <span class="token comment">#fff;</span>
            font-size: 18px<span class="token punctuation">;</span>
            vertical-align: middle<span class="token punctuation">;</span>
            .icon<span class="token punctuation">{</span>
              color:<span class="token comment">#fff;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          span<span class="token punctuation">{</span>
            color: <span class="token comment">#fff;</span>
          <span class="token punctuation">}</span>
          <span class="token operator">&amp;</span>:hover<span class="token punctuation">{</span>
            .svg-icon<span class="token punctuation">{</span>
              color: <span class="token comment">#43a7fe</span>
            <span class="token punctuation">}</span>
            span<span class="token punctuation">{</span>
              color: <span class="token comment">#43a7fe;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong><code>注意</code></strong>：因为我们后期没有二级菜单，所以这里暂时不用对二级菜单的样式进行控制</p> <p><strong>显示左侧logo图片</strong> <strong><code>src/setttings.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'人力资源管理平台'</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * @type {boolean} true | false
   * @description Whether fix the header
   */</span>
  <span class="token literal-property property">fixedHeader</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * @type {boolean} true | false
   * @description Whether show the logo in sidebar
   */</span>
  <span class="token literal-property property">sidebarLogo</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 显示logo</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>设置头部图片结构</strong> <strong><code>src/layout/components/Sidebar/Logo.vue</code></strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sidebar-logo-container<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{'collapse':collapse}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sidebarLogoFade<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>collapse<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sidebar-logo-link<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@/./assets/common/logo.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sidebar-logo  <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>设置大图和小图的样式</strong></p> <div class="language-scss extra-class"><pre class="language-scss"><code>  <span class="token selector"><span class="token parent important">&amp;</span>.collapse </span><span class="token punctuation">{</span>
    <span class="token selector">.sidebar-logo </span><span class="token punctuation">{</span>
      <span class="token property">margin-right</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">// 小图样式</span>
</code></pre></div><div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.sidebar-logo </span><span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 140px<span class="token punctuation">;</span>
      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
      <span class="token property">margin-right</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 大图样式</span>
</code></pre></div><p><strong>去除logo的背景色</strong></p> <p><img src="/vuepress-starter/assets/img/image-20200827104724769.2d64f55a.png" alt="image-20200827104724769"></p> <p><strong>提交代码</strong></p> <p><strong><code>本节任务</code></strong>： 完成主页的左侧导航样式</p> <p><strong><code>本节注意</code></strong>：我们该项目中没有二级显示菜单，所以二级菜单的样式并没有做过多处理，同学们不必在意</p> <h2 id="设置头部内容的布局和样式"><a href="#设置头部内容的布局和样式" class="header-anchor">#</a> 设置头部内容的布局和样式</h2> <p>**<code>目标</code>**设置头部内容的布局和样式</p> <blockquote><p>我们需要把页面设置成如图样式</p></blockquote> <p><img src="/vuepress-starter/assets/img/image-20200714172602305.3513a8ad.png" alt="image-20200714172602305"></p> <p><strong>头部组件位置</strong> <strong><code>layout/components/Navbar.vue</code></strong></p> <p><strong>添加公司名称</strong>，<strong>注释面包屑</strong></p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app-breadcrumb<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      江苏传智播客教育科技股份有限公司
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>breadBtn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>体验版<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
 <span class="token comment">&lt;!-- &lt;breadcrumb class=&quot;breadcrumb-container&quot; /&gt; --&gt;</span>

</code></pre></div><p><strong>公司样式</strong></p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.app-breadcrumb </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> text<span class="token punctuation">;</span>
  <span class="token selector">.breadBtn </span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #84a9fe<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0 10px<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>头部背景渐变色</strong></p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">.navbar </span><span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> #3d6df8<span class="token punctuation">,</span> #5b8cff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>汉堡组件图标颜色</strong> <strong><code>src/components/Hamburger/index.vue</code></strong></p> <p><strong><code>注意</code><strong>这里的图标我们使用了</strong><code>svg</code></strong>，设置颜色需要使用svg标签的**<code>fill属性</code>**</p> <blockquote><p>设置svg图标为白色</p></blockquote> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span>
      <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{'is-active':isActive}<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hamburger<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0 0 1024 1024<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>64<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>64<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#fff<span class="token punctuation">&quot;</span></span> 
    <span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>右侧下拉菜单设置</strong></p> <blockquote><p>将下拉菜单调节成**<code>首页/项目地址/退出登录</code>**</p></blockquote> <div class="language-vue extra-class"><pre class="language-vue"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right-menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dropdown</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar-container<span class="token punctuation">&quot;</span></span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>click<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar-wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@/./assets/common/bigUserHeader.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-avatar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>管理员<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-caret-bottom<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>#fff</span><span class="token punctuation">&quot;</span></span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dropdown-menu</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-dropdown<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dropdown-item</span><span class="token punctuation">&gt;</span></span>
              首页
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dropdown-item</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://gitee.com/shuiruohanyu/hrsaas53<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dropdown-item</span><span class="token punctuation">&gt;</span></span>项目地址<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dropdown-item</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dropdown-item</span> <span class="token attr-name">divided</span> <span class="token attr-name">@click.native</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>退出登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dropdown-item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dropdown-menu</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dropdown</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>头像和下拉菜单样式</strong></p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.user-avatar</span> <span class="token punctuation">{</span>
          <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
          <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
          <span class="token property">border-radius</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
          <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>

   <span class="token punctuation">}</span>
   <span class="token selector">.name</span> <span class="token punctuation">{</span>
          <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
          <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
          <span class="token property">margin-left</span><span class="token punctuation">:</span>5px<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token selector">.user-dropdown</span> <span class="token punctuation">{</span>
           <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>用户名和头像我们先用了假数据进行，下小章节，会进行这份数据的获取</p> <p><strong>最终效果</strong></p> <p><img src="/vuepress-starter/assets/img/image-20200716015113164.e5562c69.png" alt=""></p> <p><strong>提交代码</strong></p> <h2 id="获取用户资料接口和token注入"><a href="#获取用户资料接口和token注入" class="header-anchor">#</a> 获取用户资料接口和token注入</h2> <p><strong><code>目标</code></strong> 封装获取用户资料的资料信息</p> <blockquote><p>上小节中，我们完成了头部菜单的基本布局，但是用户的头像和名称并没有，我们需要通过接口调用的方式获取当前用户的资料信息</p></blockquote> <p><strong>获取用户资料接口</strong></p> <p>在**<code>src/api/user.js</code>**中封装获取用户资料的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 *  获取用户的基本资料
 *
 * **/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/sys/profile'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>我们忽略了一个问题！我们的headers参数并没有在这里传入，为什么呢</p></blockquote> <p>headers中的<strong>Authorization</strong>相当于我们<strong>开门</strong>（<strong>调用接口</strong>）时**<code>钥匙(token)</code><strong>，我们在打开任何带安全权限的门的时候都需要</strong><code>钥匙(token)</code>** 如图</p> <p><img src="data:image/png;base64,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" alt="image-20200715233339927"></p> <p>每次在接口中携带**<code>钥匙（token）</code>**很麻烦，所以我们可以在axios拦截器中统一注入token</p> <p><img src="/vuepress-starter/assets/img/image-20200716000203862.389fc0cc.png" alt="image-20200716000203862"></p> <p><strong>统一注入token</strong> <strong><code>src/utils/request.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code>service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在这个位置需要统一的去注入token</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果token存在 注入token</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config <span class="token comment">// 必须返回配置</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><p><strong><code>本节任务</code></strong>： 完成获取用户资料接口和token注入</p> <h2 id="封装获取用户资料的action并共享用户状态"><a href="#封装获取用户资料的action并共享用户状态" class="header-anchor">#</a> 封装获取用户资料的action并共享用户状态</h2> <p><strong><code>目标</code></strong>： 在用户的vuex模块中封装获取用户资料的action，并设置相关状态</p> <blockquote><p>用户状态会在后续的开发中，频繁用到，所以我们将用户状态同样的封装到action中</p></blockquote> <p><img src="/vuepress-starter/assets/img/image-20200827111324564.4e3e3b86.png" alt="image-20200827111324564"></p> <p><strong>封装获取用户资料action</strong> <strong><code>action</code></strong> <strong><code>src/store/modules/user.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> getUserInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user'</span>
  
  <span class="token comment">// 获取用户资料action</span>
  <span class="token keyword">async</span> <span class="token function">getUserInfo</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 获取返回值</span>
    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUserInfo'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// 将整个的个人信息设置到用户的vuex数据中</span>
    <span class="token keyword">return</span> result <span class="token comment">// 这里为什么要返回 为后面埋下伏笔</span>
  <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>同时，配套的我们还进行了关于用户状态的mutations方法的设计</p></blockquote> <p><strong>初始化state</strong> <strong><code>state</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 设置token初始状态   token持久化 =&gt; 放到缓存中</span>
  <span class="token literal-property property">userInfo</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 定义一个空的对象 不是null 因为后边我要开发userInfo的属性给别人用  userInfo.name</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>userInfo为什么我们不设置为null，而是设置为 {}</p></blockquote> <p>因为我们会在**<code>getters</code>**中引用userinfo的变量，如果设置为null，则会引起异常和报错</p> <p><strong>设置和删除用户资料</strong> <strong><code>mutations</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 设置用户信息</span>
  <span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> userInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>userInfo <span class="token punctuation">}</span> <span class="token comment">// 用 浅拷贝的方式去赋值对象 因为这样数据更新之后，才会触发组件的更新</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 删除用户信息</span>
  <span class="token function">reomveUserInfo</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>同学们，我们将所有的资料设置到了<strong>userInfo</strong>这个对象中，如果想要取其中一个值，我们还可以在getters中建立相应的映射</p></blockquote> <p>因为我们要做映射，如果初始值为null，一旦引用了getters，就会报错</p> <p><strong>建立用户名的映射</strong> <strong><code>src/store/getters.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> getters <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sidebar</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sidebar<span class="token punctuation">,</span>
  <span class="token function-variable function">device</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>device<span class="token punctuation">,</span>
  <span class="token function-variable function">token</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>token<span class="token punctuation">,</span>
  <span class="token function-variable function">name</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>username <span class="token comment">// 建立用户名称的映射</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> getters

</code></pre></div><p>到现在为止，我们将用户资料的<strong>action =&gt;  mutation =&gt; state =&gt;  getters</strong> 都设置好了， 那么我们应该在什么位置来调用这个action呢 ？</p> <blockquote><p>别着急，先提交代码，下个小节，我们来揭晓答案</p></blockquote> <p><strong>提交代码</strong></p> <p>**<code>本节任务</code>**封装获取用户资料的action并共享用户状态</p> <h2 id="权限拦截处调用获取资料action"><a href="#权限拦截处调用获取资料action" class="header-anchor">#</a> 权限拦截处调用获取资料action</h2> <p>**<code>目标</code>**在权限拦截处调用aciton</p> <h3 id="权限拦截器调用action"><a href="#权限拦截器调用action" class="header-anchor">#</a> 权限拦截器调用action</h3> <blockquote><p>在上小节中，我们完成了用户资料的整个流程，那么这个action在哪里调用呢？</p></blockquote> <p>用户资料有个硬性要求，**<code>必须有token</code>**才可以获取，那么我们就可以在确定有token的位置去获取用户资料</p> <p><img src="/vuepress-starter/assets/img/image-20200716004526838.de9299a9.png" alt="image-20200716004526838"></p> <blockquote><p>由上图可以看出，一旦确定我们进行了放行，就可以获取用户资料</p></blockquote> <p><img src="/vuepress-starter/assets/img/image-20200813013009294.fb3fe58c.png" alt="image-20200813013009294"></p> <p><strong>调用action</strong> <strong><code>src/permission.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getUserInfo'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>如果我们觉得获取用户id的方式写了太多层级，可以在vuex中的getters中设置一个映射 <strong><code>src/store/getters.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function-variable function">userId</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>userId <span class="token comment">// 建立用户id的映射</span>
</code></pre></div><p>代码就变成了</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果没有id这个值 才会调用 vuex的获取资料的action</span>
        <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getUserInfo'</span><span class="token punctuation">)</span>
        <span class="token comment">// 为什么要写await 因为我们想获取完资料再去放行</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>此时，我们可以通过dev-tools工具在控制台清楚的看到数据已经获取</p> <p><img src="/vuepress-starter/assets/img/image-20200716012120619.7bd9c185.png" alt="image-20200716012120619"></p> <blockquote><p>最后一步，只需要将头部菜单中的名称换成真实的用户名即可</p></blockquote> <h3 id="获取头像接口合并数据"><a href="#获取头像接口合并数据" class="header-anchor">#</a> 获取头像接口合并数据</h3> <p><strong>头像怎么办？</strong></p> <blockquote><p>我们发现头像并不在接口的返回体中（接口原因），我们可以通过另一个接口来获取头像，并把头像合并到当前的资料中</p></blockquote> <p><strong>封装获取用户信息接口</strong> <strong><code>src/api/user.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** *
 *
 * 获取用户的基本信息  现在写它 完全是为了显示头像
 * **/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getUserDetailById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/sys/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>这个接口需要用户的userId，在前一个接口处，我们已经获取到了，所以可以直接在后面的内容去衔接</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> getUserInfo<span class="token punctuation">,</span> getUserDetailById <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user'</span>
 
<span class="token comment">// 获取用户资料action</span>
 <span class="token keyword">async</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// result就是用户的基本资料</span>
    <span class="token keyword">const</span> baseInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserDetailById</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token comment">// 为了获取头像</span>
    <span class="token keyword">const</span> baseResult <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>result<span class="token punctuation">,</span> <span class="token operator">...</span>baseInfo <span class="token punctuation">}</span> <span class="token comment">// 将两个接口结果合并</span>
    <span class="token comment">// 此时已经获取到了用户的基本资料 迫不得已 为了头像再次调用一个接口</span>
    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setUserInfo'</span><span class="token punctuation">,</span> baseResult<span class="token punctuation">)</span> <span class="token comment">// 提交mutations</span>
    <span class="token comment">// 加一个点睛之笔  这里这一步，暂时用不到，但是请注意，这给我们后边会留下伏笔</span>
    <span class="token keyword">return</span> baseResult
  <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>为了更好地获取头像，同样可以把头像放于getters中</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function-variable function">staffPhoto</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>staffPhoto <span class="token comment">// 建立用户头像的映射</span>
</code></pre></div><p>此时，我们的头像和名称已经获取到了，可以直接将之前的假数据换成真正的头像和名称</p> <p><strong>用户名</strong> <strong><code>layout/components/Navbar.vue</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'sidebar'</span><span class="token punctuation">,</span>
      <span class="token string">'name'</span><span class="token punctuation">,</span>
      <span class="token string">'staffPhoto'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;staffPhoto&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;user-avatar&quot;</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>

</code></pre></div><blockquote><p>通过设置，用户名已经显示，头像依然没有显示，这是因为虽然有地址，但是地址来源是私有云，目前已经失效，所以需要额外处理下图片的异常</p></blockquote> <p><img src="data:image/png;base64,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" alt="image-20200827140451144"></p> <p>至于处理图片的异常，我们在下一节中，可采用自定义指令的形式来进行处理</p> <p><strong><code>本节任务</code></strong>：实现权限拦截处调用获取资料action</p> <h2 id="自定义指令-解决异常图片情况"><a href="#自定义指令-解决异常图片情况" class="header-anchor">#</a> 自定义指令-解决异常图片情况</h2> <p><strong><code>目标</code></strong>： 通过自定义指令的形式解决异常图片的处理</p> <h3 id="自定义指令"><a href="#自定义指令" class="header-anchor">#</a> 自定义指令</h3> <p>注册自定义指令</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'指令名称'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 会在当前指令作用的dom元素 插入之后执行</span>
    <span class="token comment">// options 里面是指令的表达式</span>
    <span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span>options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>自定义指令可以采用统一的文件来管理  <strong><code>src/directives/index.js</code></strong>,这个文件负责管理所有的自定义指令</p></blockquote> <p>首先定义第一个自定义指令  <strong><code>v-imagerror</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> imagerror <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 指令对象 会在当前的dom元素插入到节点之后执行</span>
  <span class="token function">inserted</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// options是 指令中的变量的解释  其中有一个属性叫做 value</span>
    <span class="token comment">// dom 表示当前指令作用的dom对象</span>
    <span class="token comment">// dom认为此时就是图片</span>
    <span class="token comment">// 当图片有地址 但是地址没有加载成功的时候 会报错 会触发图片的一个事件 =&gt; onerror</span>
    dom<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当图片出现异常的时候 会将指令配置的默认图片设置为该图片的内容</span>
      <span class="token comment">// dom可以注册error事件</span>
      dom<span class="token punctuation">.</span>src <span class="token operator">=</span> options<span class="token punctuation">.</span>value <span class="token comment">// 这里不能写死</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="在main-js完成自定义指令全局注册"><a href="#在main-js完成自定义指令全局注册" class="header-anchor">#</a> 在main.js完成自定义指令全局注册</h3> <p>然后，在**<code>main.js</code>**中完成对于该文件中所有指令的全局注册</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> directives <span class="token keyword">from</span> <span class="token string">'@/directives'</span>
<span class="token comment">// 注册自定义指令</span>
<span class="token comment">// 遍历所有的导出的指令对象 完成自定义全局注册</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>directives<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注册自定义指令</span>
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> directives<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>针对上面的引入语法  <strong><code>import * as 变量</code></strong>  得到的是一个对象**<code>{ 变量1：对象1，变量2： 对象2 ... }</code>**, 所以可以采用对象遍历的方法进行处理</p> <p>指令注册成功，可以在**<code>navbar.vue</code>**中直接使用了</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-imageerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultImg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>staffPhoto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-avatar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">defaultImg</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/./assets/common/head.jpg'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><strong><code>本节任务</code></strong>：实现一个自定义指令，解决图片加载异常的问题</p> <h2 id="实现登出功能"><a href="#实现登出功能" class="header-anchor">#</a> 实现登出功能</h2> <p><strong><code>目标</code></strong>：实现用户的登出操作</p> <blockquote><p>登出仅仅是跳到登录页吗？</p></blockquote> <p>不，当然不是，我们要处理如下</p> <p><img src="/vuepress-starter/assets/img/image-20200827143847893.37c9389f.png" alt="image-20200827143847893"></p> <p>同样的，登出功能，我们在vuex中的用户模块中实现对应的<strong>action</strong></p> <p><strong>登出action</strong> <strong><code>src/store/modules/user.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 登出的action</span>
  <span class="token function">logout</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除token</span>
    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'removeToken'</span><span class="token punctuation">)</span> <span class="token comment">// 不仅仅删除了vuex中的 还删除了缓存中的</span>
    <span class="token comment">// 删除用户资料</span>
    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'removeUserInfo'</span><span class="token punctuation">)</span> <span class="token comment">// 删除用户信息</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><strong>头部菜单调用action</strong> <strong><code>src/layout/components/Navbar.vue</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/logout'</span><span class="token punctuation">)</span> <span class="token comment">// 这里不论写不写 await 登出方法都是同步的</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/login</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 跳到登录</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>**<code>注意</code>**我们这里也可以采用vuex中的模块化引入辅助函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters<span class="token punctuation">,</span> createNamespacedHelpers  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>  mapActions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createNamespacedHelpers</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token comment">// 这是的mapAction直接对应模块下的action辅助函数</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lgout'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>以上代码，实际上直接对user模块下的action进行了引用，</p> <p><strong>提交代码</strong></p> <p><strong><code>本节任务</code></strong>： 实现登出功能</p> <h2 id="token失效的主动介入"><a href="#token失效的主动介入" class="header-anchor">#</a> Token失效的主动介入</h2> <p><strong><code>目标</code></strong>： 处理当token失效时业务</p> <h3 id="主动介入token处理的业务逻辑"><a href="#主动介入token处理的业务逻辑" class="header-anchor">#</a> 主动介入token处理的业务逻辑</h3> <blockquote><p>开门的钥匙不是一直有效的，如果一直有效，会有安全风险，所以我们尝试在客户端进行一下token的时间检查</p></blockquote> <p>具体业务图如下</p> <p><img src="/vuepress-starter/assets/img/image-20200716231205153.458b7daf.png" alt="image-20200716231205153"></p> <h3 id="流程图转化代码-2"><a href="#流程图转化代码-2" class="header-anchor">#</a> 流程图转化代码</h3> <p><strong>流程图转化代码</strong> <strong><code>src/utils/auth.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> timeKey <span class="token operator">=</span> <span class="token string">'hrsaas-timestamp-key'</span> <span class="token comment">// 设置一个独一无二的key</span>

<span class="token comment">// 获取时间戳</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 设置时间戳</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>




</code></pre></div><p><strong><code>src/utils/request.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getTimeStamp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">const</span> TimeOut <span class="token operator">=</span> <span class="token number">3600</span> <span class="token comment">// 定义超时时间</span>

<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token comment">// 当执行 npm run dev  =&gt; .evn.development =&gt; /api =&gt; 跨域代理</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span><span class="token punctuation">,</span> <span class="token comment">// npm  run dev  =&gt; /api npm run build =&gt;  /prod-api</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span> <span class="token comment">// 设置超时时间</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 请求拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// config 是请求的配置信息</span>
  <span class="token comment">// 注入token</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只有在有token的情况下 才有必要去检查时间戳是否超时</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsCheckTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果它为true表示 过期了</span>
      <span class="token comment">// token没用了 因为超时了</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/logout'</span><span class="token punctuation">)</span> <span class="token comment">// 登出操作</span>
      <span class="token comment">// 跳转到登录页</span>
      router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'token超时了'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config <span class="token comment">// 必须要返回的</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 响应拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// axios默认加了一层data</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> message<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>data
  <span class="token comment">//   要根据success的成功与否决定下面的操作</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 业务已经错误了 还能进then ? 不能 ！ 应该进catch</span>
    Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token comment">// 提示错误消息</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// 提示错误信息</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// 返回执行错误 让当前的执行链跳出成功 直接进入 catch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 是否超时</span>
<span class="token comment">// 超时逻辑  (当前时间  - 缓存中的时间) 是否大于 时间差</span>
<span class="token keyword">function</span> <span class="token function">IsCheckTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 当前时间戳</span>
  <span class="token keyword">var</span> timeStamp <span class="token operator">=</span> <span class="token function">getTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 缓存时间戳</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>currentTime <span class="token operator">-</span> timeStamp<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">&gt;</span> TimeOut
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> service

</code></pre></div><p><strong><code>本节注意</code></strong>：我们在调用登录接口的时候 一定是没有token的，所以token检查不会影响登录接口的调用</p> <blockquote><p>同理，在登录的时候，如果登录成功，我们应该设置时间戳</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 定义login action  也需要参数 调用action时 传递过来的参数</span>
  <span class="token comment">// async 标记的函数其实就是一个异步函数 -&gt; 本质是还是 一个promise</span>
  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 经过响应拦截器的处理之后 这里的result实际上就是 token</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 实际上就是一个promise  result就是执行的结果</span>
    <span class="token comment">// axios默认给数据加了一层data</span>
    <span class="token comment">// 表示登录接口调用成功 也就是意味着你的用户名和密码是正确的</span>
    <span class="token comment">// 现在有用户token</span>
    <span class="token comment">// actions 修改state 必须通过mutations</span>
    context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setToken'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
    <span class="token comment">// 写入时间戳</span>
    <span class="token function">setTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 将当前的最新时间写入缓存</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><strong>提交代码</strong></p> <blockquote><p>有主动处理就有被动处理，也就是后端告诉我们超时了，我们被迫做出反应，如果后端接口没有做处理，主动介入就是一种简单的方式</p></blockquote> <p><strong><code>本节任务</code></strong>：完成token超时的主动介入</p> <h2 id="token失效的被动处理"><a href="#token失效的被动处理" class="header-anchor">#</a> Token失效的被动处理</h2> <p><strong><code>目标</code></strong>： 实现token失效的被动处理</p> <blockquote><p>除了token的主动介入之外，我们还可以对token进行被动的处理，如图</p></blockquote> <p><img src="/vuepress-starter/assets/img/image-20200818155842864.dd19105d.png" alt="image-20200818155842864"></p> <p>token超时的错误码是**<code>10002</code>**</p> <p><strong>代码实现</strong> <strong><code>src/utils/request.js</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// error 信息 里面 response的对象</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">10002</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当等于10002的时候 表示 后端告诉我token超时了</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/logout'</span><span class="token punctuation">)</span> <span class="token comment">// 登出action 删除token</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// 提示错误信息</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>无论是主动介入还是被动处理，这些操作都是为了更好地处理token，减少错误异常的可能性</p></blockquote> <p><strong><code>本节任务</code></strong>  Token失效的被动处理</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>本章节我们一步步实现了如下的效果</p> <p><img src="/vuepress-starter/assets/img/image-20200716015113164.e5562c69.png" alt="image-20200716015113164"></p> <p>实际的业务走向</p> <p><img src="/vuepress-starter/assets/img/image-20200827152601712.a24a90a4.png" alt="image-20200827152601712"></p> <p>实际上，我们的主页功能有一个重要的**<code>角色权限</code>**功能还没有完成，此功能等到我们完成基本业务之后再进行展开</p> <p>中台大型后端平台的深入是一个**<code>抽丝剥茧</code>**的过程，循序渐进的明白每一步的操作是非常关键的。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress-starter/vue/hrsaas/03-登录模块.html" class="prev">
          登录模块
        </a></span> <span class="next"><a href="/vuepress-starter/vue/hrsaas/05-路由和页面.html">
          路由和页面
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:0;" data-v-b57cc07c data-v-7dd95ae2></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 TS文档
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/vuepress-starter/assets/js/app.af2c115b.js" defer></script><script src="/vuepress-starter/assets/js/8.63529011.js" defer></script><script src="/vuepress-starter/assets/js/1.2f7c1606.js" defer></script><script src="/vuepress-starter/assets/js/15.59b3d65a.js" defer></script>
  </body>
</html>
